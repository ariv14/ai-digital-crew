<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="view-transition" content="same-origin">
  <meta name="theme-color" content="#0a0f1c">
  <title>AI Digital Crew — Community AI Projects</title>
  <meta name="description" content="Discover and share AI projects built by developers. Submit your GitHub repo and join the community.">
  <meta property="og:title" content="AI Digital Crew">
  <meta property="og:description" content="Community-driven AI project showcase. Submit your GitHub repo.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://aidigitalcrew.com">
  <meta property="og:image" content="https://aidigitalcrew.com/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="AI Digital Crew">
  <meta name="twitter:description" content="Community-driven AI project showcase. Submit your GitHub repo.">
  <meta name="twitter:image" content="https://aidigitalcrew.com/og-image.png">
  <link rel="canonical" href="https://aidigitalcrew.com">
  <meta name="theme-color" content="#0a0f1c">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "name": "AI Digital Crew",
        "url": "https://aidigitalcrew.com",
        "description": "Community-driven AI project showcase. Discover and share AI projects built by developers.",
        "potentialAction": {
          "@type": "SearchAction",
          "target": "https://aidigitalcrew.com/#search?q={search_term_string}",
          "query-input": "required name=search_term_string"
        }
      },
      {
        "@type": "Organization",
        "name": "AI Digital Crew",
        "url": "https://aidigitalcrew.com",
        "description": "Community-driven AI project showcase. Submit your GitHub repo and join the community."
      }
    ]
  }
  </script>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet"></noscript>
  <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin>
  <!-- identitytoolkit preconnect removed: unused, exceeded 4-preconnect limit -->
  <link rel="dns-prefetch" href="https://firestore.googleapis.com">
  <link rel="dns-prefetch" href="https://identitytoolkit.googleapis.com">
  <link rel="dns-prefetch" href="https://avatars.githubusercontent.com">
  <link rel="modulepreload" href="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js">
  <link rel="modulepreload" href="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-lite.js">
  <script type="speculationrules">{"prerender":[{"where":{"href_matches":"/project"},"eagerness":"moderate"}]}</script>
  <style>
    :root {
      --bg: #0a0f1c;
      --surface: rgba(255,255,255,0.05);
      --border: rgba(255,255,255,0.1);
      --primary: #3b82f6;
      --primary-end: #8b5cf6;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --radius: 16px;
      --success: #10b981;
      --error: #ef4444;
    }
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth;background:#0a0f1c}
    body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden;min-height:100vh}
    body.modal-open{overflow:hidden}
    h1,h2,h3,h4{font-family:'Space Grotesk',sans-serif}
    a{color:inherit;text-decoration:none}
    button{font-family:inherit;cursor:pointer;border:none;background:none;color:inherit}

    .orb{position:fixed;border-radius:50%;filter:blur(80px);opacity:0.4;z-index:0;pointer-events:none;will-change:transform;contain:strict}
    #orb-1{width:500px;height:500px;background:#3b82f6;top:-10%;left:-5%;animation:o1 20s ease-in-out infinite}
    #orb-2{width:400px;height:400px;background:#8b5cf6;top:40%;right:-10%;animation:o2 25s ease-in-out infinite}
    #orb-3{width:350px;height:350px;background:#06b6d4;bottom:-5%;left:30%;animation:o3 22s ease-in-out infinite}
    @keyframes o1{0%,100%{transform:translate(0,0)}33%{transform:translate(60px,80px)}66%{transform:translate(-40px,50px)}}
    @keyframes o2{0%,100%{transform:translate(0,0)}33%{transform:translate(-70px,-50px)}66%{transform:translate(50px,60px)}}
    @keyframes o3{0%,100%{transform:translate(0,0)}33%{transform:translate(80px,-40px)}66%{transform:translate(-60px,-70px)}}

    .glass{background:var(--surface);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--border);border-radius:var(--radius)}

    .btn-primary{display:inline-flex;align-items:center;gap:8px;padding:12px 28px;background:linear-gradient(135deg,var(--primary),var(--primary-end));background-size:200% 200%;color:#fff;font-weight:600;font-size:15px;border-radius:12px;border:none;transition:all .3s ease}
    .btn-primary:hover{background-position:100% 0;transform:translateY(-2px);box-shadow:0 0 24px rgba(59,130,246,.4)}
    .btn-primary:disabled{opacity:.5;cursor:not-allowed;transform:none}
    .btn-outlined{display:inline-flex;align-items:center;gap:8px;padding:12px 28px;background:transparent;color:var(--text);font-weight:600;font-size:15px;border-radius:12px;border:1px solid var(--border);transition:all .3s ease}
    .btn-outlined:hover{border-color:var(--primary);color:var(--primary);transform:translateY(-2px)}
    .btn-small{padding:8px 16px;font-size:13px;border-radius:8px}

    html{background:#0a0f1c}
    /* View Transitions */
    @view-transition{navigation:auto}
    nav{view-transition-name:navbar}
    ::view-transition-old(navbar),::view-transition-new(navbar){animation:none}
    ::view-transition-group(root){animation-duration:.2s}

    /* Nav */
    nav{position:sticky;top:0;z-index:100;padding:16px 32px;display:flex;align-items:center;justify-content:space-between;transition:all .3s ease}
    nav.scrolled{backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);background:rgba(10,15,28,.8);border-bottom:1px solid var(--border)}
    .nav-logo{display:flex;align-items:center;gap:10px;font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:20px}
    .nav-logo i{color:var(--primary)}
    .nav-links{display:flex;align-items:center;gap:32px}
    .nav-links a{color:var(--text-muted);font-size:15px;font-weight:500;transition:color .2s}
    .nav-links a:hover{color:var(--text)}
    .nav-right{display:flex;align-items:center;gap:16px}
    .nav-avatar{width:36px;height:36px;border-radius:50%;border:2px solid var(--border);cursor:pointer;transition:border-color .2s;object-fit:cover}
    .nav-avatar:hover{border-color:var(--primary)}
    .avatar-dropdown{position:absolute;top:60px;right:32px;min-width:180px;padding:8px;display:none;flex-direction:column;z-index:200}
    .avatar-dropdown.open{display:flex}
    .avatar-dropdown a,.avatar-dropdown button{display:flex;align-items:center;gap:10px;padding:10px 14px;font-size:14px;color:var(--text-muted);border-radius:8px;transition:all .2s;width:100%;text-align:left}
    .avatar-dropdown a:hover,.avatar-dropdown button:hover{background:rgba(255,255,255,.05);color:var(--text)}
    .dropdown-divider{height:1px;background:var(--border);margin:4px 0}
    .hamburger{display:none}
    .mobile-menu{display:none;position:absolute;top:64px;left:16px;right:16px;padding:16px;flex-direction:column;gap:12px;z-index:150;background:rgba(15,23,42,.97);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:var(--radius)}
    .mobile-menu.open{display:flex}
    .mobile-menu a,.mobile-menu button{color:var(--text-muted);font-size:16px;padding:10px;border-radius:8px;transition:all .2s;text-align:left}
    .mobile-nav-icons{display:none;align-items:center;gap:10px}
    .mobile-nav-icon{display:flex;align-items:center;justify-content:center;background:none;border:none;color:var(--text-muted);cursor:pointer;padding:4px;text-decoration:none;transition:color .2s}
    .mobile-nav-icon:hover{color:var(--text)}

    /* Hero */
    .hero{position:relative;z-index:1;min-height:90vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:80px 24px 60px}
    .hero h1{font-size:64px;font-weight:700;line-height:1.1;max-width:800px;background:linear-gradient(135deg,var(--text),var(--text-muted));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .hero .subtitle{font-size:20px;color:#b0bec5;max-width:600px;margin:20px auto 0}
    .hero-ctas{display:flex;gap:16px;margin-top:24px;flex-wrap:wrap;justify-content:center}
    .stats-bar{display:flex;gap:20px;margin-top:60px;flex-wrap:wrap;justify-content:center;min-height:52px}
    .stat-pill{padding:12px 24px;font-size:15px;font-weight:600;background:rgba(15,23,42,.85)}
    .stat-pill .stat-number{color:#60a5fa;margin-right:6px}
    .stat-pill .stat-label{color:#e2e8f0}

    /* Sections */
    section{position:relative;z-index:1;padding:80px 24px}
    .section-container{max-width:1200px;margin:0 auto}
    .section-header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px;margin-bottom:40px}
    .section-title{font-size:36px;font-weight:700}
    .section-subtitle{font-size:18px;color:var(--text-muted)}

    /* Project Cards */
    .project-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px;min-height:300px}
    .project-card{overflow:hidden;transition:transform .3s ease,opacity .4s ease;opacity:0;transform:scale(0.97)}
    .project-card.visible{opacity:1;transform:scale(1)}
    .project-card:hover{transform:scale(1.02);box-shadow:0 0 24px rgba(59,130,246,.15)}
    .project-banner{height:100px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius) var(--radius) 0 0;background:linear-gradient(135deg,var(--primary),var(--primary-end));position:relative}
    .project-banner img{width:48px;height:48px;border-radius:50%;border:2px solid rgba(255,255,255,.3)}
    .project-banner .initial{font-family:'Space Grotesk',sans-serif;font-size:36px;font-weight:700;color:rgba(255,255,255,.9)}
    .auto-badge{position:absolute;top:10px;right:10px;padding:3px 8px;font-size:11px;font-weight:600;color:#fff;background:linear-gradient(135deg,#f59e0b,#ef4444);border-radius:20px;white-space:nowrap;letter-spacing:.3px}
    .project-body{padding:20px}
    .project-name{font-size:18px;font-weight:700;margin-bottom:4px;display:flex;align-items:center;gap:8px}
    .project-name a{color:var(--text);transition:color .2s}
    .project-name a:hover{color:var(--primary)}
    .project-owner{font-size:13px;color:var(--text-muted);margin-bottom:10px}
    .project-desc{font-size:14px;color:var(--text-muted);line-height:1.5;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;margin-bottom:14px}
    .quick-start{margin-bottom:14px;font-size:13px}
    .quick-start summary{color:var(--primary);cursor:pointer;font-weight:500;user-select:none;margin-bottom:6px}
    .quick-start ol{padding-left:18px;color:var(--text-muted);line-height:1.6}
    .quick-start ol li{margin-bottom:4px}

    /* Featured Spotlight */
    .featured-section{padding-top:0}
    .featured-spotlight{border-radius:var(--radius);overflow:hidden;border:1px solid rgba(245,158,11,.3);background:linear-gradient(135deg,rgba(245,158,11,.06),rgba(239,68,68,.04));position:relative}
    .featured-label{padding:16px 28px 0;display:flex;align-items:center;gap:8px;font-size:12px;font-weight:700;color:#f59e0b;text-transform:uppercase;letter-spacing:1.2px}
    .featured-label span{margin-left:auto;font-size:11px;font-weight:400;opacity:.6;text-transform:none;letter-spacing:0}
    .featured-body{padding:20px 28px 28px;display:grid;grid-template-columns:auto 1fr;gap:24px;align-items:start}
    .featured-avatar{width:72px;height:72px;border-radius:14px;border:2px solid rgba(255,255,255,.15);object-fit:cover}
    .featured-avatar-initial{width:72px;height:72px;border-radius:14px;background:linear-gradient(135deg,var(--primary),var(--primary-end));display:flex;align-items:center;justify-content:center;font-family:'Space Grotesk',sans-serif;font-size:32px;font-weight:700;color:rgba(255,255,255,.9)}
    .featured-name{font-size:26px;font-weight:700;margin-bottom:2px}
    .featured-name a{color:var(--text);transition:color .2s}
    .featured-name a:hover{color:#f59e0b}
    .featured-owner{font-size:13px;color:var(--text-muted);margin-bottom:14px}
    .featured-writeup{font-size:14px;color:var(--text-muted);line-height:1.7;margin-bottom:18px}
    .featured-qs{margin-bottom:18px;background:rgba(255,255,255,.03);border-radius:10px;padding:14px 18px;border:1px solid var(--border)}
    .featured-qs .qs-label{font-size:13px;font-weight:600;color:#f59e0b;margin-bottom:10px}
    .featured-qs ol{padding-left:18px;color:var(--text-muted);font-size:13px;line-height:1.7}
    .featured-qs ol li{margin-bottom:4px}
    .featured-footer{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    @media(max-width:600px){.featured-body{grid-template-columns:1fr}.featured-avatar,.featured-avatar-initial{display:none}}
    .project-topics{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px}
    .project-topic{padding:3px 10px;font-size:11px;color:var(--primary);background:rgba(59,130,246,.1);border-radius:6px}
    .project-stats{display:flex;gap:16px;font-size:13px;color:var(--text-muted)}
    .project-stats span{display:flex;align-items:center;gap:4px}
    .project-lang-dot{width:10px;height:10px;border-radius:50%;display:inline-block}

    /* Empty & Loading */
    .empty-state{text-align:center;padding:80px 20px;grid-column:1/-1}
    .empty-state i{color:var(--text-muted);margin-bottom:16px}
    .empty-state p{color:var(--text-muted);font-size:16px;margin-bottom:24px}
    .skeleton-card{overflow:hidden;min-height:280px}
    .skeleton-banner{height:100px;background:rgba(255,255,255,.04);border-radius:var(--radius) var(--radius) 0 0}
    .skeleton-body{padding:20px}
    .skeleton-line{height:14px;border-radius:7px;background:linear-gradient(90deg,rgba(255,255,255,.04) 25%,rgba(255,255,255,.08) 50%,rgba(255,255,255,.04) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;margin-bottom:12px}
    .skeleton-line.short{width:60%}.skeleton-line.medium{width:80%}.skeleton-line.long{width:100%}.skeleton-line.title{height:20px;width:70%}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    /* Modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);z-index:500;display:none;align-items:center;justify-content:center;padding:24px;overscroll-behavior:contain}
    .modal-overlay.open{display:flex}
    .modal{width:100%;max-width:480px;padding:32px;position:relative;max-height:90vh;overflow-y:auto}
    .modal-close{position:absolute;top:16px;right:16px;color:var(--text-muted);cursor:pointer;padding:4px;border-radius:8px;transition:color .2s;background:none;border:none}
    .modal-close:hover{color:var(--text)}
    .modal h2{font-size:24px;margin-bottom:8px}
    .modal .modal-subtitle{font-size:14px;color:var(--text-muted);margin-bottom:28px}

    .oauth-btn{display:flex;align-items:center;gap:12px;width:100%;padding:14px 20px;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s;border:none;margin-bottom:12px}
    .oauth-btn:hover{transform:translateY(-1px)}
    .oauth-btn.github{background:#24292e;color:#fff}
    .oauth-btn.google{background:#fff;color:#1f2937}
    .oauth-btn.facebook{background:#1877F2;color:#fff}
    .oauth-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
    .oauth-spinner{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}
    .auth-overlay{position:fixed;inset:0;background:rgba(10,15,28,.95);z-index:9999;display:none;align-items:center;justify-content:center;flex-direction:column;gap:16px}
    .auth-overlay.active{display:flex}
    .auth-overlay-spinner{width:36px;height:36px;border:3px solid rgba(255,255,255,.15);border-top-color:var(--primary);border-radius:50%;animation:spin .7s linear infinite}
    .auth-overlay-text{font-size:14px;color:var(--text-muted);font-weight:500}
    .oauth-btn.google .oauth-spinner{border-color:rgba(0,0,0,.2);border-top-color:#1f2937}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Submit form */
    .form-group{margin-bottom:20px}
    .form-group label{display:block;font-size:14px;font-weight:500;margin-bottom:6px}
    .form-group input{width:100%;padding:12px 14px;background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:14px;font-family:inherit;transition:border-color .2s}
    .form-group input:focus{outline:none;border-color:var(--primary)}
    .form-error{font-size:12px;color:var(--error);margin-top:4px;display:none}
    .form-error.show{display:block}
    .repo-preview{margin-top:16px;padding:16px;display:none}
    .repo-preview.show{display:block}
    .repo-preview h4{font-size:16px;margin-bottom:4px}
    .repo-preview p{font-size:13px;color:var(--text-muted);margin-bottom:8px}
    .repo-preview .repo-meta{display:flex;gap:12px;font-size:12px;color:var(--text-muted)}
    .repo-preview .repo-meta span{display:flex;align-items:center;gap:4px}

    /* Toast */
    #toast-container{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
    .toast{min-width:280px;padding:14px 18px;display:flex;align-items:center;gap:10px;font-size:14px;pointer-events:auto;animation:slideIn .3s ease forwards}
    .toast.removing{animation:slideOut .3s ease forwards}
    .toast.success{border-left:4px solid var(--success)}
    .toast.error{border-left:4px solid var(--error)}
    .toast.info{border-left:4px solid var(--primary)}
    .toast i{flex-shrink:0}
    @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}

    /* Category Tabs */
    .category-tabs{display:flex;gap:8px;overflow-x:auto;padding-bottom:4px;margin-bottom:32px;scrollbar-width:none}
    .category-tabs::-webkit-scrollbar{display:none}
    .category-tab{flex-shrink:0;padding:7px 16px;font-size:13px;font-weight:600;border-radius:20px;border:1px solid var(--border);color:var(--text-muted);background:transparent;cursor:pointer;transition:all .2s;white-space:nowrap}
    .category-tab:hover{border-color:var(--primary);color:var(--text)}
    .category-tab.active{background:linear-gradient(135deg,var(--primary),var(--primary-end));border-color:transparent;color:#fff}
    .category-badge{display:inline-block;margin-top:6px;padding:2px 9px;font-size:11px;font-weight:600;border-radius:6px;background:rgba(139,92,246,.15);color:#a78bfa}

    /* Footer */
    footer{position:relative;z-index:1;border-top:1px solid var(--border);padding:60px 24px 32px}
    .footer-grid{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:40px;margin-bottom:40px}
    .footer-col .footer-heading{font-family:'Space Grotesk',sans-serif;font-size:14px;font-weight:600;margin-bottom:16px;color:var(--text)}
    .footer-col a{display:block;font-size:14px;color:var(--text-muted);margin-bottom:10px;transition:color .2s}
    .footer-col a:hover{color:var(--text)}
    .footer-social{display:flex;gap:16px;margin-bottom:24px;justify-content:center}
    .footer-social a{color:var(--text-muted);transition:color .2s}
    .footer-social a:hover{color:var(--text)}
    .footer-bottom{text-align:center;font-size:13px;color:var(--text-muted);padding-top:24px;border-top:1px solid var(--border);max-width:1200px;margin:0 auto}

    @media(max-width:768px){
      .hero h1{font-size:36px}.hero .subtitle{font-size:16px}
      .nav-links,.nav-right{display:none}.hamburger{display:block}.mobile-nav-icons{display:flex}
      .project-grid{grid-template-columns:repeat(2,1fr)}
      .footer-grid{grid-template-columns:repeat(2,1fr)}
      .stat-pill{padding:10px 16px;font-size:13px}.stats-bar{gap:12px}
      .modal{max-width:100%}
    }
    @media(max-width:480px){
      .hero h1{font-size:28px}nav{padding:14px 16px}
      .project-grid{grid-template-columns:1fr}
      .hero-ctas{flex-direction:column;align-items:center}
      .footer-grid{grid-template-columns:1fr}
    }

    /* ── Search Bar ─────────────────────────────────────── */
    .search-container{position:relative;margin-bottom:0;max-width:640px;width:100%;margin-left:auto;margin-right:auto}
    .search-input-wrap{position:relative;display:flex;align-items:center}
    .search-input-wrap i.search-icon{position:absolute;left:18px;color:var(--text-muted);pointer-events:none;width:20px;height:20px}
    .search-input{width:100%;padding:16px 48px 16px 48px;background:rgba(255,255,255,0.08);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,0.15);border-radius:16px;color:var(--text);font-size:17px;font-family:inherit;transition:border-color .3s,box-shadow .3s}
    .search-input:focus{outline:none;border-color:transparent;box-shadow:0 0 0 2px var(--primary),0 0 0 4px rgba(139,92,246,.3),0 0 24px rgba(59,130,246,.15)}
    .search-input::placeholder{color:var(--text-muted)}

    /* Trending pills (always visible below hero search) */
    .hero-trending{display:flex;align-items:center;gap:8px;margin-top:16px;flex-wrap:wrap;justify-content:center;max-width:640px;margin-left:auto;margin-right:auto}
    .hero-trending-label{font-size:13px;color:var(--text-muted);font-weight:500;white-space:nowrap}
    .hero-trending-pill{padding:5px 14px;font-size:13px;color:var(--text-muted);background:rgba(255,255,255,0.06);border:1px solid var(--border);border-radius:20px;cursor:pointer;transition:all .2s;white-space:nowrap}
    .hero-trending-pill:hover{border-color:var(--primary);color:var(--primary);background:rgba(59,130,246,.08)}
    @media(max-width:768px){.search-container{max-width:100%}.search-input{font-size:16px;padding:14px 44px}.hero-trending{gap:6px}}
    @media(max-width:480px){.hero-trending-pill{font-size:12px;padding:4px 10px}}
    .search-clear{position:absolute;right:12px;background:none;border:none;color:var(--text-muted);cursor:pointer;padding:4px;border-radius:6px;display:none;transition:color .2s}
    .search-clear:hover{color:var(--text)}
    .search-clear.visible{display:flex}
    .search-spinner{position:absolute;right:12px;width:18px;height:18px;border:2px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin .6s linear infinite;display:none}
    .search-spinner.visible{display:block}

    /* Pre-search discovery panel */
    .search-discovery{display:none;padding:16px;margin-top:4px;position:absolute;left:0;right:0;z-index:50;max-height:320px;overflow-y:auto}
    .search-discovery.open{display:block}
    .search-discovery h4{font-size:12px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:.8px;margin-bottom:10px}
    .search-discovery h4:not(:first-child){margin-top:14px}
    .discovery-pills{display:flex;flex-wrap:wrap;gap:8px}
    .discovery-pill{padding:6px 14px;font-size:13px;color:var(--text);background:rgba(255,255,255,.06);border:1px solid var(--border);border-radius:20px;cursor:pointer;transition:all .2s;white-space:nowrap}
    .discovery-pill:hover{border-color:var(--primary);color:var(--primary);background:rgba(59,130,246,.08)}

    /* Autocomplete dropdown */
    .search-autocomplete{display:none;position:absolute;left:0;right:0;top:100%;margin-top:4px;z-index:60;max-height:280px;overflow-y:auto;padding:6px 0}
    .search-autocomplete.open{display:block}
    .autocomplete-item{padding:10px 16px;font-size:14px;color:var(--text-muted);cursor:pointer;transition:background .15s;display:flex;align-items:center;gap:10px}
    .autocomplete-item:hover,.autocomplete-item.active{background:rgba(255,255,255,.06);color:var(--text)}
    .autocomplete-item mark{background:transparent;color:var(--primary);font-weight:600}
    .autocomplete-item .ac-type{font-size:11px;color:var(--text-muted);margin-left:auto;opacity:.6}

    /* Search status bar */
    .search-status{display:none;align-items:center;gap:8px;margin-bottom:16px;font-size:13px;color:var(--text-muted)}
    .search-status.visible{display:flex}
    .search-status .status-spinner{width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin .6s linear infinite}

    /* Did you mean */
    .did-you-mean{display:none;margin-bottom:16px;font-size:14px;color:var(--text-muted)}
    .did-you-mean.visible{display:block}
    .did-you-mean a{color:var(--primary);font-weight:500;cursor:pointer;text-decoration:underline}

    /* Match badges */
    .match-badge{display:inline-block;padding:2px 8px;font-size:10px;font-weight:600;border-radius:6px;margin-left:8px;vertical-align:middle}
    .match-badge.best{background:rgba(16,185,129,.15);color:#10b981}
    .match-badge.good{background:rgba(59,130,246,.15);color:#3b82f6}
    .match-badge.related{background:rgba(148,163,184,.15);color:#94a3b8}
    mark.search-highlight{background:rgba(59,130,246,.2);color:var(--text);border-radius:2px;padding:0 1px}

    /* Similar Projects */
    .similar-projects{margin-top:12px;border-top:1px solid var(--border);padding-top:10px}
    .similar-projects summary{font-size:12px;color:var(--primary);cursor:pointer;font-weight:500;user-select:none;margin-bottom:8px}
    .similar-card{display:flex;align-items:center;gap:10px;padding:8px 0;font-size:13px}
    .similar-card a{color:var(--text);transition:color .2s}
    .similar-card a:hover{color:var(--primary)}
    .similar-card .similar-score{font-size:11px;color:var(--text-muted);margin-left:auto}

    /* GitHub discovery section */
    .github-discovery{margin-top:32px;padding-top:24px;border-top:1px solid var(--border);grid-column:1/-1}
    .github-discovery-primary{margin-top:0;padding-top:0;border-top:none}
    .github-discovery h3{font-size:18px;font-weight:600;margin-bottom:4px;display:flex;align-items:center;gap:8px}
    .github-discovery .gh-subtitle{font-size:13px;color:var(--text-muted);margin-bottom:16px}
    .gh-result-card{padding:20px;margin-bottom:12px;display:flex;gap:14px;align-items:flex-start;transition:transform .2s,box-shadow .2s}
    .gh-result-card:hover{transform:translateY(-2px);box-shadow:0 0 20px rgba(59,130,246,.1)}
    .gh-result-avatar{width:36px;height:36px;border-radius:50%;flex-shrink:0;border:1px solid var(--border)}
    .gh-result-body{flex:1;min-width:0}
    .gh-result-card h4{font-size:15px;font-weight:600;margin-bottom:2px;display:flex;align-items:center;gap:8px}
    .gh-result-card h4 a{color:var(--text);transition:color .2s}
    .gh-result-card h4 a:hover{color:var(--primary)}
    .gh-result-card h4 .gh-source-tag{font-size:10px;font-weight:500;color:var(--text-muted);background:rgba(255,255,255,.06);padding:1px 6px;border-radius:4px;flex-shrink:0}
    .gh-result-card p{font-size:13px;color:var(--text-muted);margin-bottom:10px;line-height:1.5}
    .gh-result-meta{display:flex;gap:14px;font-size:12px;color:var(--text-muted);align-items:center;flex-wrap:wrap}
    .gh-result-meta span{display:flex;align-items:center;gap:4px}
    .gh-submit-btn{margin-left:auto;padding:6px 14px;font-size:12px;font-weight:600;color:var(--primary);border:1px solid var(--primary);border-radius:8px;background:transparent;cursor:pointer;transition:all .2s;white-space:nowrap}
    .gh-submit-btn:hover{background:rgba(59,130,246,.1)}
    .gh-skeleton{display:flex;flex-direction:column;gap:12px}
    .gh-skeleton-card{height:90px;border-radius:var(--radius);background:linear-gradient(90deg,rgba(255,255,255,.04) 25%,rgba(255,255,255,.08) 50%,rgba(255,255,255,.04) 75%);background-size:200% 100%;animation:ghShimmer 1.5s infinite}
    @keyframes ghShimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    /* Nav active state */
    .nav-links a.nav-active{color:var(--text)}
    /* Search page header */
    .search-page-header{text-align:center;margin-bottom:8px}
    .search-page-header .section-subtitle{margin-top:8px}

    /* ── Trending Page ───────────────────────────────────── */
    .radar-hero{position:relative;z-index:1;text-align:center;padding:100px 24px 40px}
    .radar-hero h1{font-size:52px;font-weight:700;line-height:1.1;background:linear-gradient(135deg,var(--text),#60a5fa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .radar-hero .subtitle{font-size:18px;color:var(--text-muted);max-width:540px;margin:16px auto 0}
    .hero-freshness{font-size:13px;color:var(--text-muted);margin-top:12px;opacity:.7}
    .hero-stats{display:flex;gap:20px;margin-top:36px;justify-content:center;flex-wrap:wrap}
    .hero-stat{padding:20px 32px;text-align:center;min-width:130px}
    .hero-stat .stat-num{font-family:'Space Grotesk',sans-serif;font-size:36px;font-weight:700;color:#60a5fa}
    .hero-stat .stat-lbl{font-size:13px;color:var(--text-muted);margin-top:4px}
    .time-toggle{display:flex;gap:4px;justify-content:center;margin-top:24px}
    .time-btn{padding:6px 20px;font-size:13px;font-weight:600;border-radius:10px;border:1px solid var(--border);color:var(--text-muted);background:transparent;cursor:pointer;transition:all .2s}
    .time-btn:hover{border-color:var(--primary);color:var(--text)}
    .time-btn.active{background:linear-gradient(135deg,var(--primary),var(--primary-end));border-color:transparent;color:#fff}

    /* Trending sections */
    #trending-page section{padding:60px 24px}
    #trending-page .section-container{max-width:1100px;margin:0 auto}
    #trending-page .section-header{margin-bottom:32px;display:block}
    #trending-page .section-title{font-size:28px;font-weight:700;display:flex;align-items:center;gap:10px}
    #trending-page .section-subtitle{font-size:15px;color:var(--text-muted);margin-top:6px}

    /* Rank Card */
    .rank-card{display:flex;align-items:flex-start;gap:16px;padding:20px;border-radius:14px;border:1px solid var(--border);background:var(--surface);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);transition:all .3s ease;margin-bottom:12px}
    .rank-card:hover{border-color:rgba(59,130,246,.3);transform:translateX(4px)}
    .rank-num{font-family:'Space Grotesk',sans-serif;font-size:22px;font-weight:700;color:var(--text-muted);min-width:36px;text-align:center;flex-shrink:0;padding-top:2px}
    .rank-num.gold{color:#fbbf24;text-shadow:0 0 12px rgba(251,191,36,.4)}
    .rank-num.silver{color:#d1d5db;text-shadow:0 0 10px rgba(209,213,219,.3)}
    .rank-num.bronze{color:#d97706;text-shadow:0 0 10px rgba(217,119,6,.3)}
    .rank-body{flex:1;min-width:0}
    .rank-header{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:4px}
    .rank-name{font-size:17px;font-weight:700}
    .rank-name a{color:var(--text);transition:color .2s}
    .rank-name a:hover{color:var(--primary)}
    .rank-owner{font-size:13px;color:var(--text-muted)}
    .rank-desc{font-size:13px;color:var(--text-muted);line-height:1.5;margin:6px 0 10px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .rank-meta{display:flex;align-items:center;gap:12px;flex-wrap:wrap;font-size:12px;color:var(--text-muted)}
    .rank-meta span{display:flex;align-items:center;gap:4px}
    .rank-lang-dot{width:9px;height:9px;border-radius:50%;display:inline-block}

    /* Trend badge */
    .trend-badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;font-size:11px;font-weight:600;border-radius:6px;white-space:nowrap}
    .trend-badge.hot{background:rgba(239,68,68,.15);color:#f87171}
    .trend-badge.rising{background:rgba(16,185,129,.15);color:#34d399}
    .trend-badge.steady{background:rgba(148,163,184,.12);color:#94a3b8}
    .trend-badge.declining{background:rgba(148,163,184,.08);color:#64748b}
    .trend-badge.new-project{background:rgba(59,130,246,.15);color:#60a5fa}
    .trend-badge i{flex-shrink:0}
    .new-week-badge{display:inline-flex;align-items:center;gap:3px;padding:2px 7px;font-size:10px;font-weight:700;border-radius:5px;background:rgba(251,191,36,.15);color:#fbbf24;text-transform:uppercase;letter-spacing:.5px}

    /* Sparkline */
    .trend-sparkline{display:inline-flex;align-items:center;vertical-align:middle}
    .trend-sparkline svg{display:block}

    /* Star gain */
    .star-gain{font-size:12px;font-weight:600}
    .star-gain.positive{color:#34d399}
    .star-gain.negative{color:#f87171}
    .star-gain.neutral{color:var(--text-muted)}

    /* Momentum bar */
    .momentum-bar{margin-top:8px;display:flex;align-items:center;gap:8px}
    .momentum-track{flex:1;height:4px;background:rgba(255,255,255,.06);border-radius:2px;overflow:hidden}
    .momentum-fill{height:100%;border-radius:2px;transition:width .6s ease}
    .momentum-fill.hot{background:linear-gradient(90deg,#ef4444,#f97316)}
    .momentum-fill.rising{background:linear-gradient(90deg,#10b981,#3b82f6)}
    .momentum-fill.steady{background:#64748b}
    .momentum-fill.declining{background:#475569}
    .momentum-fill.new-project{background:linear-gradient(90deg,#3b82f6,#8b5cf6)}
    .momentum-val{font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:600;color:var(--text-muted);min-width:32px;text-align:right}

    /* Trending Filters */
    .filter-bar{display:flex;gap:12px;margin-bottom:28px;flex-wrap:wrap;align-items:center}
    .filter-group{display:flex;align-items:center;gap:6px}
    .filter-label{font-size:12px;color:var(--text-muted);font-weight:500;text-transform:uppercase;letter-spacing:.5px}
    .sort-btn{padding:7px 16px;font-size:13px;font-weight:600;border-radius:10px;border:1px solid var(--border);color:var(--text-muted);background:transparent;cursor:pointer;transition:all .2s}
    .sort-btn:hover{border-color:var(--primary);color:var(--text)}
    .sort-btn.active{background:linear-gradient(135deg,var(--primary),var(--primary-end));border-color:transparent;color:#fff}
    .filter-select{padding:7px 14px;font-size:13px;font-weight:500;border-radius:10px;border:1px solid var(--border);color:var(--text);background:rgba(255,255,255,.05);cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:30px}
    .filter-select:focus{outline:none;border-color:var(--primary)}
    .filter-select option{background:#1e293b;color:var(--text)}
    #trending-page .trnd-search-input{padding:8px 14px 8px 36px;font-size:13px;font-weight:500;border-radius:10px;border:1px solid var(--border);color:var(--text);background:rgba(255,255,255,.05);width:200px;transition:all .2s;font-family:inherit}
    #trending-page .trnd-search-input::placeholder{color:var(--text-muted)}
    #trending-page .trnd-search-input:focus{outline:none;border-color:var(--primary);width:260px}
    .trnd-search-wrap{position:relative;display:flex;align-items:center}
    .trnd-search-wrap i{position:absolute;left:10px;color:var(--text-muted);pointer-events:none}

    /* Movers grid */
    .movers-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .movers-card{padding:20px;border-radius:14px;border:1px solid var(--border);background:var(--surface);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
    .movers-title{font-size:14px;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:6px}
    .mover-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.04)}
    .mover-row:last-child{border-bottom:none}
    .mover-rank{font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:700;color:var(--text-muted);min-width:20px}
    .mover-name{font-size:13px;font-weight:600;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .mover-name a{color:var(--text);transition:color .2s}
    .mover-name a:hover{color:var(--primary)}
    .mover-val{font-size:13px;font-weight:700;white-space:nowrap}
    .mover-val.pct{color:#34d399}
    .mover-val.abs{color:#60a5fa}
    .mover-val.positive{color:#34d399}
    .mover-val.negative{color:#f87171}
    .mover-val.cooling{color:#60a5fa}

    /* Pagination */
    .pagination{display:flex;align-items:center;justify-content:center;gap:6px;margin-top:20px;margin-bottom:24px}
    .page-btn{padding:6px 14px;font-size:13px;font-weight:600;border-radius:8px;border:1px solid var(--border);color:var(--text-muted);background:transparent;cursor:pointer;transition:all .2s}
    .page-btn:hover:not(:disabled){border-color:var(--primary);color:var(--text)}
    .page-btn.active{background:linear-gradient(135deg,var(--primary),var(--primary-end));border-color:transparent;color:#fff}
    .page-btn:disabled{opacity:.4;cursor:default}
    .page-info{font-size:13px;color:var(--text-muted);padding:0 8px}

    /* Developer card */
    .dev-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(min(300px,100%),1fr));gap:16px}
    .dev-card{display:flex;align-items:center;gap:14px;padding:16px 20px;border-radius:14px;border:1px solid var(--border);background:var(--surface);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);transition:all .3s ease}
    .dev-card:hover{border-color:rgba(59,130,246,.3);transform:translateY(-2px)}
    .dev-rank{font-family:'Space Grotesk',sans-serif;font-size:18px;font-weight:700;color:var(--text-muted);min-width:28px}
    .dev-avatar{width:40px;height:40px;border-radius:50%;border:2px solid var(--border);flex-shrink:0}
    .dev-info{flex:1;min-width:0}
    .dev-name{font-size:15px;font-weight:700}
    .dev-name a{color:var(--text);transition:color .2s}
    .dev-name a:hover{color:var(--primary)}
    .dev-stats{font-size:12px;color:var(--text-muted);margin-top:2px;display:flex;gap:12px;flex-wrap:wrap}
    .dev-repos{font-size:11px;color:var(--text-muted);margin-top:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}

    /* View toggle */
    .view-toggle{display:flex;gap:4px;margin-left:auto}
    .view-toggle-btn{padding:6px 10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text-muted);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:4px;font-size:12px;font-weight:600}
    .view-toggle-btn:hover{border-color:var(--primary);color:var(--text)}
    .view-toggle-btn.active{background:linear-gradient(135deg,var(--primary),var(--primary-end));border-color:transparent;color:#fff}

    /* Rankings table */
    .rankings-table-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch;margin-top:12px}
    .rankings-table{width:100%;border-collapse:separate;border-spacing:0;font-size:13px}
    .rankings-table th{position:sticky;top:0;z-index:2;padding:10px 12px;text-align:left;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--text-muted);background:var(--bg);border-bottom:2px solid var(--border);cursor:pointer;white-space:nowrap;user-select:none;transition:color .2s}
    .rankings-table th:hover{color:var(--text)}
    .rankings-table th .sort-icon{display:inline-block;width:10px;margin-left:4px;opacity:.4;transition:opacity .2s}
    .rankings-table th.sorted-asc .sort-icon,.rankings-table th.sorted-desc .sort-icon{opacity:1;color:var(--primary)}
    .rankings-table td{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.04);white-space:nowrap;vertical-align:middle}
    .rankings-table tr:hover td{background:rgba(255,255,255,.02)}
    .rankings-table .tbl-rank{font-family:'Space Grotesk',sans-serif;font-weight:700;color:var(--text-muted);width:40px}
    .rankings-table .tbl-project{display:flex;align-items:center;gap:10px;min-width:180px;white-space:normal}
    .rankings-table .tbl-project img{width:24px;height:24px;border-radius:50%;flex-shrink:0}
    .rankings-table .tbl-project-name{font-weight:700}
    .rankings-table .tbl-project-name a{color:var(--text);transition:color .2s}
    .rankings-table .tbl-project-name a:hover{color:var(--primary)}
    .rankings-table .tbl-project-owner{font-size:11px;color:var(--text-muted)}
    .rankings-table .positive{color:#34d399}
    .rankings-table .negative{color:#f87171}

    /* Movers tabs and toggle */
    .movers-controls{display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap}
    .movers-tab-group{display:flex;gap:4px}
    .movers-tab{padding:6px 16px;font-size:13px;font-weight:600;border-radius:10px;border:1px solid var(--border);color:var(--text-muted);background:transparent;cursor:pointer;transition:all .2s}
    .movers-tab:hover{border-color:var(--primary);color:var(--text)}
    .movers-tab.active{background:linear-gradient(135deg,var(--primary),var(--primary-end));border-color:transparent;color:#fff}
    .movers-time-toggle{display:flex;gap:4px;margin-left:auto}

    /* Category leaderboard */
    .cat-lb-tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}
    .cat-lb-tab{padding:6px 14px;font-size:12px;font-weight:600;border-radius:10px;border:1px solid var(--border);color:var(--text-muted);background:transparent;cursor:pointer;transition:all .2s}
    .cat-lb-tab:hover{border-color:var(--primary);color:var(--text)}
    .cat-lb-tab.active{background:linear-gradient(135deg,var(--primary),var(--primary-end));border-color:transparent;color:#fff}

    /* Weekly recap banner */
    .recap-banner{display:flex;align-items:center;gap:14px;padding:16px 24px;border-radius:14px;border:1px solid rgba(139,92,246,.3);background:linear-gradient(135deg,rgba(139,92,246,.08),rgba(59,130,246,.08));margin-bottom:24px;position:relative}
    .recap-banner-icon{font-size:24px;flex-shrink:0}
    .recap-banner-text{flex:1;font-size:14px;line-height:1.5}
    .recap-banner-text strong{color:var(--primary)}
    .recap-banner-dismiss{position:absolute;top:8px;right:8px;background:none;border:none;color:var(--text-muted);cursor:pointer;padding:4px;border-radius:4px;transition:color .2s}
    .recap-banner-dismiss:hover{color:var(--text)}

    /* Trending skeleton */
    #trending-page .skeleton-card{overflow:hidden;min-height:80px;border-radius:14px;border:1px solid var(--border);background:var(--surface);margin-bottom:12px;padding:20px}
    .skeleton-line.title{height:18px;width:50%}

    /* Trending responsive */
    @media(max-width:900px){
      .movers-grid{grid-template-columns:1fr}
      .hero-stats{gap:12px}
      .hero-stat{padding:14px 20px;min-width:100px}
      .hero-stat .stat-num{font-size:28px}
      .dev-grid{grid-template-columns:1fr}
      .movers-controls{flex-direction:column;align-items:flex-start}
      .movers-time-toggle{margin-left:0}
      .cat-lb-tabs{gap:4px}
    }
    @media(max-width:768px){
      .radar-hero h1{font-size:36px}
      .radar-hero .subtitle{font-size:15px}
      .hero-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:320px;margin-left:auto;margin-right:auto}
      .hero-stat{min-width:0;padding:14px 12px}
      .filter-bar{gap:8px;flex-wrap:wrap}
      .filter-group{flex-wrap:wrap}
      #trending-page .trnd-search-input{width:100%}
      #trending-page .trnd-search-input:focus{width:100%}
      .trnd-search-wrap{width:100%}
      .dev-card{padding:12px 14px;gap:10px}
      .dev-rank{font-size:16px;min-width:24px}
      .dev-avatar{width:36px;height:36px}
      .view-toggle{margin-left:0;margin-top:8px}
      .recap-banner{flex-direction:column;gap:10px;padding:14px 16px;text-align:center}
      .recap-banner-dismiss{position:static;align-self:flex-end}
    }
  </style>
</head>
<body>
  <div class="orb" id="orb-1" aria-hidden="true"></div>
  <div class="orb" id="orb-2" aria-hidden="true"></div>
  <div class="orb" id="orb-3" aria-hidden="true"></div>

  <nav id="navbar">
    <a href="#home" class="nav-logo" id="nav-logo-link"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="16" x="4" y="4" rx="2"/><rect width="6" height="6" x="9" y="9" rx="1"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 15h2"/><path d="M2 9h2"/><path d="M20 15h2"/><path d="M20 9h2"/><path d="M9 2v2"/><path d="M9 20v2"/></svg><span>AI Digital Crew</span></a>
    <div class="nav-links">
      <a href="#home" data-nav="home">Home</a>
      <a href="#projects" data-nav="home">Projects</a>
      <a href="#" data-nav="search" id="nav-search-link">Search</a>
      <a href="#trending" data-nav="trending" id="nav-trending-link">Trending</a>
    </div>
    <div class="nav-right" id="nav-right" style="visibility:hidden"></div>
    <div class="mobile-nav-icons">
      <button class="mobile-nav-icon" id="mobile-search-btn" aria-label="Search"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg></button>
      <button class="mobile-nav-icon" id="mobile-trending-btn" aria-label="Trending"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg></button>
    </div>
    <button class="hamburger" id="hamburger" aria-label="Open menu"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg></button>
    <div class="mobile-menu" id="mobile-menu"></div>
    <div class="avatar-dropdown glass" id="avatar-dropdown"></div>
  </nav>

  <main>
    <section id="home" class="hero">
      <h1>AI Tools Built by the Community</h1>
      <p class="subtitle">Discover open-source AI projects, share your own, and connect with builders. Every project syncs live from GitHub.</p>
      <div class="hero-ctas">
        <a href="#projects" class="btn-outlined">Browse Projects</a>
      </div>
      <div class="stats-bar" id="stats-bar">
        <div class="stat-pill glass"><span class="stat-number" id="stat-projects" data-target="0">0</span><span class="stat-label"> Projects</span></div>
        <div class="stat-pill glass"><span class="stat-number" id="stat-stars" data-target="0">0</span><span class="stat-label"> Total Stars</span></div>
        <div class="stat-pill glass"><span class="stat-number" data-target="100">0</span><span class="stat-label">% Open Source</span></div>
      </div>
    </section>

    <section id="featured-section" class="featured-section" style="display:none">
      <div class="section-container">
        <div id="featured-spotlight" class="featured-spotlight glass"></div>
      </div>
    </section>

    <section id="search-page" style="display:none;min-height:100vh;padding-top:120px">
      <div class="section-container">
        <div class="search-page-header">
          <h2 class="section-title">AI Search</h2>
          <p class="section-subtitle">Search across our catalog and discover projects on GitHub</p>
        </div>
        <div class="search-container" id="search-container" style="margin-top:24px;margin-bottom:24px">
          <div class="search-input-wrap">
            <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input type="text" class="search-input" id="search-input" placeholder="Describe what you're looking for..." autocomplete="off" aria-label="Search AI projects">
            <div class="search-spinner" id="search-spinner"></div>
            <button class="search-clear" id="search-clear" aria-label="Clear search"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
          </div>
          <div class="search-discovery glass" id="search-discovery"></div>
          <div class="search-autocomplete glass" id="search-autocomplete"></div>
        </div>
        <div class="hero-trending" id="hero-trending" style="margin-bottom:32px"></div>
        <div class="search-status" id="search-status"></div>
        <div class="did-you-mean" id="did-you-mean"></div>
        <div class="project-grid" id="search-result-grid"></div>
        <div id="github-discovery-container"></div>
      </div>
    </section>

    <section id="projects" style="display:none">
      <div class="section-container">
        <div class="section-header">
          <div>
            <h2 class="section-title">Projects by Category</h2>
            <p class="section-subtitle">Live from GitHub — stars, descriptions, and topics update automatically</p>
          </div>
          <button class="btn-primary btn-small" id="section-submit-btn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg> Submit Project</button>
        </div>
        <div class="category-tabs" id="category-tabs"></div>
        <div class="project-grid" id="project-grid"></div>
      </div>
    </section>

    <!-- Trending Page (lazy-loaded SPA view) -->
    <div id="trending-page" style="display:none">
      <section class="radar-hero">
        <h1>Trending Projects</h1>
        <p class="subtitle">Track which AI projects are gaining stars, forks, and momentum. Updated daily.</p>
        <p class="hero-freshness" id="hero-freshness"></p>
        <div class="hero-stats">
          <div class="hero-stat glass">
            <div class="stat-num" id="stat-tracked" data-target="0">0</div>
            <div class="stat-lbl">Tracked</div>
          </div>
          <div class="hero-stat glass">
            <div class="stat-num" id="stat-hot" data-target="0">0</div>
            <div class="stat-lbl">Hot</div>
          </div>
          <div class="hero-stat glass">
            <div class="stat-num" id="stat-rising" data-target="0">0</div>
            <div class="stat-lbl">Rising</div>
          </div>
          <div class="hero-stat glass">
            <div class="stat-num" id="stat-stars-week" data-target="0">0</div>
            <div class="stat-lbl">Stars This Week</div>
          </div>
        </div>
        <div class="time-toggle" id="time-toggle">
          <button class="time-btn" data-range="1d">24h</button>
          <button class="time-btn active" data-range="7d">7d</button>
          <button class="time-btn" data-range="30d">30d</button>
          <button class="time-btn" data-range="all">All</button>
        </div>
      </section>

      <div id="recap-banner-container" class="section-container" style="display:none"></div>

      <section id="category-leaderboard-section">
        <div class="section-container">
          <div class="section-header">
            <div class="section-title"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg> Category Leaderboards</div>
            <p class="section-subtitle">Top projects by momentum in each category</p>
          </div>
          <div class="cat-lb-tabs" id="cat-lb-tabs"></div>
          <div id="cat-lb-content"></div>
        </div>
      </section>

      <section id="ai-top25-section">
        <div class="section-container">
          <div class="section-header">
            <div class="section-title"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg> AI Trending &mdash; Top 25</div>
            <p class="section-subtitle">The hottest AI &amp; ML projects right now</p>
          </div>
          <div class="filter-bar" id="ai-filter-bar">
            <div class="filter-group">
              <span class="filter-label">Category</span>
              <select class="filter-select" id="ai-filter-category"><option value="All">All</option></select>
            </div>
            <div class="filter-group">
              <span class="filter-label">Language</span>
              <select class="filter-select" id="ai-filter-language"><option value="All">All</option></select>
            </div>
            <div class="filter-group">
              <div class="trnd-search-wrap">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                <input type="text" class="trnd-search-input" id="ai-filter-search" placeholder="Search AI projects...">
              </div>
            </div>
          </div>
          <div id="ai-top25">
            <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
            <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
            <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
          </div>
          <div class="pagination" id="ai-pagination"></div>
        </div>
      </section>

      <section id="global-top25-section">
        <div class="section-container">
          <div class="section-header">
            <div class="section-title"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg> Global Trending</div>
            <p class="section-subtitle">Fastest growing projects on GitHub</p>
          </div>
          <div class="filter-bar" id="global-filter-bar">
            <div class="filter-group">
              <span class="filter-label">Category</span>
              <select class="filter-select" id="global-filter-category"><option value="All">All</option></select>
            </div>
            <div class="filter-group">
              <span class="filter-label">Language</span>
              <select class="filter-select" id="global-filter-language"><option value="All">All</option></select>
            </div>
            <div class="filter-group">
              <div class="trnd-search-wrap">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                <input type="text" class="trnd-search-input" id="global-filter-search" placeholder="Search projects...">
              </div>
            </div>
            <div class="view-toggle" id="global-view-toggle">
              <button class="view-toggle-btn active" data-view="cards"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg> Cards</button>
              <button class="view-toggle-btn" data-view="table"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18"/><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/></svg> Table</button>
            </div>
          </div>
          <div id="global-top25">
            <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
            <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
            <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
          </div>
          <div class="rankings-table-wrap" id="global-table-wrap" style="display:none">
            <table class="rankings-table" id="global-rankings-table"></table>
          </div>
          <div class="pagination" id="global-pagination"></div>
        </div>
      </section>

      <section id="movers-section">
        <div class="section-container">
          <div class="section-header">
            <div class="section-title"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg> Gainers &amp; Cooling</div>
            <p class="section-subtitle">Projects with the biggest moves</p>
          </div>
          <div class="movers-controls">
            <div class="movers-tab-group" id="movers-tab-group">
              <button class="movers-tab active" data-tab="gainers"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg> Gainers</button>
              <button class="movers-tab" data-tab="cooling"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h10"/><path d="M9 4v16"/><path d="m3 9 3 3-3 3"/><path d="M12 6 9 9 6 6"/><path d="m6 18 3-3 1.5 1.5"/><path d="M20 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/></svg> Cooling</button>
            </div>
            <div class="movers-time-toggle" id="movers-time-toggle">
              <button class="movers-tab" data-range="1d">24h</button>
              <button class="movers-tab active" data-range="7d">7d</button>
            </div>
          </div>
          <div class="movers-grid">
            <div class="movers-card" id="movers-pct">
              <div class="movers-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#34d399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" x2="5" y1="5" y2="19"/><circle cx="6.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="17.5" r="2.5"/></svg> By % Growth</div>
              <div id="movers-pct-list"></div>
            </div>
            <div class="movers-card" id="movers-abs">
              <div class="movers-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"/></svg> By Star Count</div>
              <div id="movers-abs-list"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="developers-section">
        <div class="section-container">
          <div class="section-header">
            <div class="section-title"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#34d399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg> Trending Developers</div>
            <p class="section-subtitle">Developers with the most momentum across their projects</p>
          </div>
          <div class="dev-grid" id="dev-grid"></div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <div class="footer-grid">
      <div class="footer-col">
        <p class="footer-heading">AI Digital Crew</p>
        <a href="#projects">Projects</a>
        <a href="#trending">Trending</a>
        <a href="https://github.com/ariv14" target="_blank" rel="noopener">GitHub</a>
        <a href="/privacy.html">Privacy Policy</a>
        <a href="/terms.html">Terms of Service</a>
        <a href="/data-deletion.html">Data Deletion</a>
      </div>
      <div class="footer-col" id="footer-featured-col">
        <p class="footer-heading">🤖 Today's Pick</p>
        <span style="color:var(--text-muted);font-size:14px">Loading...</span>
      </div>
      <div class="footer-col">
        <p class="footer-heading">Support</p>
        <a href="https://github.com/ariv14/ai-digital-crew/issues" target="_blank" rel="noopener">Report an Issue</a>
        <a href="mailto:support@aidigitalcrew.com">support@aidigitalcrew.com</a>
      </div>
    </div>
    <div class="footer-social">
      <a href="https://github.com/ariv14" target="_blank" rel="noopener" aria-label="GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg></a>
    </div>
    <div class="footer-bottom">
      <a href="https://aidigitalcrew.substack.com" target="_blank" rel="noopener" style="color:var(--primary);font-weight:500">📬 Subscribe to Project of the Day →</a>
      <span style="margin:0 12px;opacity:.4">|</span>
      AI Digital Crew &copy; 2026 — Open source, community driven
    </div>
  </footer>

  <div id="toast-container"></div>
  <div class="auth-overlay" id="auth-overlay"><div class="auth-overlay-spinner"></div><div class="auth-overlay-text">Connecting...</div></div>

  <!-- Login Modal -->
  <div class="modal-overlay" id="login-modal" role="dialog" aria-modal="true" aria-label="Login">
    <div class="modal glass">
      <button class="modal-close" id="login-close" aria-label="Close"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
      <h2>Join AI Digital Crew</h2>
      <p class="modal-subtitle">Sign in to submit your AI projects.</p>
      <button class="oauth-btn github" id="btn-github"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>Continue with GitHub</button>
      <button class="oauth-btn google" id="btn-google">
        <svg style="width:20px;height:20px" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
        Continue with Google
      </button>
      <button class="oauth-btn facebook" id="btn-facebook">
        <svg style="width:20px;height:20px" viewBox="0 0 24 24" fill="white"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
        Continue with Facebook
      </button>
    </div>
  </div>

  <!-- Submit Project Modal -->
  <div class="modal-overlay" id="submit-modal" role="dialog" aria-modal="true" aria-label="Submit project">
    <div class="modal glass">
      <button class="modal-close" id="submit-close" aria-label="Close"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
      <h2>Submit a Project</h2>
      <p class="modal-subtitle">Paste a public GitHub repo URL. We'll pull the details automatically.</p>
      <form id="submit-form" novalidate>
        <div class="form-group">
          <label for="repo-url">GitHub Repository URL</label>
          <input type="url" id="repo-url" placeholder="https://github.com/username/repo" required>
          <div class="form-error" id="repo-error">Enter a valid GitHub repo URL (e.g. https://github.com/user/repo)</div>
        </div>
        <div class="repo-preview glass" id="repo-preview">
          <h4 id="preview-name"></h4>
          <p id="preview-desc"></p>
          <div class="repo-meta">
            <span><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"/></svg> <span id="preview-stars">0</span></span>
            <span><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><circle cx="18" cy="6" r="3"/><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"/><path d="M12 12v3"/></svg> <span id="preview-forks">0</span></span>
            <span id="preview-lang"></span>
          </div>
        </div>
        <button type="submit" class="btn-primary" style="width:100%;justify-content:center;margin-top:16px" id="submit-btn" disabled>Submit Project</button>
      </form>
    </div>
  </div>

  <script type="module">
    // Firebase SDK loaded via dynamic import() — unblocks DOM setup, skeletons,
    // stat animations, and icon rendering while Firebase downloads in parallel.
    let app, auth, db;
    let initializeApp, getAuth, signInWithPopup, signInWithCredential, linkWithCredential,
        deleteUser, GithubAuthProvider, GoogleAuthProvider, FacebookAuthProvider, OAuthProvider,
        onAuthStateChanged, signOut, getFirestore, collection, addDoc, getDocs, getDoc,
        deleteDoc, doc, query, where, serverTimestamp;

    // ============================================================
    // FIREBASE CONFIG — environment detection by hostname
    // ============================================================
    const STAGING_HOSTS = ['staging.aidigitalcrew.com', 'localhost', '127.0.0.1'];
    const isStaging = STAGING_HOSTS.includes(location.hostname);

    const firebaseConfig = isStaging
      ? {
          apiKey: "AIzaSyAH9dWeeHoH6v_UvnhpvLUKoqsm3rrdCPQ",
          authDomain: "ai-digital-crew-staging.firebaseapp.com",
          projectId: "ai-digital-crew-staging",
          storageBucket: "ai-digital-crew-staging.firebasestorage.app",
          messagingSenderId: "155089534574",
          appId: "1:155089534574:web:542a7df0b8c809f22c707f"
        }
      : {
          apiKey: "AIzaSyDq4iZ6y90S9KOsPRP0774iYGu4fXzH-4s",
          authDomain: "ai-digital-crew.firebaseapp.com",
          projectId: "ai-digital-crew",
          storageBucket: "ai-digital-crew.firebasestorage.app",
          messagingSenderId: "67125394484",
          appId: "1:67125394484:web:85f3da113a0b09aeb39e61",
          measurementId: "G-4VHGMK995P"
        };

    if (isStaging) document.title = '[STAGING] ' + document.title;

    const firebaseReady = (async () => {
      const [appMod, fsMod] = await Promise.all([
        import('https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js'),
        import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-lite.js')
      ]);
      ({ initializeApp } = appMod);
      ({ getFirestore, collection, addDoc, getDocs, getDoc, deleteDoc, doc, query,
         where, serverTimestamp } = fsMod);
      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
    })();

    let _authReady;
    function ensureAuth() {
      if (!_authReady) {
        _authReady = (async () => {
          await firebaseReady;
          const authMod = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js');
          ({ getAuth, signInWithPopup, signInWithCredential, linkWithCredential, deleteUser,
             GithubAuthProvider, GoogleAuthProvider, FacebookAuthProvider, OAuthProvider,
             onAuthStateChanged, signOut } = authMod);
          auth = getAuth(app);
        })();
      }
      return _authReady;
    }

    let getQueryEmbeddingFn = null;
    async function loadFunctions() {
      await firebaseReady;
      if (getQueryEmbeddingFn) return getQueryEmbeddingFn;
      const { getFunctions, httpsCallable } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-functions.js');
      const functions = getFunctions(app);
      getQueryEmbeddingFn = httpsCallable(functions, 'getQueryEmbedding');
      return getQueryEmbeddingFn;
    }

    const LANG_COLORS = {TypeScript:'#3178c6',JavaScript:'#f1e05a',Python:'#3572A5',Rust:'#dea584',Go:'#00ADD8',Java:'#b07219',Ruby:'#701516',C:'#555555','C++':'#f34b7d','C#':'#178600',Swift:'#F05138',Kotlin:'#A97BFF',Shell:'#89e051'};

    const CATEGORY_TOPICS = {
      'AI Agents':         ['ai-agents', 'llm-agent', 'autonomous-agents', 'multi-agent', 'mcp', 'computer-use'],
      'LLM / GenAI':       ['llm', 'generative-ai', 'large-language-model', 'rag', 'fine-tuning', 'prompt-engineering'],
      'Data Science':      ['data-science', 'machine-learning', 'deep-learning', 'neural-network', 'mlops'],
      'Big Data':          ['big-data', 'data-engineering', 'data-pipeline', 'apache-spark', 'dbt', 'streaming'],
      'DevTools':          ['developer-tools', 'cli', 'devops', 'platform-engineering', 'observability'],
      'Web / Frontend':    ['react', 'nextjs', 'svelte', 'vue', 'typescript', 'tailwindcss', 'webassembly'],
      'Backend / APIs':    ['fastapi', 'rest-api', 'graphql', 'microservices', 'nodejs', 'grpc', 'api'],
      'Mobile':            ['react-native', 'flutter', 'ios', 'android', 'swift', 'kotlin'],
      'Security':          ['security', 'cybersecurity', 'privacy', 'zero-trust', 'pentesting', 'devsecops'],
      'Cloud / Infra':     ['kubernetes', 'docker', 'terraform', 'cloud-native', 'serverless', 'infrastructure'],
      'Blockchain / Web3': ['blockchain', 'web3', 'defi', 'smart-contracts', 'ethereum', 'solidity'],
      'Database':          ['postgresql', 'mongodb', 'redis', 'vector-database', 'sqlite', 'nosql'],
    };
    const CATEGORY_ORDER = ['All', 'AI Agents', 'LLM / GenAI', 'Data Science', 'Big Data', 'DevTools',
      'Web / Frontend', 'Backend / APIs', 'Mobile', 'Security', 'Cloud / Infra', 'Blockchain / Web3', 'Database', 'Other'];

    const AI_SOURCES = ['trending-ai', 'auto'];
    const AI_CATEGORY_TOPICS = {
      'AI Agents':    ['ai-agents', 'llm-agent', 'autonomous-agents', 'multi-agent', 'mcp', 'computer-use'],
      'LLM / GenAI':  ['llm', 'generative-ai', 'large-language-model', 'rag', 'fine-tuning', 'prompt-engineering'],
      'Data Science':  ['data-science', 'machine-learning', 'deep-learning', 'neural-network', 'mlops'],
    };

    function inferCategory(project) {
      if (project.category) return project.category;
      const topics = (project.topics || []).map(t => t.toLowerCase());
      for (const [cat, keywords] of Object.entries(CATEGORY_TOPICS)) {
        if (keywords.some(kw => topics.includes(kw))) return cat;
      }
      return 'Other';
    }

    function isAiProject(p) {
      if (AI_SOURCES.includes(p.source)) return true;
      const topics = (p.topics || []).map(t => t.toLowerCase());
      for (const keywords of Object.values(AI_CATEGORY_TOPICS)) {
        if (keywords.some(kw => topics.includes(kw))) return true;
      }
      return false;
    }

    function isNewThisWeek(p) {
      if (!p.autoAddedDate && !p.createdAt) return false;
      const addedStr = p.autoAddedDate || '';
      const addedDate = addedStr ? new Date(addedStr) : (p.createdAt?.toDate ? p.createdAt.toDate() : new Date(p.createdAt));
      const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
      return addedDate.getTime() > weekAgo;
    }

    const state = { user: null, isLoggedIn: false, projects: [], isLoading: true, repoPreview: null, activeCategory: 'All', searchQuery: '', searchResults: null, isSearching: false, githubResults: null, searchCache: new Map(), githubResultsCache: new Map(), lastGitHubApiCall: 0, currentView: 'home', trendingLoaded: false, trendingProjects: [], trendingAiProjects: [], trendingGlobalProjects: [], trendSort: 'momentum', trendTimeRange: '7d', aiFilter: { category: 'All', language: 'All', search: '', page: 1 }, globalFilter: { category: 'All', language: 'All', search: '', page: 1 }, globalView: 'cards', globalTableSort: { col: 'momentum', dir: 'desc' }, moversTab: 'gainers', moversRange: '7d', catLbActive: null };

    const navRight = document.getElementById('nav-right');
    const hamburgerBtn = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileSearchBtn = document.getElementById('mobile-search-btn');
    mobileSearchBtn.addEventListener('click', () => { mobileMenu.classList.remove('open'); navigateTo('search'); });
    const mobileTrendingBtn = document.getElementById('mobile-trending-btn');
    mobileTrendingBtn.addEventListener('click', () => { mobileMenu.classList.remove('open'); navigateTo('trending'); });
    const avatarDropdown = document.getElementById('avatar-dropdown');
    const loginModal = document.getElementById('login-modal');
    const submitModal = document.getElementById('submit-modal');
    const projectGrid = document.getElementById('project-grid');
    const toastContainer = document.getElementById('toast-container');
    const repoUrlInput = document.getElementById('repo-url');
    const repoPreview = document.getElementById('repo-preview');
    const submitBtn = document.getElementById('submit-btn');

    // ── Navigation ───────────────────────────────────────
    function navigateTo(view, skipHash) {
      state.currentView = view;
      const home = document.getElementById('home');
      const featured = document.getElementById('featured-section');
      const projects = document.getElementById('projects');
      const searchPage = document.getElementById('search-page');
      const trendingPage = document.getElementById('trending-page');

      // Hide all views first
      home.style.display = 'none';
      featured.style.display = 'none';
      projects.style.display = 'none';
      searchPage.style.display = 'none';
      trendingPage.style.display = 'none';

      if (view === 'search') {
        searchPage.style.display = '';
        document.getElementById('search-input').focus();
      } else if (view === 'trending') {
        trendingPage.style.display = '';
        loadTrendingData();
      } else {
        // home view
        home.style.display = '';
        if (state.projects.find(p => p.source === 'auto')) featured.style.display = '';
        projects.style.display = '';
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });

      // Update URL hash to reflect current view
      if (!skipHash) {
        const hash = view === 'search' ? '#search' : view === 'trending' ? '#trending' : '#home';
        if (location.hash !== hash) history.pushState(null, '', hash);
      }

      // Update nav-active classes
      document.querySelectorAll('.nav-links a, .mobile-menu a').forEach(a => {
        a.classList.toggle('nav-active', a.dataset.nav === view);
      });
    }

    // Wire nav logo to go home
    document.getElementById('nav-logo-link').addEventListener('click', (e) => { e.preventDefault(); navigateTo('home'); });
    // Wire desktop nav search link
    document.getElementById('nav-search-link').addEventListener('click', (e) => { e.preventDefault(); navigateTo('search'); });
    // Wire desktop nav trending link
    document.getElementById('nav-trending-link').addEventListener('click', (e) => { e.preventDefault(); navigateTo('trending'); });

    // Handle initial hash/path for cross-page navigation
    // Support old /trending URL (rewritten to index.html by hosting)
    if (location.pathname === '/trending') {
      history.replaceState(null, '', '/#trending');
      navigateTo('trending', true);
    } else if (location.hash === '#search') navigateTo('search', true);
    else if (location.hash === '#trending') navigateTo('trending', true);

    // Handle browser back/forward
    window.addEventListener('popstate', () => {
      if (location.hash === '#search') navigateTo('search', true);
      else if (location.hash === '#trending') navigateTo('trending', true);
      else navigateTo('home', true);
    });

    // Wire Home/Projects links to go back to home view
    document.querySelectorAll('.nav-links a[data-nav="home"]').forEach(a => {
      a.addEventListener('click', () => {
        if (state.currentView !== 'home') navigateTo('home');
      });
    });

    // ── GitHub API ──────────────────────────────────────
    function parseRepoUrl(url) {
      const m = url.trim().match(/github\.com\/([^/]+)\/([^/\s#?]+)/);
      if (!m) return null;
      return { owner: m[1], repo: m[2].replace(/\.git$/, '') };
    }

    let _ghRateLimitOk = true;
    async function fetchRepoData(owner, repo) {
      if (!_ghRateLimitOk) return null;
      const res = await fetch(`https://api.github.com/repos/${owner}/${repo}`);
      if (res.status === 403 || res.status === 429) { _ghRateLimitOk = false; return null; }
      if (!res.ok) return null;
      const remaining = res.headers.get('x-ratelimit-remaining');
      if (remaining !== null && parseInt(remaining, 10) <= 1) _ghRateLimitOk = false;
      const d = await res.json();
      return {
        fullName: d.full_name,
        name: d.name,
        owner: d.owner.login,
        ownerAvatar: d.owner.avatar_url,
        description: d.description || 'No description provided.',
        stars: d.stargazers_count,
        forks: d.forks_count,
        language: d.language,
        topics: d.topics || [],
        url: d.html_url
      };
    }

    // ── Render ──────────────────────────────────────────
    function renderNavbar() {
      if (state.isLoggedIn) {
        const photo = state.user.photoURL || `https://api.dicebear.com/7.x/avataaars/svg?seed=${state.user.uid}`;
        navRight.innerHTML = `
          <button class="btn-primary btn-small" id="nav-submit-btn">${icon('plus', 14)} Submit</button>
          <img src="${photo}" alt="Avatar" class="nav-avatar" id="nav-avatar" width="36" height="36" referrerpolicy="no-referrer">
        `;
        avatarDropdown.innerHTML = `
          <a href="#">${icon('user', 16)}${state.user.displayName || 'Profile'}</a>
          <div class="dropdown-divider"></div>
          <button id="logout-btn">${icon('log-out', 16)}Logout</button>
          <button id="delete-account-btn" style="color:var(--error)">${icon('trash-2', 16)}Delete Account</button>
        `;
        document.getElementById('nav-submit-btn').addEventListener('click', openSubmitModal);
        document.getElementById('nav-avatar').addEventListener('click', (e) => { e.stopPropagation(); avatarDropdown.classList.toggle('open'); });
        document.getElementById('logout-btn').addEventListener('click', logout);
        document.getElementById('delete-account-btn').addEventListener('click', deleteAccount);
      } else {
        navRight.innerHTML = `<button class="btn-outlined btn-small" id="nav-login-btn">Login / Join</button>`;
        avatarDropdown.innerHTML = '';
        avatarDropdown.classList.remove('open');
        document.getElementById('nav-login-btn').addEventListener('click', openLoginModal);
      }
      mobileMenu.innerHTML = `
        <a href="#home" data-nav="home">Home</a><a href="#projects" data-nav="home">Projects</a><a href="#" data-nav="search" id="mobile-search-link">Search</a><a href="#trending" data-nav="trending" id="mobile-trending-link">Trending</a>
        ${state.isLoggedIn
          ? `<button id="mobile-logout">Logout</button>`
          : `<button id="mobile-login">Login / Join</button>`}
      `;
      // Close menu on any nav link click
      mobileMenu.querySelectorAll('a[data-nav]').forEach(a => {
        a.addEventListener('click', (e) => {
          e.preventDefault(); mobileMenu.classList.remove('open');
          const target = a.getAttribute('href');
          if (a.dataset.nav === 'search') { navigateTo('search'); }
          else if (a.dataset.nav === 'trending') { navigateTo('trending'); }
          else { navigateTo('home'); if (target === '#projects') setTimeout(() => document.getElementById('projects')?.scrollIntoView({ behavior: 'smooth' }), 50); }
        });
      });
      const ml = document.getElementById('mobile-login');
      if (ml) ml.addEventListener('click', () => { mobileMenu.classList.remove('open'); openLoginModal(); });
      const mlo = document.getElementById('mobile-logout');
      if (mlo) mlo.addEventListener('click', () => { mobileMenu.classList.remove('open'); logout(); });

    }

    function renderSkeletons() {
      let h = '';
      for (let i = 0; i < 3; i++) h += `<div class="skeleton-card glass visible"><div class="skeleton-banner"></div><div class="skeleton-body"><div class="skeleton-line title"></div><div class="skeleton-line short"></div><div class="skeleton-line long"></div><div class="skeleton-line medium"></div></div></div>`;
      projectGrid.innerHTML = h;
    }

    function renderProjects() {
      if (state.isLoading) { renderSkeletons(); return; }
      if (state.projects.length === 0) {
        projectGrid.innerHTML = `<div class="empty-state">${icon('folder-open', 48)}<p>No projects yet. Be the first to submit one!</p><button class="btn-primary" id="empty-submit">Submit a Project</button></div>`;
        document.getElementById('empty-submit').addEventListener('click', () => { state.isLoggedIn ? openSubmitModal() : openLoginModal(); });
  
        return;
      }

      const filtered = state.activeCategory === 'All'
        ? state.projects
        : state.projects.filter(p => inferCategory(p) === state.activeCategory);

      if (filtered.length === 0) {
        projectGrid.innerHTML = `<div class="empty-state">${icon('folder-open', 48)}<p>No projects in this category yet.</p></div>`;
  
        return;
      }

      projectGrid.innerHTML = filtered.map(p => {
        const langColor = LANG_COLORS[p.language] || '#888';
        const topics = (p.topics || []).slice(0, 5);
        const cat = inferCategory(p);
        return `
          <div class="project-card glass">
            <div class="project-banner">
              ${p.ownerAvatar ? `<img src="${avatarSized(p.ownerAvatar, 96)}" alt="${esc(p.owner)}" width="48" height="48" loading="lazy">` : `<span class="initial">${(p.name||'P').charAt(0).toUpperCase()}</span>`}
              ${p.source === 'auto' ? '<span class="auto-badge">🤖 Daily Pick</span>' : ''}
            </div>
            <div class="project-body">
              <div class="project-name"><a href="${esc(p.url)}" target="_blank" rel="noopener">${esc(p.name)}</a></div>
              <div class="project-owner">${esc(p.owner)}</div>
              <p class="project-desc">${esc(p.writeup || p.description)}</p>
              ${p.quickStart && p.quickStart.length ? `<details class="quick-start"><summary>Quick Start</summary><ol>${p.quickStart.map(s => `<li>${esc(s)}</li>`).join('')}</ol></details>` : ''}
              <div class="project-topics">${topics.map(t => `<span class="project-topic">${esc(t)}</span>`).join('')}</div>
              <span class="category-badge">${esc(cat)}</span>
              <div class="project-stats">
                <span>${icon('star', 14)} ${p.stars.toLocaleString()}</span>
                <span>${icon('git-fork', 14)} ${p.forks.toLocaleString()}</span>
                ${p.language ? `<span><span class="project-lang-dot" style="background:${langColor}"></span> ${esc(p.language)}</span>` : ''}
              </div>
            </div>
          </div>`;
      }).join('');


      observeCards();
      updateStats();
    }

    function renderFeatured() {
      const section = document.getElementById('featured-section');
      const spotlight = document.getElementById('featured-spotlight');
      const footerCol = document.getElementById('footer-featured-col');

      const featured = state.projects.find(p => p.source === 'auto');
      if (!featured) {
        section.style.display = 'none';
        if (footerCol) footerCol.innerHTML = `<p class="footer-heading">🤖 Today's Pick</p><span style="color:var(--text-muted);font-size:14px">Coming soon</span>`;
        return;
      }

      section.style.display = state.currentView === 'home' ? '' : 'none';
      const langColor = LANG_COLORS[featured.language] || '#888';
      const topics = (featured.topics || []).slice(0, 5);
      const avatar = featured.ownerAvatar
        ? `<img src="${avatarSized(featured.ownerAvatar, 144)}" alt="${esc(featured.owner)}" class="featured-avatar" width="72" height="72" loading="lazy">`
        : `<div class="featured-avatar-initial">${(featured.name||'P').charAt(0).toUpperCase()}</div>`;

      spotlight.innerHTML = `
        <div class="featured-label">
          ${icon('sparkles', 14)} Today's AI Project of the Day
          <span>${featured.autoAddedDate || ''}</span>
        </div>
        <div class="featured-body">
          <div>${avatar}</div>
          <div>
            <div class="featured-name"><a href="${esc(featured.url)}" target="_blank" rel="noopener">${esc(featured.name)}</a></div>
            <div class="featured-owner">by ${esc(featured.owner)}</div>
            <p class="featured-writeup">${esc(featured.writeup || featured.description)}</p>
            ${featured.quickStart && featured.quickStart.length ? `<div class="featured-qs"><div class="qs-label">⚡ Quick Start</div><ol>${featured.quickStart.map(s => `<li>${esc(s)}</li>`).join('')}</ol></div>` : ''}
            <div class="featured-footer">
              ${topics.map(t => `<span class="project-topic">${esc(t)}</span>`).join('')}
              <a href="${esc(featured.url)}" target="_blank" rel="noopener" class="btn-primary btn-small" style="margin-left:auto">${icon('github', 14)} View on GitHub</a>
              <span style="display:flex;align-items:center;gap:4px;font-size:13px;color:var(--text-muted)">${icon('star', 13)} ${(featured.stars||0).toLocaleString()}</span>
            </div>
          </div>
        </div>`;

      if (footerCol) footerCol.innerHTML = `
        <p class="footer-heading">🤖 Today's Pick</p>
        <a href="${esc(featured.url)}" target="_blank" rel="noopener">${esc(featured.name)}</a>
        <a href="${esc(featured.url)}" target="_blank" rel="noopener" style="color:var(--text-muted);font-size:13px">⭐ ${(featured.stars||0).toLocaleString()} stars</a>
        <a href="https://aidigitalcrew.substack.com" target="_blank" rel="noopener">📬 Subscribe</a>`;


    }

    function renderCategoryTabs() {
      const tabsEl = document.getElementById('category-tabs');
      if (!tabsEl) return;

      // Count projects per category
      const counts = {};
      for (const p of state.projects) {
        const cat = inferCategory(p);
        counts[cat] = (counts[cat] || 0) + 1;
      }
      counts['All'] = state.projects.length;

      const visibleCategories = CATEGORY_ORDER.filter(cat => cat === 'All' || (counts[cat] || 0) > 0);

      tabsEl.innerHTML = visibleCategories.map(cat => {
        const count = counts[cat] || 0;
        const isActive = state.activeCategory === cat;
        return `<button class="category-tab${isActive ? ' active' : ''}" data-cat="${esc(cat)}">${esc(cat)} ${count}</button>`;
      }).join('');

      tabsEl.querySelectorAll('.category-tab').forEach(btn => {
        btn.addEventListener('click', () => {
          state.activeCategory = btn.dataset.cat;
          renderCategoryTabs();
          renderProjects();
        });
      });
    }

    function updateStats() {
      const projEl = document.getElementById('stat-projects');
      const starEl = document.getElementById('stat-stars');
      projEl.dataset.target = state.projects.length;
      starEl.dataset.target = state.projects.reduce((s, p) => s + (p.stars || 0), 0);
      animateStats();
    }

    // ── Modals ──────────────────────────────────────────
    function lockBodyScroll() { document.body.classList.add('modal-open'); }
    function unlockBodyScroll() { document.body.classList.remove('modal-open'); }

    // ── Focus Trap ──────────────────────────────────────
    let _focusTrapCleanup = null;
    let _previouslyFocused = null;
    function trapFocus(modal) {
      _previouslyFocused = document.activeElement;
      const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      if (!focusable.length) return;
      const first = focusable[0];
      const last = focusable[focusable.length - 1];
      first.focus();
      function onKeyDown(e) {
        if (e.key === 'Tab') {
          if (e.shiftKey) {
            if (document.activeElement === first) { e.preventDefault(); last.focus(); }
          } else {
            if (document.activeElement === last) { e.preventDefault(); first.focus(); }
          }
        }
      }
      modal.addEventListener('keydown', onKeyDown);
      _focusTrapCleanup = () => modal.removeEventListener('keydown', onKeyDown);
    }
    function releaseFocusTrap() {
      if (_focusTrapCleanup) { _focusTrapCleanup(); _focusTrapCleanup = null; }
      if (_previouslyFocused) { _previouslyFocused.focus(); _previouslyFocused = null; }
    }

    function openLoginModal() { loginModal.classList.add('open'); lockBodyScroll(); trapFocus(loginModal); }
    function closeLoginModal() { loginModal.classList.remove('open'); unlockBodyScroll(); enableOAuthButtons(); releaseFocusTrap(); }
    function openSubmitModal() {
      if (!state.isLoggedIn) { openLoginModal(); return; }
      submitModal.classList.add('open');
      lockBodyScroll();
      repoUrlInput.value = '';
      repoPreview.classList.remove('show');
      submitBtn.disabled = true;
      state.repoPreview = null;
      document.getElementById('repo-error').classList.remove('show');
      trapFocus(submitModal);
    }
    function closeSubmitModal() { submitModal.classList.remove('open'); unlockBodyScroll(); releaseFocusTrap(); }

    // ── Auth ────────────────────────────────────────────
    const authOverlay = document.getElementById('auth-overlay');
    function showAuthOverlay() { authOverlay.classList.add('active'); }
    function hideAuthOverlay() { authOverlay.classList.remove('active'); }

    function enableOAuthButtons() {
      loginModal.querySelectorAll('.oauth-btn').forEach(b => { b.disabled = false; if (b.dataset.label) b.innerHTML = b.dataset.label; });
      hideAuthOverlay();
    }
    function setLoading(btn) {
      loginModal.querySelectorAll('.oauth-btn').forEach(b => b.disabled = true);
      btn.dataset.label = btn.innerHTML;
      btn.innerHTML = `<div class="oauth-spinner"></div> Connecting...`;
      showAuthOverlay();
    }

    const providerNames = { 'google.com': 'Google', 'github.com': 'GitHub', 'facebook.com': 'Facebook' };

    async function handleOAuthError(err, providerName) {
      if (err.code === 'auth/account-exists-with-different-credential') {
        const email = err.customData?.email;
        const pendingCred = OAuthProvider.credentialFromError(err);
        // Store pending credential so we can link after sign-in with existing provider
        state.pendingLinkCred = pendingCred;
        state.pendingLinkProvider = providerName;
        // Determine which providers the user could try (exclude the one that just failed)
        const otherProviders = Object.values(providerNames).filter(n => n !== providerName);
        const suggestion = email
          ? `${email} is already registered. Sign in with ${otherProviders.join(' or ')} to link your ${providerName} account.`
          : `This email is already registered. Sign in with ${otherProviders.join(' or ')} to link your ${providerName} account.`;
        showToast(suggestion, 'info', 6000);
      } else if (err.code === 'auth/popup-closed-by-user' || err.code === 'auth/cancelled-popup-request') {
        // User closed popup — no error needed
      } else {
        console.error(`${providerName} auth error:`, err);
        showToast(`Auth error: ${err.code || err.message}`, 'error');
      }
      enableOAuthButtons();
    }

    async function handleOAuthSuccess(result) {
      // If there's a pending credential from a previous failed attempt, link it now
      if (state.pendingLinkCred && result.user) {
        try {
          await linkWithCredential(result.user, state.pendingLinkCred);
          showToast(`${state.pendingLinkProvider} account linked!`, 'success');
        } catch (linkErr) {
          console.error('Account linking error:', linkErr);
          // Non-fatal — user is still signed in with the primary provider
        }
        state.pendingLinkCred = null;
        state.pendingLinkProvider = null;
      }
      hideAuthOverlay();
      closeLoginModal();
      showToast(`Welcome, ${state.user.displayName || 'friend'}!`, 'success');
    }

    async function loginWithGitHub() {
      await ensureAuth();
      const btn = document.getElementById('btn-github');
      setLoading(btn);
      try { const result = await signInWithPopup(auth, new GithubAuthProvider()); await handleOAuthSuccess(result); }
      catch (err) { await handleOAuthError(err, 'GitHub'); }
    }
    async function loginWithGoogle() {
      await ensureAuth();
      const btn = document.getElementById('btn-google');
      setLoading(btn);
      try { const result = await signInWithPopup(auth, new GoogleAuthProvider()); await handleOAuthSuccess(result); }
      catch (err) { await handleOAuthError(err, 'Google'); }
    }
    async function loginWithFacebook() {
      await ensureAuth();
      const btn = document.getElementById('btn-facebook');
      setLoading(btn);
      try { const result = await signInWithPopup(auth, new FacebookAuthProvider()); await handleOAuthSuccess(result); }
      catch (err) { await handleOAuthError(err, 'Facebook'); }
    }
    async function logout() {
      await ensureAuth();
      avatarDropdown.classList.remove('open');
      await signOut(auth);
      showToast('Signed out.', 'info');
    }

    async function deleteAccount() {
      await ensureAuth();
      avatarDropdown.classList.remove('open');
      if (!state.user) return;
      const confirmed = confirm('Are you sure you want to delete your account? This will remove your account and all your submitted projects. This cannot be undone.');
      if (!confirmed) return;
      try {
        const uid = state.user.uid;
        // Delete user's projects from Firestore
        const q = query(collection(db, 'projects'), where('submittedBy', '==', uid));
        const snap = await getDocs(q);
        const deletes = snap.docs.map(d => deleteDoc(doc(db, 'projects', d.id)));
        await Promise.all(deletes);
        // Delete Firebase Auth account
        await deleteUser(state.user);
        showToast('Account deleted successfully.', 'info');
      } catch (err) {
        if (err.code === 'auth/requires-recent-login') {
          showToast('For security, please sign out, sign back in, and try again.', 'error', 5000);
        } else {
          console.error('Delete account error:', err);
          showToast(`Error deleting account: ${err.message}`, 'error');
        }
      }
    }

    // ── Repo URL validation ─────────────────────────────
    let debounceTimer = null;
    repoUrlInput.addEventListener('input', () => {
      clearTimeout(debounceTimer);
      repoPreview.classList.remove('show');
      submitBtn.disabled = true;
      state.repoPreview = null;
      document.getElementById('repo-error').classList.remove('show');

      debounceTimer = setTimeout(async () => {
        const parsed = parseRepoUrl(repoUrlInput.value);
        if (!parsed) {
          if (repoUrlInput.value.trim()) document.getElementById('repo-error').classList.add('show');
          return;
        }
        repoUrlInput.style.borderColor = 'var(--primary)';
        const data = await fetchRepoData(parsed.owner, parsed.repo);
        repoUrlInput.style.borderColor = '';
        if (!data) { document.getElementById('repo-error').classList.add('show'); document.getElementById('repo-error').textContent = 'Repository not found or is private.'; return; }

        state.repoPreview = data;
        document.getElementById('preview-name').textContent = data.fullName;
        document.getElementById('preview-desc').textContent = data.description;
        document.getElementById('preview-stars').textContent = data.stars.toLocaleString();
        document.getElementById('preview-forks').textContent = data.forks.toLocaleString();
        document.getElementById('preview-lang').textContent = data.language || '';
        repoPreview.classList.add('show');
        submitBtn.disabled = false;
  
      }, 600);
    });

    // ── Submit project ──────────────────────────────────
    document.getElementById('submit-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      await firebaseReady;
      if (!state.repoPreview || !state.isLoggedIn) return;
      const data = state.repoPreview;

      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="oauth-spinner"></div> Submitting...';

      try {
        // Check for duplicate
        const q = query(collection(db, 'projects'), where('fullName', '==', data.fullName));
        const existing = await getDocs(q);
        if (!existing.empty) {
          showToast('This project has already been submitted.', 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Project';
          return;
        }

        await addDoc(collection(db, 'projects'), {
          ...data,
          submittedBy: state.user.uid,
          submittedByName: state.user.displayName || 'Anonymous',
          createdAt: serverTimestamp()
        });

        const newProject = { ...data, submittedBy: state.user.uid, submittedByName: state.user.displayName || 'Anonymous', createdAt: new Date().toISOString() };
        state.projects.unshift(newProject);
        // Update localStorage cache so the new project persists across refreshes
        try {
          const cached = localStorage.getItem(ADC_CACHE_KEY);
          if (cached) {
            const parsed = JSON.parse(cached);
            parsed.projects.push(newProject);
            localStorage.setItem(ADC_CACHE_KEY, JSON.stringify(parsed));
          }
        } catch {}
        closeSubmitModal();
        renderProjects();

        setTimeout(async () => {
          showToast('Project submitted!', 'success');
          try {
            if (!window.confetti) {
              await import('https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/+esm');
            }
            confetti({ particleCount: 120, spread: 70, origin: { y: 0.6 }, colors: ['#3b82f6', '#8b5cf6', '#06b6d4', '#10b981'] });
          } catch {}
        }, 100);
      } catch (err) {
        showToast('Failed to submit. Try again.', 'error');
      }
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Project';
    });

    // ── Load all projects: single-doc cache (1 Firestore read) + localStorage TTL ──
    const ADC_CACHE_KEY = 'adc_projects_cache';
    const ADC_CACHE_TTL = 3600000; // 1 hour

    function applyProjectData(allProjects) {
      // Home view: exclude trending-only projects, sort by newest
      state.projects = allProjects
        .filter(p => p.source !== 'trending-ai' && p.source !== 'trending-global')
        .sort((a, b) => {
          const ta = a.createdAt?.toDate?.() || new Date(a.createdAt || 0);
          const tb = b.createdAt?.toDate?.() || new Date(b.createdAt || 0);
          return tb - ta;
        });

      // Trending view: all projects with trend defaults
      state.trendingProjects = allProjects.map(p => ({
        ...p,
        trend_momentum: p.trend_momentum ?? 0,
        trend_label: p.trend_label ?? 'new',
        trend_stars7d: p.trend_stars7d ?? 0,
        trend_starsPct7d: p.trend_starsPct7d ?? 0,
        trend_sparkline: p.trend_sparkline ?? [],
        trend_stars1d: p.trend_stars1d ?? 0,
        trend_starsPct1d: p.trend_starsPct1d ?? 0,
        trend_forks1d: p.trend_forks1d ?? 0,
        trend_stars30d: p.trend_stars30d ?? 0,
        trend_starsPct30d: p.trend_starsPct30d ?? 0,
        trend_forks30d: p.trend_forks30d ?? 0,
        trend_sparkline30d: p.trend_sparkline30d ?? [],
      })).filter(p => p.source || p.submittedBy);
      state.trendingAiProjects = state.trendingProjects.filter(isAiProject);
      state.trendingGlobalProjects = state.trendingProjects;
      state.trendingLoaded = true;
    }

    async function loadAllProjects() {
      await firebaseReady;
      state.isLoading = true;
      try {
        // 1. Check localStorage cache
        let allProjects = null;
        try {
          const cached = localStorage.getItem(ADC_CACHE_KEY);
          if (cached) {
            const { projects, ts } = JSON.parse(cached);
            if (Date.now() - ts < ADC_CACHE_TTL && Array.isArray(projects) && projects.length > 0) {
              allProjects = projects;
              console.log(`Loaded ${projects.length} projects from localStorage cache`);
            }
          }
        } catch (e) { /* localStorage parse error — fetch fresh */ }

        // 2. Single Firestore read from projectsCache/latest
        if (!allProjects) {
          const snap = await getDoc(doc(db, 'projectsCache', 'latest'));
          if (snap.exists()) {
            const data = snap.data();
            allProjects = data.projects || [];
            console.log(`Loaded ${allProjects.length} projects from projectsCache (1 read)`);
            try {
              localStorage.setItem(ADC_CACHE_KEY, JSON.stringify({ projects: allProjects, ts: Date.now() }));
            } catch (e) { /* localStorage full — silently continue */ }
          }
        }

        // 3. Fallback: read individual docs (cache doc not yet built by pipeline)
        if (!allProjects || allProjects.length === 0) {
          console.log('projectsCache not found, falling back to getDocs...');
          const snap = await getDocs(collection(db, 'projects'));
          allProjects = snap.docs.map(d => {
            const raw = d.data();
            // Convert Firestore timestamps to ISO strings for consistency
            if (raw.createdAt && typeof raw.createdAt.toDate === 'function') {
              raw.createdAt = raw.createdAt.toDate().toISOString();
            }
            if (raw.trend_updatedAt && typeof raw.trend_updatedAt.toDate === 'function') {
              raw.trend_updatedAt = raw.trend_updatedAt.toDate().toISOString();
            }
            return raw;
          });
        }

        applyProjectData(allProjects);
        try { await initFuse(); } catch (e) { console.warn('Fuse init deferred:', e.message); }
      } catch (err) {
        console.error('loadAllProjects error:', err);
        state.projects = [];
      }
      state.isLoading = false;
      renderFeatured();
      renderCategoryTabs();
      if (state.currentView === 'home') {
        document.getElementById('projects').style.display = '';
      }
      renderProjects();
      if (location.hash === '#projects') setTimeout(() => document.getElementById('projects')?.scrollIntoView({ behavior: 'smooth' }), 100);
      // If user navigated directly to trending, render it now that data is loaded
      if (state.currentView === 'trending' && state.trendingLoaded) {
        renderTrendingAll();
        populateTrendingFilters();
        updateTrendingHeroStats();
        renderWeeklyRecap();
        initTrendingControls();
      }
    }

    // Server-side semantic search helper — calls Cloud Function for rankings
    async function getServerRankings(query, options = {}) {
      try {
        const fn = await loadFunctions();
        const payload = { query };
        if (options.rankProjects) payload.rankProjects = true;
        if (options.findSimilar) payload.findSimilar = options.findSimilar;
        const result = await fn(payload);
        return result.data;
      } catch (err) {
        console.warn('Server ranking failed:', err.message);
        return null;
      }
    }

    // ── Utilities ───────────────────────────────────────
    function esc(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
    function avatarSized(url, size) { if (!url) return url; return url + (url.includes('?') ? '&' : '?') + 's=' + size; }

    const ICONS = {
      'star': '<path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"/>',
      'github': '<path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/>',
      'search': '<circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>',
      'git-fork': '<circle cx="12" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><circle cx="18" cy="6" r="3"/><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"/><path d="M12 12v3"/>',
      'x': '<path d="M18 6 6 18"/><path d="m6 6 12 12"/>',
      'sparkles': '<path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/><path d="M20 3v4"/><path d="M22 5h-4"/><path d="M4 17v2"/><path d="M5 18H3"/>',
      'plus': '<path d="M5 12h14"/><path d="M12 5v14"/>',
      'folder-open': '<path d="m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"/>',
      'trending-up': '<polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/>',
      'trending-down': '<polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/>',
      'flame': '<path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>',
      'minus': '<path d="M5 12h14"/>',
      'thermometer-snowflake': '<path d="M2 12h10"/><path d="M9 4v16"/><path d="m3 9 3 3-3 3"/><path d="M12 6 9 9 6 6"/><path d="m6 18 3-3 1.5 1.5"/><path d="M20 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/>',
      'check-circle': '<circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/>',
      'x-circle': '<circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/>',
      'info': '<circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>',
      'layout-grid': '<rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/>',
      'table': '<path d="M12 3v18"/><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/>',
      'layers': '<path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/>',
      'bot': '<path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/>',
      'trophy': '<path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>',
      'zap': '<path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/>',
      'users': '<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>',
      'user': '<path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>',
      'percent': '<line x1="19" x2="5" y1="5" y2="19"/><circle cx="6.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="17.5" r="2.5"/>',
      'log-out': '<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/>',
      'trash-2': '<path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/>',
      'external-link': '<path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>',
      'radar': '<path d="M19.07 4.93A10 10 0 0 0 6.99 3.34"/><path d="M4 6h.01"/><path d="M2.29 9.62A10 10 0 1 0 21.31 8.35"/><path d="M16.24 7.76A6 6 0 1 0 8.23 16.67"/><path d="M12 18h.01"/><path d="M17.99 11.66A6 6 0 0 1 15.77 16.67"/><circle cx="12" cy="12" r="2"/><path d="m13.41 10.59 5.66-5.66"/>',
    };
    function icon(name, size, extra) {
      return `<svg width="${size || 24}" height="${size || 24}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"${extra ? ' ' + extra : ''}>${ICONS[name] || ''}</svg>`;
    }

    function showToast(message, type = 'success', duration = 3000) {
      const icons = { success: 'check-circle', error: 'x-circle', info: 'info' };
      const t = document.createElement('div');
      t.className = `toast glass ${type}`;
      t.innerHTML = `${icon(icons[type], 18)}<span>${message}</span>`;
      toastContainer.appendChild(t);
      setTimeout(() => { t.classList.add('removing'); t.addEventListener('animationend', () => t.remove()); }, duration);
    }

    let activeObserver = null;
    function observeCards() {
      if (activeObserver) activeObserver.disconnect();
      activeObserver = new IntersectionObserver(entries => entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('visible'); activeObserver.unobserve(e.target); } }), { threshold: 0.1 });
      projectGrid.querySelectorAll('.project-card').forEach(c => activeObserver.observe(c));
    }

    function animateStats() {
      document.querySelectorAll('.stat-number').forEach(el => {
        const target = parseInt(el.dataset.target, 10);
        const dur = 1200, start = performance.now();
        (function update(now) {
          const p = Math.min((now - start) / dur, 1);
          el.textContent = Math.floor((1 - Math.pow(1 - p, 3)) * target).toLocaleString();
          if (p < 1) requestAnimationFrame(update);
        })(start);
      });
    }

    // ── Search: Fuse.js instances ───────────────────────
    let fuseProjects = null;
    let fuseAutocomplete = null;
    const TRENDING_QUERIES = ['RAG pipeline', 'code review agent', 'image generation', 'LLM fine-tuning', 'autonomous agent', 'vector database', 'chatbot framework', 'data pipeline', 'AI coding assistant', 'model deployment'];

    async function ensureFuse() {
      if (typeof Fuse !== 'undefined') return;
      return new Promise((resolve, reject) => {
        const s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/fuse.js@7.0.0';
        s.onload = resolve;
        s.onerror = reject;
        document.head.appendChild(s);
      });
    }

    async function initFuse() {
      if (!state.projects.length) return;
      await ensureFuse();
      fuseProjects = new Fuse(state.projects, {
        keys: [{ name: 'name', weight: 0.3 }, { name: 'description', weight: 0.25 }, { name: 'writeup', weight: 0.2 }, { name: 'topics', weight: 0.15 }, { name: 'category', weight: 0.1 }],
        threshold: 0.3,
        includeScore: true,
        includeMatches: true,
      });
      // Autocomplete: lower threshold for fuzzy matching
      const acItems = [];
      for (const p of state.projects) {
        acItems.push({ text: p.name, type: 'project', project: p });
        for (const t of (p.topics || []).slice(0, 3)) {
          acItems.push({ text: t, type: 'topic' });
        }
      }
      // Deduplicate topics
      const seen = new Set();
      const deduped = acItems.filter(item => {
        const key = item.text.toLowerCase();
        if (seen.has(key)) return false;
        seen.add(key);
        return true;
      });
      fuseAutocomplete = new Fuse(deduped, {
        keys: ['text'],
        threshold: 0.3,
        includeScore: true,
        includeMatches: true,
      });
    }

    // ── Search: Intent classification ───────────────────
    function classifyIntent(q) {
      const lower = q.toLowerCase().trim();
      // Exact project name match
      const exactMatch = state.projects.find(p => p.name.toLowerCase() === lower || p.fullName?.toLowerCase() === lower);
      if (exactMatch) return { type: 'exact', project: exactMatch };
      // "similar to X" / "alternative to X"
      const simMatch = lower.match(/(?:similar to|alternative to|like)\s+(.+)/i);
      if (simMatch) {
        const target = simMatch[1].trim();
        const found = state.projects.find(p => p.name.toLowerCase() === target || p.fullName?.toLowerCase().includes(target));
        if (found) return { type: 'similar', project: found };
      }
      // Category boost — check if query contains a category keyword (word-boundary match)
      for (const [cat, keywords] of Object.entries(CATEGORY_TOPICS)) {
        for (const kw of keywords) {
          const kwNorm = kw.replace(/-/g, ' ');
          const re = new RegExp(`\\b${kwNorm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'i');
          if (re.test(lower)) {
            return { type: 'category_boost', category: cat, query: lower };
          }
        }
      }
      // Default: full semantic search
      return { type: 'semantic', query: lower };
    }

    // ── Search: Highlighting ────────────────────────────
    function highlightText(text, terms) {
      if (!text || !terms || !terms.length) return esc(text);
      let escaped = esc(text);
      for (const term of terms) {
        if (term.length < 2) continue;
        const re = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
        escaped = escaped.replace(re, '<mark class="search-highlight">$1</mark>');
      }
      return escaped;
    }

    // ── Search: Match badge ─────────────────────────────
    function matchBadge(score) {
      if (score >= 0.6) return '<span class="match-badge best">Best Match</span>';
      if (score >= 0.4) return '<span class="match-badge good">Good Match</span>';
      return '<span class="match-badge related">Related</span>';
    }

    // ── Search: Similar projects (server-side) ─────────
    async function findSimilarProjects(project, count = 3) {
      if (!project.fullName) return [];
      try {
        const data = await getServerRankings('', { findSimilar: project.fullName });
        if (!data?.rankings) return [];
        const projectMap = new Map(state.projects.map(p => [p.fullName, p]));
        return data.rankings.slice(0, count)
          .filter(r => projectMap.has(r.fullName))
          .map(r => ({ project: projectMap.get(r.fullName), score: r.score }));
      } catch {
        return [];
      }
    }

    // ── Search: Main handler ────────────────────────────
    async function handleSearch(queryText) {
      const q = queryText.trim();
      state.searchQuery = q;

      const searchResultGrid = document.getElementById('search-result-grid');

      // Clear search → clear search page results, stay on search page
      if (!q) {
        state.searchResults = null;
        state.githubResults = null;
        state.isSearching = false;
        document.getElementById('search-status').classList.remove('visible');
        document.getElementById('did-you-mean').classList.remove('visible');
        document.getElementById('github-discovery-container').innerHTML = '';
        searchResultGrid.innerHTML = '';
        return;
      }

      const intent = classifyIntent(q);

      // Exact match — no API call needed
      if (intent.type === 'exact') {
        state.searchResults = [{ project: intent.project, score: 1.0 }];
        state.isSearching = false;
        renderSearchResults(q);
        logSearchAnalytics(q, 1);
        return;
      }

      // Similar projects — server-side ranking via Cloud Function
      if (intent.type === 'similar') {
        const similar = await findSimilarProjects(intent.project, 10);
        state.searchResults = similar.length > 0
          ? similar.map(s => ({ project: s.project, score: s.score }))
          : [{ project: intent.project, score: 1.0 }];
        state.isSearching = false;
        renderSearchResults(q);
        logSearchAnalytics(q, state.searchResults.length);
        return;
      }

      // Check in-memory cache
      const cacheKey = q.toLowerCase();
      if (state.searchCache.has(cacheKey)) {
        const cached = state.searchCache.get(cacheKey);
        state.searchResults = cached.results;
        state.isSearching = false;
        renderSearchResults(q);
        logSearchAnalytics(q, cached.results.length);
        return;
      }

      // Semantic + keyword hybrid search — server-side embeddings + client-side Fuse.js
      state.isSearching = true;
      const statusEl = document.getElementById('search-status');
      const spinnerEl = document.getElementById('search-spinner');
      statusEl.innerHTML = '<span class="status-spinner"></span> Searching with AI...';
      statusEl.classList.add('visible');
      spinnerEl.classList.add('visible');

      // Server-side semantic rankings via Cloud Function
      let serverRankings = null;
      try {
        const data = await getServerRankings(q, { rankProjects: true });
        if (data?.rankings) serverRankings = new Map(data.rankings.map(r => [r.fullName, r.score]));
      } catch (err) {
        console.warn('Server ranking failed, falling back to keyword search:', err.message);
      }

      spinnerEl.classList.remove('visible');

      // Score all projects
      const scored = [];
      const searchTerms = q.toLowerCase().split(/\s+/).filter(t => t.length >= 2);

      // Compute Fuse.js keyword matches once (outside the loop)
      const fuseMatchMap = new Map();
      if (fuseProjects) {
        const fuseResults = fuseProjects.search(q);
        for (const r of fuseResults) {
          const key = r.item.fullName || r.item.name;
          const normalized = 1 - (r.score / 0.3);  // 0→1.0, 0.3→0.0
          fuseMatchMap.set(key, Math.max(0, normalized));
        }
      }

      for (const p of state.projects) {
        let semanticScore = 0;
        let keywordScore = 0;

        // Semantic score from server-side rankings
        if (serverRankings && serverRankings.has(p.fullName)) {
          semanticScore = serverRankings.get(p.fullName);
        }

        // Keyword score from pre-computed Fuse.js results
        const fuseKey = p.fullName || p.name;
        if (fuseMatchMap.has(fuseKey)) {
          keywordScore = fuseMatchMap.get(fuseKey);
        }

        // Category boost — additive, only if project already has some relevance
        if (intent.type === 'category_boost' && inferCategory(p) === intent.category && keywordScore > 0) {
          keywordScore = Math.min(1, keywordScore + 0.15);
        }

        // Combined score — require meaningful relevance
        let combined;
        if (serverRankings && semanticScore > 0) {
          if (keywordScore > 0) {
            combined = 0.7 * semanticScore + 0.3 * keywordScore;
          } else {
            combined = semanticScore >= 0.55 ? semanticScore : 0;
          }
        } else {
          combined = keywordScore;
        }

        if (combined > 0.25) {
          scored.push({ project: p, score: combined });
        }
      }

      scored.sort((a, b) => b.score - a.score);
      scored.splice(12);
      state.searchResults = scored;
      state.isSearching = false;

      // Cache results
      state.searchCache.set(cacheKey, { results: scored, timestamp: Date.now() });

      statusEl.classList.remove('visible');
      renderSearchResults(q);
      logSearchAnalytics(q, scored.length);

      // Save to recent searches
      saveRecentSearch(q);
    }

    // ── Search: Render results ──────────────────────────
    function renderSearchResults(queryText) {
      const results = state.searchResults;
      const didYouMeanEl = document.getElementById('did-you-mean');
      const ghContainer = document.getElementById('github-discovery-container');
      const searchResultGrid = document.getElementById('search-result-grid');

      if (!results || results.length === 0) {
        // "Did you mean?" suggestions
        if (fuseAutocomplete && queryText) {
          const suggestions = fuseAutocomplete.search(queryText).slice(0, 3);
          if (suggestions.length > 0) {
            didYouMeanEl.innerHTML = `Did you mean: ${suggestions.map(s => `<a onclick="document.getElementById('search-input').value='${esc(s.item.text)}';handleSearch('${esc(s.item.text)}')">${esc(s.item.text)}</a>`).join(', ')}?`;
            didYouMeanEl.classList.add('visible');
          }
        }
        searchResultGrid.innerHTML = `<div class="empty-state">${icon('search', 48)}<p>No projects found for "${esc(queryText)}". Try a different search or browse categories.</p></div>`;
  
        renderGitHubDiscovery(queryText, ghContainer);
        return;
      }

      didYouMeanEl.classList.remove('visible');

      // Show "Did you mean?" even if results < 3
      if (results.length < 3 && fuseAutocomplete && queryText) {
        const suggestions = fuseAutocomplete.search(queryText).slice(0, 3).filter(s => s.item.text.toLowerCase() !== queryText.toLowerCase());
        if (suggestions.length > 0) {
          didYouMeanEl.innerHTML = `Also try: ${suggestions.map(s => `<a onclick="document.getElementById('search-input').value='${esc(s.item.text)}';handleSearch('${esc(s.item.text)}')">${esc(s.item.text)}</a>`).join(', ')}`;
          didYouMeanEl.classList.add('visible');
        }
      }

      const searchTerms = queryText.toLowerCase().split(/\s+/).filter(t => t.length >= 2);

      searchResultGrid.innerHTML = results.map(({ project: p, score }) => {
        const langColor = LANG_COLORS[p.language] || '#888';
        const topics = (p.topics || []).slice(0, 5);
        const cat = inferCategory(p);

        return `
          <div class="project-card glass visible" data-fullname="${esc(p.fullName || '')}" data-score="${score}">
            <div class="project-banner">
              ${p.ownerAvatar ? `<img src="${avatarSized(p.ownerAvatar, 96)}" alt="${esc(p.owner)}" width="48" height="48" loading="lazy">` : `<span class="initial">${(p.name||'P').charAt(0).toUpperCase()}</span>`}
              ${p.source === 'auto' ? '<span class="auto-badge">🤖 Daily Pick</span>' : ''}
            </div>
            <div class="project-body">
              <div class="project-name"><a href="${esc(p.url)}" target="_blank" rel="noopener" onclick="logSearchClick('${esc(state.searchQuery)}','${esc(p.fullName || p.name)}')">${highlightText(p.name, searchTerms)}</a>${matchBadge(score)}</div>
              <div class="project-owner">${esc(p.owner)}</div>
              <p class="project-desc">${highlightText((p.writeup || p.description || '').slice(0, 200), searchTerms)}</p>
              ${p.quickStart && p.quickStart.length ? `<details class="quick-start"><summary>Quick Start</summary><ol>${p.quickStart.map(s => `<li>${esc(s)}</li>`).join('')}</ol></details>` : ''}
              <div class="project-topics">${topics.map(t => `<span class="project-topic">${highlightText(t, searchTerms)}</span>`).join('')}</div>
              <span class="category-badge">${esc(cat)}</span>
              <div class="project-stats">
                <span>${icon('star', 14)} ${(p.stars||0).toLocaleString()}</span>
                <span>${icon('git-fork', 14)} ${(p.forks||0).toLocaleString()}</span>
                ${p.language ? `<span><span class="project-lang-dot" style="background:${langColor}"></span> ${esc(p.language)}</span>` : ''}
              </div>
              <div class="similar-projects-slot" data-fullname="${esc(p.fullName || '')}"></div>
            </div>
          </div>`;
      }).join('');


      renderGitHubDiscovery(queryText, ghContainer);

      // Lazy-load similar projects for each result (async, non-blocking)
      for (const { project: p } of results) {
        findSimilarProjects(p).then(similar => {
          if (similar.length === 0) return;
          const slot = searchResultGrid.querySelector(`.similar-projects-slot[data-fullname="${CSS.escape(p.fullName || '')}"]`);
          if (!slot) return;
          slot.innerHTML = `<details class="similar-projects"><summary>Similar Projects (${similar.length})</summary>${similar.map(s => `<div class="similar-card"><a href="${esc(s.project.url)}" target="_blank" rel="noopener">${esc(s.project.name)}</a><span class="similar-score">${Math.round(s.score * 100)}%</span></div>`).join('')}</details>`;
        });
      }
    }

    // ── Search: GitHub discovery ─────────────────────────
    function ghResultCards(filtered) {
      return filtered.map(r => {
        const owner = r.full_name.split('/')[0];
        const langColor = LANG_COLORS[r.language] || '#888';
        return `
        <div class="gh-result-card glass">
          <img class="gh-result-avatar" src="https://github.com/${esc(owner)}.png?size=72" alt="${esc(owner)}" width="36" height="36" loading="lazy">
          <div class="gh-result-body">
            <h4><a href="${esc(r.html_url)}" target="_blank" rel="noopener">${esc(r.full_name)}</a><span class="gh-source-tag">GitHub</span></h4>
            <p>${esc((r.description || 'No description').slice(0, 160))}</p>
            <div class="gh-result-meta">
              <span>${icon('star', 12)} ${(r.stargazers_count||0).toLocaleString()}</span>
              <span>${icon('git-fork', 12)} ${(r.forks_count||0).toLocaleString()}</span>
              ${r.language ? `<span><span class="project-lang-dot" style="background:${langColor}"></span> ${esc(r.language)}</span>` : ''}
              <a href="${esc(r.html_url)}" target="_blank" rel="noopener" class="gh-submit-btn">${icon('external-link', 12)} View</a>
            </div>
          </div>
        </div>`;
      }).join('');
    }

    function renderGitHubDiscoveryResults(filtered, container, hasLocalResults) {
      if (!hasLocalResults) {
        // 0 local results → put GitHub results right in the search result grid
        document.getElementById('search-result-grid').innerHTML = `
          <div class="github-discovery github-discovery-primary">
            <h3>${icon('github', 18)} Found on GitHub</h3>
            <p class="gh-subtitle">Not in our catalog yet — like one? Submit it to the community.</p>
            ${ghResultCards(filtered)}
          </div>`;
        container.innerHTML = '';
  
      } else {
        // Has local results → secondary section below
        container.innerHTML = `
          <div class="github-discovery">
            <h3>${icon('github', 18)} More from GitHub</h3>
            <p class="gh-subtitle">Not in our catalog yet</p>
            ${ghResultCards(filtered)}
          </div>`;
  
      }
    }

    async function renderGitHubDiscovery(queryText, container) {
      if (!queryText) { container.innerHTML = ''; return; }

      const hasLocalResults = state.searchResults && state.searchResults.length > 0;
      const cacheKey = queryText.toLowerCase();

      // Check cache first
      if (state.githubResultsCache.has(cacheKey)) {
        const cached = state.githubResultsCache.get(cacheKey);
        state.githubResults = cached;
        if (cached.length > 0) {
          renderGitHubDiscoveryResults(cached, container, hasLocalResults);
        } else {
          container.innerHTML = '';
        }
        return;
      }

      // Show loading skeleton in the right place
      const skeletonHtml = `
        <div class="github-discovery${hasLocalResults ? '' : ' github-discovery-primary'}">
          <h3>${icon('github', 18)} ${hasLocalResults ? 'More from GitHub' : 'Searching GitHub\u2026'}</h3>
          <div class="gh-skeleton">
            <div class="gh-skeleton-card"></div>
            <div class="gh-skeleton-card"></div>
          </div>
        </div>`;
      if (!hasLocalResults) {
        document.getElementById('search-result-grid').innerHTML = skeletonHtml;
        container.innerHTML = '';
      } else {
        container.innerHTML = skeletonHtml;
      }


      // Rate limit: defer if last call was < 2 seconds ago
      const elapsed = Date.now() - state.lastGitHubApiCall;
      if (elapsed < 2000) {
        await new Promise(r => setTimeout(r, 2000 - elapsed));
        if (state.searchQuery.toLowerCase() !== cacheKey) return;
      }

      try {
        state.lastGitHubApiCall = Date.now();
        const res = await fetch(`https://api.github.com/search/repositories?q=${encodeURIComponent(queryText)}+stars:>100&sort=stars&per_page=10`);
        if (!res.ok) throw new Error(`GitHub API ${res.status}`);
        const data = await res.json();
        const existingNames = new Set(state.projects.map(p => (p.fullName || '').toLowerCase()));
        const filtered = (data.items || []).filter(r => !existingNames.has(r.full_name.toLowerCase()));

        state.githubResults = filtered;
        state.githubResultsCache.set(cacheKey, filtered);

        if (state.searchQuery.toLowerCase() !== cacheKey) return;

        if (filtered.length === 0) {
          if (!hasLocalResults) {
            document.getElementById('search-result-grid').innerHTML = `<div class="empty-state">${icon('search', 48)}<p>No projects found for "${esc(queryText)}". Try a different search or browse categories.</p></div>`;
      
          }
          container.innerHTML = '';
          return;
        }

        const currentHasLocal = state.searchResults && state.searchResults.length > 0;
        renderGitHubDiscoveryResults(filtered, container, currentHasLocal);
      } catch (err) {
        console.error('GitHub search error:', err);
        container.innerHTML = '';
      }
    }

    // Helper to auto-fill submit modal with a GitHub repo from discovery
    window.submitGhProject = function(fullName) {
      if (!state.isLoggedIn) { openLoginModal(); return; }
      openSubmitModal();
      repoUrlInput.value = `https://github.com/${fullName}`;
      repoUrlInput.dispatchEvent(new Event('input'));
    };

    // ── Search: Analytics ───────────────────────────────
    async function logSearchAnalytics(queryText, resultCount) {
      if (!state.isLoggedIn) return;
      try {
        await addDoc(collection(db, 'searchAnalytics'), {
          query: queryText,
          resultCount,
          timestamp: serverTimestamp(),
          uid: state.user.uid,
        });
      } catch {}
    }

    window.logSearchClick = async function(queryText, projectName) {
      if (!state.isLoggedIn) return;
      try {
        // Find the position of this project in results
        const pos = (state.searchResults || []).findIndex(r => (r.project.fullName || r.project.name) === projectName);
        await addDoc(collection(db, 'searchAnalytics'), {
          query: queryText,
          clickedProject: projectName,
          clickPosition: pos >= 0 ? pos : null,
          timestamp: serverTimestamp(),
          uid: state.user.uid,
        });
      } catch {}
    };

    // ── Search: Recent searches ─────────────────────────
    function saveRecentSearch(q) {
      try {
        const stored = JSON.parse(localStorage.getItem('adc_recent_searches') || '[]');
        const filtered = stored.filter(s => s.toLowerCase() !== q.toLowerCase());
        filtered.unshift(q);
        localStorage.setItem('adc_recent_searches', JSON.stringify(filtered.slice(0, 8)));
      } catch {}
    }
    function getRecentSearches() {
      try { return JSON.parse(localStorage.getItem('adc_recent_searches') || '[]'); } catch { return []; }
    }

    // ── Search: Hero trending pills ────────────────────
    function renderHeroTrending() {
      const el = document.getElementById('hero-trending');
      const pills = TRENDING_QUERIES.slice(0, 5);
      el.innerHTML = `<span class="hero-trending-label">Try:</span>${pills.map(s => `<button class="hero-trending-pill" data-query="${esc(s)}">${esc(s)}</button>`).join('')}`;
      el.querySelectorAll('.hero-trending-pill').forEach(pill => {
        pill.addEventListener('click', () => {
          const q = pill.dataset.query;
          document.getElementById('search-input').value = q;
          handleSearch(q);
        });
      });
    }

    // Make handleSearch available for inline onclick handlers
    window.handleSearch = handleSearch;

    // ── Search: Discovery panel ─────────────────────────
    function renderDiscoveryPanel() {
      const el = document.getElementById('search-discovery');
      const recent = getRecentSearches();
      let html = '';
      if (recent.length > 0) {
        html += `<h4>Recent Searches</h4><div class="discovery-pills">${recent.map(s => `<button class="discovery-pill" data-query="${esc(s)}">${esc(s)}</button>`).join('')}</div>`;
      }
      html += `<h4>Trending</h4><div class="discovery-pills">${TRENDING_QUERIES.map(s => `<button class="discovery-pill" data-query="${esc(s)}">${esc(s)}</button>`).join('')}</div>`;
      // Category chips
      const cats = CATEGORY_ORDER.filter(c => c !== 'All');
      html += `<h4>Categories</h4><div class="discovery-pills">${cats.map(c => `<button class="discovery-pill" data-query="${esc(c)}">${esc(c)}</button>`).join('')}</div>`;
      el.innerHTML = html;
      el.querySelectorAll('.discovery-pill').forEach(pill => {
        pill.addEventListener('click', () => {
          const q = pill.dataset.query;
          document.getElementById('search-input').value = q;
          el.classList.remove('open');
          handleSearch(q);
        });
      });
    }

    // ── Search: Autocomplete ────────────────────────────
    let acIndex = -1;
    function renderAutocomplete(q) {
      const el = document.getElementById('search-autocomplete');
      if (!q || q.length < 2 || !fuseAutocomplete) {
        el.classList.remove('open');
        return;
      }
      const results = fuseAutocomplete.search(q).slice(0, 6);
      if (results.length === 0) { el.classList.remove('open'); return; }

      acIndex = -1;
      el.innerHTML = results.map((r, i) => {
        let display = esc(r.item.text);
        // Highlight matching portions
        if (r.matches && r.matches.length > 0) {
          const m = r.matches[0];
          const indices = m.indices.filter(([start, end]) => end - start >= 1);
          if (indices.length > 0) {
            let chars = [...r.item.text];
            // Build highlighted string
            let hl = '';
            let lastIdx = 0;
            for (const [start, end] of indices) {
              hl += esc(r.item.text.slice(lastIdx, start));
              hl += `<mark>${esc(r.item.text.slice(start, end + 1))}</mark>`;
              lastIdx = end + 1;
            }
            hl += esc(r.item.text.slice(lastIdx));
            display = hl;
          }
        }
        return `<div class="autocomplete-item" data-idx="${i}" data-text="${esc(r.item.text)}">${display}<span class="ac-type">${r.item.type}</span></div>`;
      }).join('');
      el.classList.add('open');

      el.querySelectorAll('.autocomplete-item').forEach(item => {
        item.addEventListener('click', () => {
          const text = item.dataset.text;
          document.getElementById('search-input').value = text;
          el.classList.remove('open');
          handleSearch(text);
        });
      });
    }

    // ── Search: Input event wiring ──────────────────────
    const searchInput = document.getElementById('search-input');
    const searchClear = document.getElementById('search-clear');
    const searchDiscovery = document.getElementById('search-discovery');
    const searchAutocomplete = document.getElementById('search-autocomplete');
    let searchDebounce = null;

    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim();
      searchClear.classList.toggle('visible', q.length > 0);
      searchDiscovery.classList.remove('open');

      // Autocomplete
      renderAutocomplete(q);

      // Debounced search
      clearTimeout(searchDebounce);
      if (!q) {
        handleSearch('');
        return;
      }
      searchDebounce = setTimeout(() => {
        searchAutocomplete.classList.remove('open');
        handleSearch(q);
      }, 300);
    });

    searchInput.addEventListener('focus', () => {
      if (!searchInput.value.trim()) {
        renderDiscoveryPanel();
        searchDiscovery.classList.add('open');
      }
    });

    searchInput.addEventListener('keydown', (e) => {
      const items = searchAutocomplete.querySelectorAll('.autocomplete-item');
      if (!items.length || !searchAutocomplete.classList.contains('open')) {
        if (e.key === 'Escape') {
          searchDiscovery.classList.remove('open');
          searchInput.blur();
        }
        return;
      }
      if (e.key === 'ArrowDown') { e.preventDefault(); acIndex = Math.min(acIndex + 1, items.length - 1); }
      else if (e.key === 'ArrowUp') { e.preventDefault(); acIndex = Math.max(acIndex - 1, -1); }
      else if (e.key === 'Enter' && acIndex >= 0) {
        e.preventDefault();
        const text = items[acIndex].dataset.text;
        searchInput.value = text;
        searchAutocomplete.classList.remove('open');
        handleSearch(text);
        return;
      } else if (e.key === 'Escape') {
        searchAutocomplete.classList.remove('open');
        return;
      } else return;
      items.forEach((it, i) => it.classList.toggle('active', i === acIndex));
    });

    searchClear.addEventListener('click', () => {
      searchInput.value = '';
      searchClear.classList.remove('visible');
      searchAutocomplete.classList.remove('open');
      handleSearch('');
      searchInput.focus();
    });

    // Close discovery/autocomplete on outside click
    document.addEventListener('click', (e) => {
      const container = document.getElementById('search-container');
      if (!container.contains(e.target)) {
        searchDiscovery.classList.remove('open');
        searchAutocomplete.classList.remove('open');
      }
    });

    // ── Events ──────────────────────────────────────────
    document.getElementById('login-close').addEventListener('click', closeLoginModal);
    document.getElementById('submit-close').addEventListener('click', closeSubmitModal);
    document.getElementById('btn-github').addEventListener('click', loginWithGitHub);
    document.getElementById('btn-google').addEventListener('click', loginWithGoogle);
    document.getElementById('btn-facebook').addEventListener('click', loginWithFacebook);
    document.getElementById('section-submit-btn').addEventListener('click', () => state.isLoggedIn ? openSubmitModal() : openLoginModal());
    loginModal.addEventListener('click', e => { if (e.target === loginModal) closeLoginModal(); });
    submitModal.addEventListener('click', e => { if (e.target === submitModal) closeSubmitModal(); });
    loginModal.addEventListener('keydown', e => { if (e.key === 'Escape') closeLoginModal(); });
    submitModal.addEventListener('keydown', e => { if (e.key === 'Escape') closeSubmitModal(); });
    hamburgerBtn.addEventListener('click', () => mobileMenu.classList.toggle('open'));
    document.addEventListener('click', e => {
      if (!hamburgerBtn.contains(e.target) && !mobileMenu.contains(e.target)) mobileMenu.classList.remove('open');
      if (!avatarDropdown.contains(e.target) && !e.target.classList.contains('nav-avatar')) avatarDropdown.classList.remove('open');
    });
    window.addEventListener('scroll', () => document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 60));

    // Handle clicks on #trending anchors anywhere (footer, etc.)
    document.addEventListener('click', (e) => {
      const link = e.target.closest('a[href="#trending"]');
      if (link && !link.dataset.nav) { e.preventDefault(); navigateTo('trending'); }
    });

    ensureAuth().then(() => {
      onAuthStateChanged(auth, user => {
        state.user = user || null;
        state.isLoggedIn = !!user;
        renderNavbar();
        navRight.style.visibility = '';
      });
    });

    // ── Trending: Constants & Helpers ─────────────────────
    const TREND_PAGE_SIZE = 25;

    function trendStarsForRange(p) {
      const r = state.trendTimeRange;
      if (r === '1d') return p.trend_stars1d || 0;
      if (r === '30d') return p.trend_stars30d || 0;
      if (r === 'all') return p.stars || 0;
      return p.trend_stars7d || 0;
    }
    function trendPctForRange(p) {
      const r = state.trendTimeRange;
      if (r === '1d') return p.trend_starsPct1d || 0;
      if (r === '30d') return p.trend_starsPct30d || 0;
      if (r === 'all') return 0;
      return p.trend_starsPct7d || 0;
    }
    function trendSparklineForRange(p) {
      const r = state.trendTimeRange;
      if (r === '30d' || r === 'all') return p.trend_sparkline30d || p.trend_sparkline || [];
      return p.trend_sparkline || [];
    }

    const trendSortFns = {
      momentum: (a, b) => (b.trend_momentum || 0) - (a.trend_momentum || 0),
      stars7d:  (a, b) => trendStarsForRange(b) - trendStarsForRange(a),
      pct:      (a, b) => trendPctForRange(b) - trendPctForRange(a),
    };

    function trendBadge(p) {
      if (!p.trend_label) return '';
      const icons = { hot: 'flame', rising: 'trending-up', steady: 'minus', declining: 'trending-down', new: 'sparkles' };
      const cls = p.trend_label === 'new' ? 'new-project' : p.trend_label;
      const labels = { hot: 'Hot', rising: 'Rising', steady: 'Steady', declining: 'Cooling', new: 'New' };
      const gain = trendStarsForRange(p);
      return `<span class="trend-badge ${esc(cls)}">${icon(icons[p.trend_label] || 'minus', 11)}${labels[p.trend_label] || ''}${gain > 0 ? ` +${gain.toLocaleString()}` : ''}</span>`;
    }

    function renderSparkline(data) {
      if (!data || data.length < 2) return '';
      const w = 60, h = 20, pad = 2;
      const min = Math.min(...data), max = Math.max(...data);
      const range = max - min || 1;
      const points = data.map((v, i) => {
        const x = pad + (i / (data.length - 1)) * (w - 2 * pad);
        const y = h - pad - ((v - min) / range) * (h - 2 * pad);
        return `${x},${y}`;
      }).join(' ');
      const color = data[data.length - 1] >= data[0] ? '#34d399' : '#f87171';
      return `<span class="trend-sparkline"><svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}"><polyline points="${points}" fill="none" stroke="${color}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>`;
    }

    function starGainHtml(p) {
      const gain = trendStarsForRange(p);
      const labels = { '1d': '/day', '7d': '/wk', '30d': '/mo', all: 'total' };
      const lbl = labels[state.trendTimeRange] || '/wk';
      if (state.trendTimeRange === 'all') return `<span class="star-gain positive">${(p.stars || 0).toLocaleString()} ${lbl}</span>`;
      if (gain > 0) return `<span class="star-gain positive">+${gain.toLocaleString()} ${lbl}</span>`;
      if (gain < 0) return `<span class="star-gain negative">${gain.toLocaleString()} ${lbl}</span>`;
      return `<span class="star-gain neutral">No change</span>`;
    }

    function momentumBar(p) {
      const score = p.trend_momentum || 0;
      const cls = p.trend_label === 'new' ? 'new-project' : (p.trend_label || 'steady');
      return `
        <div class="momentum-bar">
          <div class="momentum-track"><div class="momentum-fill ${esc(cls)}" style="width:${Math.min(score, 100)}%"></div></div>
          <span class="momentum-val">${score.toFixed(1)}</span>
        </div>`;
    }

    // ── Trending: Rank Card ───────────────────────────────
    function renderRankCard(p, rank) {
      const langColor = LANG_COLORS[p.language] || '#888';
      const cat = inferCategory(p);
      const desc = (p.writeup || p.description || '').slice(0, 120);
      const rankCls = rank === 1 ? 'gold' : rank === 2 ? 'silver' : rank === 3 ? 'bronze' : '';
      const newBadge = isNewThisWeek(p) ? '<span class="new-week-badge">New</span>' : '';
      const projectUrl = `/project?repo=${encodeURIComponent(p.fullName || (p.owner + '/' + p.name))}`;

      return `
        <div class="rank-card">
          <div class="rank-num ${rankCls}">#${rank}</div>
          <div class="rank-body">
            <div class="rank-header">
              <span class="rank-name"><a href="${esc(projectUrl)}">${esc(p.name)}</a></span>
              <span class="rank-owner">${esc(p.owner)}</span>
              ${trendBadge(p)}
              ${newBadge}
              ${renderSparkline(trendSparklineForRange(p))}
            </div>
            <p class="rank-desc">${esc(desc)}</p>
            <div class="rank-meta">
              ${starGainHtml(p)}
              <span>${icon('star', 13)} ${(p.stars || 0).toLocaleString()}</span>
              <span>${icon('git-fork', 13)} ${(p.forks || 0).toLocaleString()}</span>
              ${p.language ? `<span><span class="rank-lang-dot" style="background:${langColor}"></span> ${esc(p.language)}</span>` : ''}
              <span class="category-badge">${esc(cat)}</span>
            </div>
            ${momentumBar(p)}
          </div>
        </div>`;
    }

    function renderTrendingEmptyState(container, iconName, msg, sub) {
      container.innerHTML = `
        <div class="empty-state">
          ${icon(iconName, 48)}
          <p>${esc(msg)}</p>
          ${sub ? `<p class="subtitle" style="font-size:14px;color:var(--text-muted);margin-top:8px">${esc(sub)}</p>` : ''}
        </div>`;

    }

    // ── Trending: Filter & Paginate ───────────────────────
    function filterTrendingProjects(projects, filter) {
      let list = [...projects];
      if (filter.category !== 'All') list = list.filter(p => inferCategory(p) === filter.category);
      if (filter.language !== 'All') list = list.filter(p => p.language === filter.language);
      if (filter.search) {
        const q = filter.search.toLowerCase();
        list = list.filter(p =>
          (p.name || '').toLowerCase().includes(q) ||
          (p.owner || '').toLowerCase().includes(q) ||
          (p.description || '').toLowerCase().includes(q) ||
          (p.language || '').toLowerCase().includes(q)
        );
      }
      list.sort(trendSortFns[state.trendSort] || trendSortFns.momentum);
      return list;
    }

    function renderTrendingPagination(containerId, filter, total, renderFn) {
      const pag = document.getElementById(containerId);
      const pages = Math.ceil(total / TREND_PAGE_SIZE);
      if (pages <= 1) { pag.innerHTML = ''; return; }
      let html = `<button class="page-btn" data-page="prev" ${filter.page <= 1 ? 'disabled' : ''}>&laquo;</button>`;
      const cur = filter.page;
      if (pages <= 7) {
        for (let i = 1; i <= pages; i++) html += `<button class="page-btn${cur === i ? ' active' : ''}" data-page="${i}">${i}</button>`;
      } else {
        const show = new Set([1, 2, cur - 1, cur, cur + 1, pages - 1, pages]);
        let prev = 0;
        for (let i = 1; i <= pages; i++) {
          if (!show.has(i)) continue;
          if (prev && i - prev > 1) html += `<span class="page-info">&hellip;</span>`;
          html += `<button class="page-btn${cur === i ? ' active' : ''}" data-page="${i}">${i}</button>`;
          prev = i;
        }
      }
      html += `<button class="page-btn" data-page="next" ${filter.page >= pages ? 'disabled' : ''}>&raquo;</button>`;
      html += `<span class="page-info">${total} projects</span>`;
      pag.innerHTML = html;
      pag.querySelectorAll('.page-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const v = btn.dataset.page;
          if (v === 'prev') filter.page = Math.max(1, filter.page - 1);
          else if (v === 'next') filter.page = Math.min(pages, filter.page + 1);
          else filter.page = parseInt(v, 10);
          renderFn();
        });
      });
    }

    // ── Trending: Section Renderers ───────────────────────
    function renderAiTop25() {
      const container = document.getElementById('ai-top25');
      const filtered = filterTrendingProjects(state.trendingAiProjects, state.aiFilter);
      if (filtered.length === 0) {
        container.innerHTML = '';
        renderTrendingEmptyState(container, 'bot',
          state.aiFilter.search || state.aiFilter.category !== 'All' || state.aiFilter.language !== 'All'
            ? 'No projects match these filters'
            : 'No AI trending data yet',
          state.aiFilter.search ? '' : 'The daily pipeline hasn\'t run yet. Check back tomorrow!');
        document.getElementById('ai-pagination').innerHTML = '';
        return;
      }
      const start = (state.aiFilter.page - 1) * TREND_PAGE_SIZE;
      const page = filtered.slice(start, start + TREND_PAGE_SIZE);
      container.innerHTML = page.map((p, i) => renderRankCard(p, start + i + 1)).join('');

      renderTrendingPagination('ai-pagination', state.aiFilter, filtered.length, renderAiTop25);
    }

    function renderGlobalTop25() {
      const container = document.getElementById('global-top25');
      const tableWrap = document.getElementById('global-table-wrap');
      const filtered = filterTrendingProjects(state.trendingGlobalProjects, state.globalFilter);
      if (filtered.length === 0) {
        container.innerHTML = '';
        tableWrap.style.display = 'none';
        container.style.display = '';
        renderTrendingEmptyState(container, 'radar',
          state.globalFilter.search || state.globalFilter.category !== 'All' || state.globalFilter.language !== 'All'
            ? 'No projects match these filters'
            : 'No trending data yet',
          state.globalFilter.search ? '' : 'The daily pipeline hasn\'t run yet. Check back tomorrow!');
        document.getElementById('global-pagination').innerHTML = '';
        return;
      }
      if (state.globalView === 'table') {
        container.style.display = 'none';
        tableWrap.style.display = '';
        renderGlobalTable(filtered);
      } else {
        container.style.display = '';
        tableWrap.style.display = 'none';
        const start = (state.globalFilter.page - 1) * TREND_PAGE_SIZE;
        const page = filtered.slice(start, start + TREND_PAGE_SIZE);
        container.innerHTML = page.map((p, i) => renderRankCard(p, start + i + 1)).join('');
      }

      renderTrendingPagination('global-pagination', state.globalFilter, filtered.length, renderGlobalTop25);
    }

    function renderGlobalTable(filtered) {
      const table = document.getElementById('global-rankings-table');
      const { col, dir } = state.globalTableSort;
      const sortedData = [...filtered].sort((a, b) => {
        const m = dir === 'asc' ? 1 : -1;
        if (col === 'name') return m * (a.name || '').localeCompare(b.name || '');
        if (col === 'stars') return m * ((a.stars || 0) - (b.stars || 0));
        if (col === 'growth') return m * (trendStarsForRange(a) - trendStarsForRange(b));
        if (col === 'growthPct') return m * (trendPctForRange(a) - trendPctForRange(b));
        if (col === 'momentum') return m * ((a.trend_momentum || 0) - (b.trend_momentum || 0));
        if (col === 'forks') return m * ((a.forks || 0) - (b.forks || 0));
        if (col === 'language') return m * (a.language || '').localeCompare(b.language || '');
        return 0;
      });
      const start = (state.globalFilter.page - 1) * TREND_PAGE_SIZE;
      const page = sortedData.slice(start, start + TREND_PAGE_SIZE);
      const cols = [
        { key: 'rank', label: '#', sortable: false },
        { key: 'name', label: 'Project', sortable: true },
        { key: 'stars', label: 'Stars', sortable: true },
        { key: 'growth', label: 'Growth', sortable: true },
        { key: 'growthPct', label: 'Growth %', sortable: true },
        { key: 'momentum', label: 'Momentum', sortable: true },
        { key: 'forks', label: 'Forks', sortable: true },
        { key: 'language', label: 'Language', sortable: true },
      ];
      const thHtml = cols.map(c => {
        const sorted = col === c.key;
        const cls = sorted ? (dir === 'asc' ? 'sorted-asc' : 'sorted-desc') : '';
        const arrow = sorted ? (dir === 'asc' ? '\u25B2' : '\u25BC') : '\u25B4';
        return `<th class="${cls}" ${c.sortable ? `data-sort="${c.key}"` : ''}>${c.label}${c.sortable ? `<span class="sort-icon">${arrow}</span>` : ''}</th>`;
      }).join('');
      const rowsHtml = page.map((p, i) => {
        const rank = start + i + 1;
        const gain = trendStarsForRange(p);
        const pct = trendPctForRange(p);
        const gainCls = gain > 0 ? 'positive' : gain < 0 ? 'negative' : '';
        const pctCls = pct > 0 ? 'positive' : pct < 0 ? 'negative' : '';
        const langColor = LANG_COLORS[p.language] || '#888';
        const projectUrl = `/project?repo=${encodeURIComponent(p.fullName || (p.owner + '/' + p.name))}`;
        return `<tr>
          <td class="tbl-rank">${rank}</td>
          <td><div class="tbl-project">${p.ownerAvatar ? `<img src="${esc(p.ownerAvatar)}" alt="" loading="lazy">` : ''}<div><div class="tbl-project-name"><a href="${esc(projectUrl)}">${esc(p.name)}</a></div><div class="tbl-project-owner">${esc(p.owner)}</div></div></div></td>
          <td>${(p.stars || 0).toLocaleString()}</td>
          <td class="${gainCls}">${gain > 0 ? '+' : ''}${gain.toLocaleString()}</td>
          <td class="${pctCls}">${pct > 0 ? '+' : ''}${pct.toFixed(1)}%</td>
          <td>${(p.trend_momentum || 0).toFixed(1)}</td>
          <td>${(p.forks || 0).toLocaleString()}</td>
          <td>${p.language ? `<span class="rank-lang-dot" style="background:${langColor}"></span> ${esc(p.language)}` : ''}</td>
        </tr>`;
      }).join('');
      table.innerHTML = `<thead><tr>${thHtml}</tr></thead><tbody>${rowsHtml}</tbody>`;
      table.querySelectorAll('th[data-sort]').forEach(th => {
        th.addEventListener('click', () => {
          const key = th.dataset.sort;
          if (state.globalTableSort.col === key) {
            state.globalTableSort.dir = state.globalTableSort.dir === 'desc' ? 'asc' : 'desc';
          } else {
            state.globalTableSort.col = key;
            state.globalTableSort.dir = 'desc';
          }
          renderGlobalTop25();
        });
      });
    }

    function renderMovers() {
      const isGainers = state.moversTab === 'gainers';
      const range = state.moversRange;
      const starsKey = range === '1d' ? 'trend_stars1d' : 'trend_stars7d';
      const pctKey = range === '1d' ? 'trend_starsPct1d' : 'trend_starsPct7d';
      const tabLabel = isGainers ? 'gainers' : 'cooling';

      // Gainers: highest positive growth. Cooling: smallest positive growth (slowing down)
      const withGrowth = [...state.trendingProjects].filter(p => (p[starsKey] || 0) > 0);

      const pctSorted = [...withGrowth]
        .sort((a, b) => isGainers
          ? (b[pctKey] || 0) - (a[pctKey] || 0)
          : (a[pctKey] || 0) - (b[pctKey] || 0))
        .slice(0, 10);

      const absSorted = [...withGrowth]
        .sort((a, b) => isGainers
          ? (b[starsKey] || 0) - (a[starsKey] || 0)
          : (a[starsKey] || 0) - (b[starsKey] || 0))
        .slice(0, 10);

      const pctContainer = document.getElementById('movers-pct-list');
      if (pctSorted.length === 0) {
        pctContainer.innerHTML = `<p style="font-size:13px;color:var(--text-muted)">No ${tabLabel} data yet</p>`;
      } else {
        pctContainer.innerHTML = pctSorted.map((p, i) => {
          const val = (p[pctKey] || 0);
          return `<div class="mover-row">
            <span class="mover-rank">${i + 1}.</span>
            <span class="mover-name"><a href="/project?repo=${encodeURIComponent(p.fullName)}">${esc(p.name)}</a></span>
            <span class="mover-val ${isGainers ? 'positive' : 'cooling'}">${val >= 0 ? '+' : ''}${val.toFixed(1)}%</span>
          </div>`;
        }).join('');
      }

      const absContainer = document.getElementById('movers-abs-list');
      if (absSorted.length === 0) {
        absContainer.innerHTML = `<p style="font-size:13px;color:var(--text-muted)">No ${tabLabel} data yet</p>`;
      } else {
        absContainer.innerHTML = absSorted.map((p, i) => {
          const val = (p[starsKey] || 0);
          return `<div class="mover-row">
            <span class="mover-rank">${i + 1}.</span>
            <span class="mover-name"><a href="/project?repo=${encodeURIComponent(p.fullName)}">${esc(p.name)}</a></span>
            <span class="mover-val ${isGainers ? 'positive' : 'cooling'}">${val >= 0 ? '+' : ''}${val.toLocaleString()}</span>
          </div>`;
        }).join('');
      }

    }

    function renderDevelopers() {
      const container = document.getElementById('dev-grid');
      const devMap = new Map();
      state.trendingProjects.forEach(p => {
        const owner = p.owner;
        if (!owner) return;
        if (!devMap.has(owner)) {
          devMap.set(owner, { owner, avatar: p.ownerAvatar, repos: [], totalStars7d: 0, totalStars: 0, maxMomentum: 0 });
        }
        const dev = devMap.get(owner);
        dev.repos.push(p.name);
        dev.totalStars7d += (p.trend_stars7d || 0);
        dev.totalStars += (p.stars || 0);
        dev.maxMomentum = Math.max(dev.maxMomentum, p.trend_momentum || 0);
      });

      const devs = [...devMap.values()]
        .filter(d => d.repos.length >= 1)
        .sort((a, b) => (b.totalStars7d - a.totalStars7d) || (b.totalStars - a.totalStars))
        .slice(0, 15);

      if (devs.length === 0) {
        renderTrendingEmptyState(container, 'users', 'No developer data yet');
        return;
      }

      container.innerHTML = devs.map((d, i) => `
        <div class="dev-card">
          <span class="dev-rank">#${i + 1}</span>
          ${d.avatar ? `<img class="dev-avatar" src="${avatarSized(d.avatar, 80)}" alt="${esc(d.owner)}" width="40" height="40" loading="lazy">` : ''}
          <div class="dev-info">
            <div class="dev-name"><a href="https://github.com/${esc(d.owner)}" target="_blank" rel="noopener">${esc(d.owner)}</a></div>
            <div class="dev-stats">
              <span>${d.repos.length} repo${d.repos.length > 1 ? 's' : ''}</span>
              ${d.totalStars7d > 0
                ? `<span style="color:#34d399">+${d.totalStars7d.toLocaleString()} stars/wk</span>`
                : `<span style="color:var(--text-muted)">${d.totalStars.toLocaleString()} total stars</span>`}
              ${d.maxMomentum > 0 ? `<span>Peak: ${d.maxMomentum.toFixed(0)}</span>` : ''}
            </div>
            <div class="dev-repos">${d.repos.slice(0, 3).map(r => esc(r)).join(', ')}${d.repos.length > 3 ? ` +${d.repos.length - 3} more` : ''}</div>
          </div>
        </div>`).join('');

    }

    // ── Trending: Filters & Controls ──────────────────────
    function populateTrendingFilters() {
      const aiCats = new Set(), aiLangs = new Set();
      state.trendingAiProjects.forEach(p => { aiCats.add(inferCategory(p)); if (p.language) aiLangs.add(p.language); });
      fillTrendingSelect('ai-filter-category', aiCats, CATEGORY_ORDER);
      fillTrendingSelect('ai-filter-language', aiLangs);

      const gCats = new Set(), gLangs = new Set();
      state.trendingGlobalProjects.forEach(p => { gCats.add(inferCategory(p)); if (p.language) gLangs.add(p.language); });
      fillTrendingSelect('global-filter-category', gCats, CATEGORY_ORDER);
      fillTrendingSelect('global-filter-language', gLangs);
    }

    function fillTrendingSelect(id, valueSet, order) {
      const sel = document.getElementById(id);
      // Clear existing options except "All"
      while (sel.options.length > 1) sel.remove(1);
      const sorted = order
        ? order.filter(c => c !== 'All' && valueSet.has(c))
        : [...valueSet].sort();
      sorted.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v; opt.textContent = v;
        sel.appendChild(opt);
      });
    }

    function updateTrendingHeroStats() {
      const tracked = state.trendingProjects.length;
      const hot = state.trendingProjects.filter(p => p.trend_label === 'hot').length;
      const rising = state.trendingProjects.filter(p => p.trend_label === 'rising').length;
      const totalStars = state.trendingProjects.reduce((s, p) => s + (p.trend_stars7d || 0), 0);

      document.getElementById('stat-tracked').dataset.target = tracked;
      document.getElementById('stat-hot').dataset.target = hot;
      document.getElementById('stat-rising').dataset.target = rising;
      document.getElementById('stat-stars-week').dataset.target = Math.max(0, totalStars);
      // Animate trending hero stats
      document.querySelectorAll('#trending-page [data-target]').forEach(el => {
        const target = parseInt(el.dataset.target, 10);
        if (target === 0) return;
        const duration = 1200, start = performance.now();
        function tick(now) {
          const elapsed = now - start;
          const progress = Math.min(elapsed / duration, 1);
          const eased = 1 - Math.pow(1 - progress, 3);
          el.textContent = Math.round(eased * target).toLocaleString();
          if (progress < 1) requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
      });

      // Freshness indicator
      const freshEl = document.getElementById('hero-freshness');
      const latestUpdate = state.trendingProjects.reduce((latest, p) => {
        const t = p.trend_updatedAt?.toDate ? p.trend_updatedAt.toDate() : (p.trend_updatedAt ? new Date(p.trend_updatedAt) : null);
        return t && t > latest ? t : latest;
      }, new Date(0));
      if (latestUpdate.getTime() > 0) {
        const hoursAgo = Math.round((Date.now() - latestUpdate.getTime()) / (1000 * 60 * 60));
        freshEl.textContent = hoursAgo < 1 ? 'Updated less than an hour ago' : `Last updated ${hoursAgo} hour${hoursAgo !== 1 ? 's' : ''} ago`;
      }
    }

    function renderCategoryLeaderboards() {
      const catMap = new Map();
      state.trendingProjects.forEach(p => {
        const cat = inferCategory(p);
        if (!catMap.has(cat)) catMap.set(cat, []);
        catMap.get(cat).push(p);
      });
      // Only show categories with 3+ projects
      const validCats = [...catMap.entries()]
        .filter(([, list]) => list.length >= 3)
        .sort((a, b) => {
          const order = CATEGORY_ORDER;
          return (order.indexOf(a[0]) === -1 ? 99 : order.indexOf(a[0])) - (order.indexOf(b[0]) === -1 ? 99 : order.indexOf(b[0]));
        });

      const tabsEl = document.getElementById('cat-lb-tabs');
      const contentEl = document.getElementById('cat-lb-content');
      if (validCats.length === 0) {
        tabsEl.innerHTML = '';
        contentEl.innerHTML = '<p style="font-size:13px;color:var(--text-muted)">Not enough data for category leaderboards yet</p>';
        return;
      }
      // Auto-select first category if none active or if active was removed
      if (!state.catLbActive || !catMap.has(state.catLbActive)) {
        state.catLbActive = validCats[0][0];
      }
      tabsEl.innerHTML = validCats.map(([cat]) =>
        `<button class="cat-lb-tab${cat === state.catLbActive ? ' active' : ''}" data-cat="${esc(cat)}">${esc(cat)}</button>`
      ).join('');
      const catProjects = (catMap.get(state.catLbActive) || [])
        .sort((a, b) => (b.trend_momentum || 0) - (a.trend_momentum || 0))
        .slice(0, 10);
      contentEl.innerHTML = catProjects.map((p, i) => renderRankCard(p, i + 1)).join('');

    }

    function renderWeeklyRecap() {
      const container = document.getElementById('recap-banner-container');
      // Check if dismissed this week
      const now = new Date();
      const yearStart = new Date(now.getFullYear(), 0, 1);
      const weekNum = Math.ceil(((now - yearStart) / 86400000 + yearStart.getDay() + 1) / 7);
      const dismissKey = `recap-dismissed-${now.getFullYear()}-W${weekNum}`;
      if (localStorage.getItem(dismissKey)) { container.style.display = 'none'; return; }

      const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
      const newThisWeek = state.trendingProjects.filter(p => isNewThisWeek(p)).length;
      const hotProjects = state.trendingProjects.filter(p => p.trend_label === 'hot').length;
      const crossed10k = state.trendingProjects.filter(p => {
        const prev = (p.stars || 0) - (p.trend_stars7d || 0);
        return prev < 10000 && (p.stars || 0) >= 10000;
      }).length;

      if (newThisWeek === 0 && hotProjects === 0) { container.style.display = 'none'; return; }

      const parts = [];
      if (newThisWeek > 0) parts.push(`<strong>${newThisWeek}</strong> new project${newThisWeek !== 1 ? 's' : ''} added`);
      if (hotProjects > 0) parts.push(`<strong>${hotProjects}</strong> hot project${hotProjects !== 1 ? 's' : ''}`);
      if (crossed10k > 0) parts.push(`<strong>${crossed10k}</strong> project${crossed10k !== 1 ? 's' : ''} crossed 10k stars`);

      container.style.display = '';
      container.innerHTML = `
        <div class="recap-banner">
          <span class="recap-banner-icon">${icon('sparkles', 24, 'style="color:#8b5cf6"')}</span>
          <div class="recap-banner-text">This week: ${parts.join(' \u00B7 ')}</div>
          <button class="recap-banner-dismiss" id="recap-dismiss" aria-label="Dismiss">${icon('x', 16)}</button>
        </div>`;

      document.getElementById('recap-dismiss').addEventListener('click', () => {
        localStorage.setItem(dismissKey, '1');
        container.style.display = 'none';
      });
    }

    function renderTrendingAll() {
      renderCategoryLeaderboards();
      renderAiTop25();
      renderGlobalTop25();
      renderMovers();
      renderDevelopers();
    }

    function initTrendingControls() {
      // Per-section filters
      wireTrendingFilter('ai', state.aiFilter, renderAiTop25);
      wireTrendingFilter('global', state.globalFilter, renderGlobalTop25);

      // Time range toggle
      document.querySelectorAll('#time-toggle .time-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('#time-toggle .time-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.trendTimeRange = btn.dataset.range;
          renderTrendingAll();
        });
      });

      // Global view toggle (cards / table)
      document.querySelectorAll('#global-view-toggle .view-toggle-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('#global-view-toggle .view-toggle-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.globalView = btn.dataset.view;
          renderGlobalTop25();
        });
      });

      // Movers tab toggle (gainers / cooling)
      document.querySelectorAll('#movers-tab-group .movers-tab').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('#movers-tab-group .movers-tab').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.moversTab = btn.dataset.tab;
          renderMovers();
        });
      });

      // Movers time toggle
      document.querySelectorAll('#movers-time-toggle .movers-tab').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('#movers-time-toggle .movers-tab').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.moversRange = btn.dataset.range;
          renderMovers();
        });
      });

      // Category leaderboard tabs
      document.getElementById('cat-lb-tabs')?.addEventListener('click', (e) => {
        const tab = e.target.closest('.cat-lb-tab');
        if (!tab) return;
        document.querySelectorAll('#cat-lb-tabs .cat-lb-tab').forEach(b => b.classList.remove('active'));
        tab.classList.add('active');
        state.catLbActive = tab.dataset.cat;
        renderCategoryLeaderboards();
      });
    }

    function wireTrendingFilter(prefix, filter, renderFn) {
      document.getElementById(`${prefix}-filter-category`).addEventListener('change', (e) => {
        filter.category = e.target.value;
        filter.page = 1;
        renderFn();
      });
      document.getElementById(`${prefix}-filter-language`).addEventListener('change', (e) => {
        filter.language = e.target.value;
        filter.page = 1;
        renderFn();
      });
      let timer;
      document.getElementById(`${prefix}-filter-search`).addEventListener('input', (e) => {
        clearTimeout(timer);
        timer = setTimeout(() => {
          filter.search = e.target.value.trim();
          filter.page = 1;
          renderFn();
        }, 300);
      });
    }

    // ── Trending: Use shared data from loadAllProjects (0 extra reads) ──────
    async function loadTrendingData() {
      if (state.trendingLoaded) {
        renderTrendingAll();
        populateTrendingFilters();
        updateTrendingHeroStats();
        renderWeeklyRecap();
        initTrendingControls();
        return;
      }
      // Data not yet loaded (unlikely — loadAllProjects runs on init)
      // Wait for it instead of making a separate Firestore call
    }

    // ── Init ────────────────────────────────────────────
    animateStats();
    renderHeroTrending();

    // Defer Firestore load until after first paint to improve FCP
    requestAnimationFrame(() => { setTimeout(loadAllProjects, 0); });
  </script>
</body>
</html>
