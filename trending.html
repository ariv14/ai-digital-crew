<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="view-transition" content="same-origin">
  <title>Trending AI Projects — AI Digital Crew</title>
  <meta name="description" content="Discover the hottest open-source AI projects. Momentum scoring, sparklines, AI categories, and daily updates.">
  <meta property="og:title" content="Trending AI Projects — AI Digital Crew">
  <meta property="og:description" content="Discover the hottest open-source AI projects. Updated daily.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://aidigitalcrew.com/trending">
  <meta property="og:image" content="https://aidigitalcrew.com/og-image.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Trending AI Projects — AI Digital Crew">
  <meta name="twitter:description" content="Discover the hottest open-source AI projects. Updated daily.">
  <link rel="canonical" href="https://aidigitalcrew.com/trending">
  <meta name="theme-color" content="#0a0f1c">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet"></noscript>
  <script src="https://unpkg.com/lucide@0.460.0/dist/umd/lucide.min.js" defer></script>
  <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin>
  <style>
    :root {
      --bg: #0a0f1c;
      --surface: rgba(255,255,255,0.05);
      --border: rgba(255,255,255,0.1);
      --primary: #3b82f6;
      --primary-end: #8b5cf6;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --radius: 16px;
      --success: #10b981;
      --error: #ef4444;
    }
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden;min-height:100vh}
    h1,h2,h3,h4{font-family:'Space Grotesk',sans-serif}
    a{color:inherit;text-decoration:none}
    button{font-family:inherit;cursor:pointer;border:none;background:none;color:inherit}

    .orb{position:fixed;border-radius:50%;filter:blur(80px);opacity:0.4;z-index:0;pointer-events:none;will-change:transform;contain:strict}
    #orb-1{width:500px;height:500px;background:#3b82f6;top:-10%;left:-5%;animation:o1 20s ease-in-out infinite}
    #orb-2{width:400px;height:400px;background:#8b5cf6;top:40%;right:-10%;animation:o2 25s ease-in-out infinite}
    #orb-3{width:350px;height:350px;background:#06b6d4;bottom:-5%;left:30%;animation:o3 22s ease-in-out infinite}
    @keyframes o1{0%,100%{transform:translate(0,0)}33%{transform:translate(60px,80px)}66%{transform:translate(-40px,50px)}}
    @keyframes o2{0%,100%{transform:translate(0,0)}33%{transform:translate(-70px,-50px)}66%{transform:translate(50px,60px)}}
    @keyframes o3{0%,100%{transform:translate(0,0)}33%{transform:translate(80px,-40px)}66%{transform:translate(-60px,-70px)}}

    .glass{background:var(--surface);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--border);border-radius:var(--radius)}

    /* View Transitions */
    @view-transition{navigation:auto}
    nav{view-transition-name:navbar}
    ::view-transition-old(navbar),::view-transition-new(navbar){animation:none}
    ::view-transition-old(root){animation:fadeOut .15s ease}
    ::view-transition-new(root){animation:fadeIn .15s ease}
    @keyframes fadeOut{from{opacity:1}to{opacity:0}}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}

    /* Nav */
    nav{position:sticky;top:0;z-index:100;padding:16px 32px;display:flex;align-items:center;justify-content:space-between;transition:all .3s ease}
    nav.scrolled{backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);background:rgba(10,15,28,.8);border-bottom:1px solid var(--border)}
    .nav-logo{display:flex;align-items:center;gap:10px;font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:20px}
    .nav-logo i{color:var(--primary)}
    .nav-links{display:flex;align-items:center;gap:32px}
    .nav-links a{color:var(--text-muted);font-size:15px;font-weight:500;transition:color .2s}
    .nav-links a:hover{color:var(--text)}
    .nav-links a.active{color:var(--text);position:relative}
    .nav-links a.active::after{content:'';position:absolute;bottom:-4px;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--primary),var(--primary-end));border-radius:1px}
    .nav-right{display:flex;align-items:center;gap:16px}
    .btn-primary{display:inline-flex;align-items:center;gap:8px;padding:12px 28px;background:linear-gradient(135deg,var(--primary),var(--primary-end));background-size:200% 200%;color:#fff;font-weight:600;font-size:15px;border-radius:12px;border:none;transition:all .3s ease}
    .btn-primary:hover{background-position:100% 0;transform:translateY(-2px);box-shadow:0 0 24px rgba(59,130,246,.4)}
    .btn-outlined{display:inline-flex;align-items:center;gap:8px;padding:12px 28px;background:transparent;color:var(--text);font-weight:600;font-size:15px;border-radius:12px;border:1px solid var(--border);transition:all .3s ease}
    .btn-outlined:hover{border-color:var(--primary);color:var(--primary);transform:translateY(-2px)}
    .btn-small{padding:8px 16px;font-size:13px;border-radius:8px}
    .nav-avatar{width:36px;height:36px;border-radius:50%;border:2px solid var(--border);cursor:pointer;transition:border-color .2s;object-fit:cover}
    .nav-avatar:hover{border-color:var(--primary)}
    .avatar-dropdown{position:absolute;top:60px;right:32px;min-width:180px;padding:8px;display:none;flex-direction:column;z-index:200}
    .avatar-dropdown.open{display:flex}
    .avatar-dropdown a,.avatar-dropdown button{display:flex;align-items:center;gap:10px;padding:10px 14px;font-size:14px;color:var(--text-muted);border-radius:8px;transition:all .2s;width:100%;text-align:left}
    .avatar-dropdown a:hover,.avatar-dropdown button:hover{background:rgba(255,255,255,.05);color:var(--text)}
    .dropdown-divider{height:1px;background:var(--border);margin:4px 0}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);z-index:500;display:none;align-items:center;justify-content:center;padding:24px;overscroll-behavior:contain}
    .modal-overlay.open{display:flex}
    .modal{width:100%;max-width:480px;padding:32px;position:relative;max-height:90vh;overflow-y:auto}
    .modal-close{position:absolute;top:16px;right:16px;color:var(--text-muted);cursor:pointer;padding:4px;border-radius:8px;transition:color .2s;background:none;border:none}
    .modal-close:hover{color:var(--text)}
    .modal h2{font-size:24px;margin-bottom:8px}
    .modal .modal-subtitle{font-size:14px;color:var(--text-muted);margin-bottom:28px}
    .oauth-btn{display:flex;align-items:center;gap:12px;width:100%;padding:14px 20px;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s;border:none;margin-bottom:12px}
    .oauth-btn:hover{transform:translateY(-1px)}
    .oauth-btn.github{background:#24292e;color:#fff}
    .oauth-btn.google{background:#fff;color:#1f2937}
    .oauth-btn.facebook{background:#1877F2;color:#fff}
    .oauth-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
    .oauth-spinner{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}
    .oauth-btn.google .oauth-spinner{border-color:rgba(0,0,0,.2);border-top-color:#1f2937}
    @keyframes spin{to{transform:rotate(360deg)}}
    #toast-container{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
    .toast{min-width:280px;padding:14px 18px;display:flex;align-items:center;gap:10px;font-size:14px;pointer-events:auto;animation:slideIn .3s ease forwards}
    .toast.removing{animation:slideOut .3s ease forwards}
    .toast.success{border-left:4px solid var(--success)}
    .toast.error{border-left:4px solid var(--error)}
    .toast.info{border-left:4px solid var(--primary)}
    .toast i{flex-shrink:0}
    @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}
    body.modal-open{overflow:hidden}
    .hamburger{display:none;background:none;border:none;color:var(--text);cursor:pointer}
    .mobile-nav-icons{display:none;align-items:center;gap:10px}
    .mobile-nav-icon{display:flex;align-items:center;justify-content:center;background:none;border:none;color:var(--text-muted);cursor:pointer;padding:4px;text-decoration:none;transition:color .2s}
    .mobile-nav-icon:hover{color:var(--text)}
    .mobile-nav-icon.active{color:var(--primary)}
    .mobile-menu{display:none;position:absolute;top:64px;left:16px;right:16px;padding:16px;flex-direction:column;gap:12px;z-index:150;background:rgba(15,23,42,.97);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:var(--radius)}
    .mobile-menu.open{display:flex}
    .mobile-menu a{color:var(--text-muted);font-size:16px;padding:10px;border-radius:8px;transition:all .2s}
    .mobile-menu a:hover{color:var(--text);background:rgba(255,255,255,.05)}
    .mobile-menu a.active{color:var(--text)}

    /* Hero */
    .radar-hero{position:relative;z-index:1;text-align:center;padding:100px 24px 40px}
    .radar-hero h1{font-size:52px;font-weight:700;line-height:1.1;background:linear-gradient(135deg,var(--text),#60a5fa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .radar-hero .subtitle{font-size:18px;color:var(--text-muted);max-width:540px;margin:16px auto 0}
    .hero-freshness{font-size:13px;color:var(--text-muted);margin-top:12px;opacity:.7}
    .hero-stats{display:flex;gap:20px;margin-top:36px;justify-content:center;flex-wrap:wrap}
    .hero-stat{padding:20px 32px;text-align:center;min-width:130px}
    .hero-stat .stat-num{font-family:'Space Grotesk',sans-serif;font-size:36px;font-weight:700;color:#60a5fa}
    .hero-stat .stat-lbl{font-size:13px;color:var(--text-muted);margin-top:4px}

    /* Time toggle */
    .time-toggle{display:flex;gap:4px;justify-content:center;margin-top:24px}
    .time-btn{padding:6px 20px;font-size:13px;font-weight:600;border-radius:10px;border:1px solid var(--border);color:var(--text-muted);background:transparent;cursor:pointer;transition:all .2s}
    .time-btn:hover{border-color:var(--primary);color:var(--text)}
    .time-btn.active{background:linear-gradient(135deg,var(--primary),var(--primary-end));border-color:transparent;color:#fff}

    /* Sections */
    section{position:relative;z-index:1;padding:60px 24px}
    .section-container{max-width:1100px;margin:0 auto}
    .section-header{margin-bottom:32px}
    .section-title{font-size:28px;font-weight:700;display:flex;align-items:center;gap:10px}
    .section-subtitle{font-size:15px;color:var(--text-muted);margin-top:6px}

    /* Rank Card */
    .rank-card{display:flex;align-items:flex-start;gap:16px;padding:20px;border-radius:14px;border:1px solid var(--border);background:var(--surface);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);transition:all .3s ease;margin-bottom:12px}
    .rank-card:hover{border-color:rgba(59,130,246,.3);transform:translateX(4px)}
    .rank-num{font-family:'Space Grotesk',sans-serif;font-size:22px;font-weight:700;color:var(--text-muted);min-width:36px;text-align:center;flex-shrink:0;padding-top:2px}
    .rank-num.gold{color:#fbbf24;text-shadow:0 0 12px rgba(251,191,36,.4)}
    .rank-num.silver{color:#d1d5db;text-shadow:0 0 10px rgba(209,213,219,.3)}
    .rank-num.bronze{color:#d97706;text-shadow:0 0 10px rgba(217,119,6,.3)}
    .rank-body{flex:1;min-width:0}
    .rank-header{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:4px}
    .rank-name{font-size:17px;font-weight:700}
    .rank-name a{color:var(--text);transition:color .2s}
    .rank-name a:hover{color:var(--primary)}
    .rank-owner{font-size:13px;color:var(--text-muted)}
    .rank-desc{font-size:13px;color:var(--text-muted);line-height:1.5;margin:6px 0 10px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .rank-meta{display:flex;align-items:center;gap:12px;flex-wrap:wrap;font-size:12px;color:var(--text-muted)}
    .rank-meta span{display:flex;align-items:center;gap:4px}
    .rank-lang-dot{width:9px;height:9px;border-radius:50%;display:inline-block}

    /* Trend badge */
    .trend-badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;font-size:11px;font-weight:600;border-radius:6px;white-space:nowrap}
    .trend-badge.hot{background:rgba(239,68,68,.15);color:#f87171}
    .trend-badge.rising{background:rgba(16,185,129,.15);color:#34d399}
    .trend-badge.steady{background:rgba(148,163,184,.12);color:#94a3b8}
    .trend-badge.declining{background:rgba(148,163,184,.08);color:#64748b}
    .trend-badge.new-project{background:rgba(59,130,246,.15);color:#60a5fa}
    .trend-badge i{flex-shrink:0}

    /* New this week badge */
    .new-week-badge{display:inline-flex;align-items:center;gap:3px;padding:2px 7px;font-size:10px;font-weight:700;border-radius:5px;background:rgba(251,191,36,.15);color:#fbbf24;text-transform:uppercase;letter-spacing:.5px}

    /* Sparkline */
    .trend-sparkline{display:inline-flex;align-items:center;vertical-align:middle}
    .trend-sparkline svg{display:block}

    /* Star gain */
    .star-gain{font-size:12px;font-weight:600}
    .star-gain.positive{color:#34d399}
    .star-gain.negative{color:#f87171}
    .star-gain.neutral{color:var(--text-muted)}

    /* Category badge */
    .category-badge{display:inline-block;padding:2px 9px;font-size:11px;font-weight:600;border-radius:6px;background:rgba(139,92,246,.15);color:#a78bfa}

    /* Momentum bar */
    .momentum-bar{margin-top:8px;display:flex;align-items:center;gap:8px}
    .momentum-track{flex:1;height:4px;background:rgba(255,255,255,.06);border-radius:2px;overflow:hidden}
    .momentum-fill{height:100%;border-radius:2px;transition:width .6s ease}
    .momentum-fill.hot{background:linear-gradient(90deg,#ef4444,#f97316)}
    .momentum-fill.rising{background:linear-gradient(90deg,#10b981,#3b82f6)}
    .momentum-fill.steady{background:#64748b}
    .momentum-fill.declining{background:#475569}
    .momentum-fill.new-project{background:linear-gradient(90deg,#3b82f6,#8b5cf6)}
    .momentum-val{font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:600;color:var(--text-muted);min-width:32px;text-align:right}

    /* Filters */
    .filter-bar{display:flex;gap:12px;margin-bottom:28px;flex-wrap:wrap;align-items:center}
    .filter-group{display:flex;align-items:center;gap:6px}
    .filter-label{font-size:12px;color:var(--text-muted);font-weight:500;text-transform:uppercase;letter-spacing:.5px}
    .sort-btn{padding:7px 16px;font-size:13px;font-weight:600;border-radius:10px;border:1px solid var(--border);color:var(--text-muted);background:transparent;cursor:pointer;transition:all .2s}
    .sort-btn:hover{border-color:var(--primary);color:var(--text)}
    .sort-btn.active{background:linear-gradient(135deg,var(--primary),var(--primary-end));border-color:transparent;color:#fff}
    .filter-select{padding:7px 14px;font-size:13px;font-weight:500;border-radius:10px;border:1px solid var(--border);color:var(--text);background:rgba(255,255,255,.05);cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:30px}
    .filter-select:focus{outline:none;border-color:var(--primary)}
    .filter-select option{background:#1e293b;color:var(--text)}

    /* Search input */
    .search-input{padding:8px 14px 8px 36px;font-size:13px;font-weight:500;border-radius:10px;border:1px solid var(--border);color:var(--text);background:rgba(255,255,255,.05);width:200px;transition:all .2s;font-family:inherit}
    .search-input::placeholder{color:var(--text-muted)}
    .search-input:focus{outline:none;border-color:var(--primary);width:260px}
    .search-wrap{position:relative;display:flex;align-items:center}
    .search-wrap i{position:absolute;left:10px;color:var(--text-muted);pointer-events:none}

    /* Movers grid */
    .movers-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .movers-card{padding:20px;border-radius:14px;border:1px solid var(--border);background:var(--surface);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}

    /* Pagination */
    .pagination{display:flex;align-items:center;justify-content:center;gap:6px;margin-top:20px}
    .page-btn{padding:6px 14px;font-size:13px;font-weight:600;border-radius:8px;border:1px solid var(--border);color:var(--text-muted);background:transparent;cursor:pointer;transition:all .2s}
    .page-btn:hover:not(:disabled){border-color:var(--primary);color:var(--text)}
    .page-btn.active{background:linear-gradient(135deg,var(--primary),var(--primary-end));border-color:transparent;color:#fff}
    .page-btn:disabled{opacity:.4;cursor:default}
    .page-info{font-size:13px;color:var(--text-muted);padding:0 8px}
    .movers-title{font-size:14px;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:6px}
    .mover-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.04)}
    .mover-row:last-child{border-bottom:none}
    .mover-rank{font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:700;color:var(--text-muted);min-width:20px}
    .mover-name{font-size:13px;font-weight:600;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .mover-name a{color:var(--text);transition:color .2s}
    .mover-name a:hover{color:var(--primary)}
    .mover-val{font-size:13px;font-weight:700;white-space:nowrap}
    .mover-val.pct{color:#34d399}
    .mover-val.abs{color:#60a5fa}

    /* Developer card */
    .dev-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px}
    .dev-card{display:flex;align-items:center;gap:14px;padding:16px 20px;border-radius:14px;border:1px solid var(--border);background:var(--surface);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);transition:all .3s ease}
    .dev-card:hover{border-color:rgba(59,130,246,.3);transform:translateY(-2px)}
    .dev-rank{font-family:'Space Grotesk',sans-serif;font-size:18px;font-weight:700;color:var(--text-muted);min-width:28px}
    .dev-avatar{width:40px;height:40px;border-radius:50%;border:2px solid var(--border);flex-shrink:0}
    .dev-info{flex:1;min-width:0}
    .dev-name{font-size:15px;font-weight:700}
    .dev-name a{color:var(--text);transition:color .2s}
    .dev-name a:hover{color:var(--primary)}
    .dev-stats{font-size:12px;color:var(--text-muted);margin-top:2px;display:flex;gap:12px;flex-wrap:wrap}
    .dev-repos{font-size:11px;color:var(--text-muted);margin-top:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    /* Empty state */
    .empty-state{text-align:center;padding:80px 20px}
    .empty-state i{color:var(--text-muted);margin-bottom:16px}
    .empty-state p{color:var(--text-muted);font-size:16px;margin-top:12px}
    .empty-state .subtitle{font-size:14px;margin-top:8px}

    /* Footer */
    footer{position:relative;z-index:1;border-top:1px solid var(--border);padding:48px 24px 24px;margin-top:80px}
    .footer-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:32px}
    .footer-col{display:flex;flex-direction:column;gap:8px}
    .footer-heading{font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:16px;margin-bottom:8px}
    .footer-col a{color:var(--text-muted);font-size:14px;transition:color .2s}
    .footer-col a:hover{color:var(--text)}
    .footer-social{display:flex;gap:12px;justify-content:center;margin-top:32px}
    .footer-social a{color:var(--text-muted);transition:color .2s}
    .footer-social a:hover{color:var(--text)}
    .footer-bottom{text-align:center;margin-top:24px;font-size:13px;color:var(--text-muted)}

    /* Loading skeleton */
    .skeleton-card{overflow:hidden;min-height:80px;border-radius:14px;border:1px solid var(--border);background:var(--surface);margin-bottom:12px;padding:20px}
    .skeleton-line{height:14px;border-radius:7px;background:linear-gradient(90deg,rgba(255,255,255,.04) 25%,rgba(255,255,255,.08) 50%,rgba(255,255,255,.04) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;margin-bottom:10px}
    .skeleton-line.short{width:40%}.skeleton-line.medium{width:65%}.skeleton-line.long{width:90%}.skeleton-line.title{height:18px;width:50%}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    /* Responsive */
    @media(max-width:900px){
      .movers-grid{grid-template-columns:1fr}
      .hero-stats{gap:12px}
      .hero-stat{padding:14px 20px;min-width:100px}
      .hero-stat .stat-num{font-size:28px}
      .dev-grid{grid-template-columns:1fr}
    }
    @media(max-width:768px){
      .nav-links,.nav-right{display:none}
      .hamburger{display:block}
      .mobile-nav-icons{display:flex}
      .radar-hero h1{font-size:36px}
      .radar-hero .subtitle{font-size:15px}
      .hero-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:320px;margin-left:auto;margin-right:auto}
      .hero-stat{min-width:0;padding:14px 12px}
      .filter-bar{gap:8px}
      .filter-group{flex-wrap:wrap}
      .footer-grid{grid-template-columns:1fr}
      .search-input{width:100%}
      .search-input:focus{width:100%}
      .search-wrap{width:100%}
    }
  </style>
</head>
<body>
  <div class="orb" id="orb-1" aria-hidden="true"></div>
  <div class="orb" id="orb-2" aria-hidden="true"></div>
  <div class="orb" id="orb-3" aria-hidden="true"></div>

  <nav id="navbar">
    <a href="/" class="nav-logo"><i data-lucide="cpu" style="width:24px;height:24px"></i><span>AI Digital Crew</span></a>
    <div class="nav-links">
      <a href="/">Home</a>
      <a href="/#projects">Projects</a>
      <a href="/#search">Search</a>
      <a href="/trending" class="active">Trending</a>
    </div>
    <div class="nav-right" id="nav-right"></div>
    <div class="mobile-nav-icons">
      <a href="/#search" class="mobile-nav-icon" aria-label="Search"><i data-lucide="search" style="width:20px;height:20px"></i></a>
      <a href="/trending" class="mobile-nav-icon active" aria-label="Trending"><i data-lucide="trending-up" style="width:20px;height:20px"></i></a>
    </div>
    <button class="hamburger" id="hamburger" aria-label="Open menu"><i data-lucide="menu" style="width:24px;height:24px"></i></button>
    <div class="mobile-menu glass" id="mobile-menu">
      <a href="/">Home</a>
      <a href="/#projects">Projects</a>
      <a href="/#search">Search</a>
      <a href="/trending" class="active">Trending</a>
    </div>
    <div class="avatar-dropdown glass" id="avatar-dropdown"></div>
  </nav>

  <main>
    <section class="radar-hero">
      <h1>Trending Projects</h1>
      <p class="subtitle">Track which AI projects are gaining stars, forks, and momentum. Updated daily.</p>
      <p class="hero-freshness" id="hero-freshness"></p>
      <div class="hero-stats">
        <div class="hero-stat glass">
          <div class="stat-num" id="stat-tracked" data-target="0">0</div>
          <div class="stat-lbl">Tracked</div>
        </div>
        <div class="hero-stat glass">
          <div class="stat-num" id="stat-hot" data-target="0">0</div>
          <div class="stat-lbl">Hot</div>
        </div>
        <div class="hero-stat glass">
          <div class="stat-num" id="stat-rising" data-target="0">0</div>
          <div class="stat-lbl">Rising</div>
        </div>
        <div class="hero-stat glass">
          <div class="stat-num" id="stat-stars-week" data-target="0">0</div>
          <div class="stat-lbl">Stars This Week</div>
        </div>
      </div>
      <div class="time-toggle" id="time-toggle">
        <button class="time-btn active" data-range="7d">Last 7 days</button>
        <button class="time-btn" data-range="1d">Last 24h</button>
      </div>
    </section>

    <!-- Section 1: AI Trending Top 25 -->
    <section id="ai-top25-section">
      <div class="section-container">
        <div class="section-header">
          <div class="section-title"><i data-lucide="bot" style="width:24px;height:24px;color:#8b5cf6"></i> AI Trending &mdash; Top 25</div>
          <p class="section-subtitle">The hottest AI &amp; ML projects right now</p>
        </div>
        <div class="filter-bar" id="ai-filter-bar">
          <div class="filter-group">
            <span class="filter-label">Category</span>
            <select class="filter-select" id="ai-filter-category"><option value="All">All</option></select>
          </div>
          <div class="filter-group">
            <span class="filter-label">Language</span>
            <select class="filter-select" id="ai-filter-language"><option value="All">All</option></select>
          </div>
          <div class="filter-group">
            <div class="search-wrap">
              <i data-lucide="search" style="width:14px;height:14px"></i>
              <input type="text" class="search-input" id="ai-filter-search" placeholder="Search AI projects...">
            </div>
          </div>
        </div>
        <div id="ai-top25">
          <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
          <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
          <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
        </div>
        <div class="pagination" id="ai-pagination"></div>
      </div>
    </section>

    <!-- Section 2: Global Trending Top 100 -->
    <section id="global-top25-section">
      <div class="section-container">
        <div class="section-header">
          <div class="section-title"><i data-lucide="trophy" style="width:24px;height:24px;color:#fbbf24"></i> Global Trending &mdash; Top 100</div>
          <p class="section-subtitle">Top projects across all of GitHub</p>
        </div>
        <div class="filter-bar" id="global-filter-bar">
          <div class="filter-group">
            <span class="filter-label">Category</span>
            <select class="filter-select" id="global-filter-category"><option value="All">All</option></select>
          </div>
          <div class="filter-group">
            <span class="filter-label">Language</span>
            <select class="filter-select" id="global-filter-language"><option value="All">All</option></select>
          </div>
          <div class="filter-group">
            <div class="search-wrap">
              <i data-lucide="search" style="width:14px;height:14px"></i>
              <input type="text" class="search-input" id="global-filter-search" placeholder="Search projects...">
            </div>
          </div>
        </div>
        <div id="global-top25">
          <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
          <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
          <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div>
        </div>
        <div class="pagination" id="global-pagination"></div>
      </div>
    </section>

    <!-- Section 3: Biggest Movers -->
    <section id="movers-section">
      <div class="section-container">
        <div class="section-header">
          <div class="section-title"><i data-lucide="zap" style="width:24px;height:24px;color:#fbbf24"></i> Biggest Movers</div>
          <p class="section-subtitle">Projects with the most growth this week</p>
        </div>
        <div class="movers-grid">
          <div class="movers-card" id="movers-pct">
            <div class="movers-title"><i data-lucide="rocket" style="width:16px;height:16px;color:#34d399"></i> Top by % Growth</div>
            <div id="movers-pct-list"></div>
          </div>
          <div class="movers-card" id="movers-abs">
            <div class="movers-title"><i data-lucide="star" style="width:16px;height:16px;color:#60a5fa"></i> Top by Star Gain</div>
            <div id="movers-abs-list"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 4: Trending Developers -->
    <section id="developers-section">
      <div class="section-container">
        <div class="section-header">
          <div class="section-title"><i data-lucide="users" style="width:24px;height:24px;color:#34d399"></i> Trending Developers</div>
          <p class="section-subtitle">Developers with the most momentum across their projects</p>
        </div>
        <div class="dev-grid" id="dev-grid"></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-grid">
      <div class="footer-col">
        <p class="footer-heading">AI Digital Crew</p>
        <a href="/">Home</a>
        <a href="/#projects">Projects</a>
        <a href="https://github.com/ariv14" target="_blank" rel="noopener">GitHub</a>
        <a href="/privacy.html">Privacy Policy</a>
      </div>
      <div class="footer-col">
        <p class="footer-heading">Trending</p>
        <a href="#ai-top25-section">AI Top 25</a>
        <a href="#global-top25-section">Global Top 100</a>
        <a href="#movers-section">Movers</a>
        <a href="#developers-section">Developers</a>
      </div>
      <div class="footer-col">
        <p class="footer-heading">Support</p>
        <a href="https://github.com/ariv14/ai-digital-crew/issues" target="_blank" rel="noopener">Report an Issue</a>
        <a href="mailto:support@aidigitalcrew.com">support@aidigitalcrew.com</a>
      </div>
    </div>
    <div class="footer-social">
      <a href="https://github.com/ariv14" target="_blank" rel="noopener" aria-label="GitHub"><i data-lucide="github" style="width:20px;height:20px"></i></a>
    </div>
    <div class="footer-bottom">
      <a href="https://aidigitalcrew.substack.com" target="_blank" rel="noopener" style="color:var(--primary);font-weight:500">Subscribe to Project of the Day</a>
      <span style="margin:0 12px;opacity:.4">|</span>
      AI Digital Crew &copy; 2026
    </div>
  </footer>

  <div id="toast-container"></div>

  <!-- Login Modal -->
  <div class="modal-overlay" id="login-modal" role="dialog" aria-modal="true" aria-label="Login">
    <div class="modal glass">
      <button class="modal-close" id="login-close" aria-label="Close"><i data-lucide="x" style="width:20px;height:20px"></i></button>
      <h2>Join AI Digital Crew</h2>
      <p class="modal-subtitle">Sign in to submit your AI projects.</p>
      <button class="oauth-btn github" id="btn-github"><i data-lucide="github" style="width:20px;height:20px"></i>Continue with GitHub</button>
      <button class="oauth-btn google" id="btn-google">
        <svg style="width:20px;height:20px" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
        Continue with Google
      </button>
      <button class="oauth-btn facebook" id="btn-facebook">
        <svg style="width:20px;height:20px" viewBox="0 0 24 24" fill="white"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
        Continue with Facebook
      </button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
    import { getAuth, signInWithPopup, GithubAuthProvider, GoogleAuthProvider, FacebookAuthProvider, OAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
    import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

    // ── Firebase config ─────────────────────────────────
    const STAGING_HOSTS = ['staging.aidigitalcrew.com', 'localhost', '127.0.0.1'];
    const isStaging = STAGING_HOSTS.includes(location.hostname);

    const firebaseConfig = isStaging
      ? {
          apiKey: "AIzaSyAH9dWeeHoH6v_UvnhpvLUKoqsm3rrdCPQ",
          authDomain: "ai-digital-crew-staging.firebaseapp.com",
          projectId: "ai-digital-crew-staging",
          storageBucket: "ai-digital-crew-staging.firebasestorage.app",
          messagingSenderId: "155089534574",
          appId: "1:155089534574:web:542a7df0b8c809f22c707f"
        }
      : {
          apiKey: "AIzaSyDq4iZ6y90S9KOsPRP0774iYGu4fXzH-4s",
          authDomain: "ai-digital-crew.firebaseapp.com",
          projectId: "ai-digital-crew",
          storageBucket: "ai-digital-crew.firebasestorage.app",
          messagingSenderId: "67125394484",
          appId: "1:67125394484:web:85f3da113a0b09aeb39e61",
          measurementId: "G-4VHGMK995P"
        };

    if (isStaging) document.title = '[STAGING] ' + document.title;

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ── DOM refs ─────────────────────────────────────────
    const navRight = document.getElementById('nav-right');
    const avatarDropdown = document.getElementById('avatar-dropdown');
    const loginModal = document.getElementById('login-modal');
    const toastContainer = document.getElementById('toast-container');

    // ── Shared utils ────────────────────────────────────
    function esc(t) { if (t == null) return ''; const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
    function refreshIcons() { if (window.lucide) lucide.createIcons(); }

    const LANG_COLORS = {TypeScript:'#3178c6',JavaScript:'#f1e05a',Python:'#3572A5',Rust:'#dea584',Go:'#00ADD8',Java:'#b07219',Ruby:'#701516',C:'#555555','C++':'#f34b7d','C#':'#178600',Swift:'#F05138',Kotlin:'#A97BFF',Shell:'#89e051'};

    const AI_SOURCES = ['trending-ai', 'auto'];
    const AI_CATEGORY_TOPICS = {
      'AI Agents':    ['ai-agents', 'llm-agent', 'autonomous-agents', 'multi-agent', 'mcp', 'computer-use'],
      'LLM / GenAI':  ['llm', 'generative-ai', 'large-language-model', 'rag', 'fine-tuning', 'prompt-engineering'],
      'Data Science':  ['data-science', 'machine-learning', 'deep-learning', 'neural-network', 'mlops'],
    };

    const CATEGORY_TOPICS = {
      'AI Agents':         ['ai-agents', 'llm-agent', 'autonomous-agents', 'multi-agent', 'mcp', 'computer-use'],
      'LLM / GenAI':       ['llm', 'generative-ai', 'large-language-model', 'rag', 'fine-tuning', 'prompt-engineering'],
      'Data Science':      ['data-science', 'machine-learning', 'deep-learning', 'neural-network', 'mlops'],
      'Big Data':          ['big-data', 'data-engineering', 'data-pipeline', 'apache-spark', 'dbt', 'streaming'],
      'DevTools':          ['developer-tools', 'cli', 'devops', 'platform-engineering', 'observability'],
      'Web / Frontend':    ['react', 'nextjs', 'svelte', 'vue', 'typescript', 'tailwindcss', 'webassembly'],
      'Backend / APIs':    ['fastapi', 'rest-api', 'graphql', 'microservices', 'nodejs', 'grpc', 'api'],
      'Mobile':            ['react-native', 'flutter', 'ios', 'android', 'swift', 'kotlin'],
      'Security':          ['security', 'cybersecurity', 'privacy', 'zero-trust', 'pentesting', 'devsecops'],
      'Cloud / Infra':     ['kubernetes', 'docker', 'terraform', 'cloud-native', 'serverless', 'infrastructure'],
      'Blockchain / Web3': ['blockchain', 'web3', 'defi', 'smart-contracts', 'ethereum', 'solidity'],
      'Database':          ['postgresql', 'mongodb', 'redis', 'vector-database', 'sqlite', 'nosql'],
    };
    const CATEGORY_ORDER = ['All', 'AI Agents', 'LLM / GenAI', 'Data Science', 'Big Data', 'DevTools',
      'Web / Frontend', 'Backend / APIs', 'Mobile', 'Security', 'Cloud / Infra', 'Blockchain / Web3', 'Database', 'Other'];

    function inferCategory(project) {
      if (project.category) return project.category;
      const topics = (project.topics || []).map(t => t.toLowerCase());
      for (const [cat, keywords] of Object.entries(CATEGORY_TOPICS)) {
        if (keywords.some(kw => topics.includes(kw))) return cat;
      }
      return 'Other';
    }

    function isAiProject(p) {
      if (AI_SOURCES.includes(p.source)) return true;
      const topics = (p.topics || []).map(t => t.toLowerCase());
      for (const keywords of Object.values(AI_CATEGORY_TOPICS)) {
        if (keywords.some(kw => topics.includes(kw))) return true;
      }
      return false;
    }

    function isNewThisWeek(p) {
      if (!p.autoAddedDate && !p.createdAt) return false;
      const addedStr = p.autoAddedDate || '';
      const addedDate = addedStr ? new Date(addedStr) : (p.createdAt?.toDate ? p.createdAt.toDate() : new Date(p.createdAt));
      const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
      return addedDate.getTime() > weekAgo;
    }

    function trendBadge(p) {
      if (!p.trend_label) return '';
      const icons = { hot: 'flame', rising: 'trending-up', steady: 'minus', declining: 'trending-down', new: 'sparkles' };
      const cls = p.trend_label === 'new' ? 'new-project' : p.trend_label;
      const labels = { hot: 'Hot', rising: 'Rising', steady: 'Steady', declining: 'Cooling', new: 'New' };
      return `<span class="trend-badge ${esc(cls)}"><i data-lucide="${icons[p.trend_label] || 'minus'}" style="width:11px;height:11px"></i>${labels[p.trend_label] || ''}${p.trend_stars7d > 0 ? ` +${p.trend_stars7d.toLocaleString()}` : ''}</span>`;
    }

    function renderSparkline(data) {
      if (!data || data.length < 2) return '';
      const w = 60, h = 20, pad = 2;
      const min = Math.min(...data), max = Math.max(...data);
      const range = max - min || 1;
      const points = data.map((v, i) => {
        const x = pad + (i / (data.length - 1)) * (w - 2 * pad);
        const y = h - pad - ((v - min) / range) * (h - 2 * pad);
        return `${x},${y}`;
      }).join(' ');
      const color = data[data.length - 1] >= data[0] ? '#34d399' : '#f87171';
      return `<span class="trend-sparkline"><svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}"><polyline points="${points}" fill="none" stroke="${color}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>`;
    }

    function starGainHtml(p) {
      const gain = p.trend_stars7d || 0;
      if (gain > 0) return `<span class="star-gain positive">+${gain.toLocaleString()} /wk</span>`;
      if (gain < 0) return `<span class="star-gain negative">${gain.toLocaleString()} /wk</span>`;
      return `<span class="star-gain neutral">No change</span>`;
    }

    function momentumBar(p) {
      const score = p.trend_momentum || 0;
      const cls = p.trend_label === 'new' ? 'new-project' : (p.trend_label || 'steady');
      return `
        <div class="momentum-bar">
          <div class="momentum-track"><div class="momentum-fill ${esc(cls)}" style="width:${Math.min(score, 100)}%"></div></div>
          <span class="momentum-val">${score.toFixed(1)}</span>
        </div>`;
    }

    function animateStats() {
      document.querySelectorAll('[data-target]').forEach(el => {
        const target = parseInt(el.dataset.target, 10);
        if (target === 0) return;
        const duration = 1200;
        const start = performance.now();
        function tick(now) {
          const elapsed = now - start;
          const progress = Math.min(elapsed / duration, 1);
          const eased = 1 - Math.pow(1 - progress, 3);
          el.textContent = Math.round(eased * target).toLocaleString();
          if (progress < 1) requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
      });
    }

    // ── State ───────────────────────────────────────────
    const PAGE_SIZE = 25;
    const state = {
      user: null,
      isLoggedIn: false,
      projects: [],
      aiProjects: [],
      globalProjects: [],
      sort: 'momentum',
      timeRange: '7d',
      aiFilter: { category: 'All', language: 'All', search: '', page: 1 },
      globalFilter: { category: 'All', language: 'All', search: '', page: 1 },
    };

    // ── Sort by time range ──────────────────────────────
    function getSortKey() {
      // For 1d, we use trend_momentum (it already factors recent acceleration)
      // For 7d, same — momentum is 7d-based
      return state.sort;
    }

    const sortFns = {
      momentum: (a, b) => (b.trend_momentum || 0) - (a.trend_momentum || 0),
      stars7d:  (a, b) => (b.trend_stars7d || 0) - (a.trend_stars7d || 0),
      pct:      (a, b) => (b.trend_starsPct7d || 0) - (a.trend_starsPct7d || 0),
    };

    // ── Render rank card ────────────────────────────────
    function renderRankCard(p, rank) {
      const langColor = LANG_COLORS[p.language] || '#888';
      const cat = inferCategory(p);
      const desc = (p.writeup || p.description || '').slice(0, 120);
      const rankCls = rank === 1 ? 'gold' : rank === 2 ? 'silver' : rank === 3 ? 'bronze' : '';
      const newBadge = isNewThisWeek(p) ? '<span class="new-week-badge">New</span>' : '';
      const projectUrl = `/project?repo=${encodeURIComponent(p.fullName || (p.owner + '/' + p.name))}`;

      return `
        <div class="rank-card">
          <div class="rank-num ${rankCls}">#${rank}</div>
          <div class="rank-body">
            <div class="rank-header">
              <span class="rank-name"><a href="${esc(projectUrl)}">${esc(p.name)}</a></span>
              <span class="rank-owner">${esc(p.owner)}</span>
              ${trendBadge(p)}
              ${newBadge}
              ${renderSparkline(p.trend_sparkline)}
            </div>
            <p class="rank-desc">${esc(desc)}</p>
            <div class="rank-meta">
              ${starGainHtml(p)}
              <span><i data-lucide="star" style="width:13px;height:13px"></i> ${(p.stars || 0).toLocaleString()}</span>
              <span><i data-lucide="git-fork" style="width:13px;height:13px"></i> ${(p.forks || 0).toLocaleString()}</span>
              ${p.language ? `<span><span class="rank-lang-dot" style="background:${langColor}"></span> ${esc(p.language)}</span>` : ''}
              <span class="category-badge">${esc(cat)}</span>
            </div>
            ${momentumBar(p)}
          </div>
        </div>`;
    }

    function renderEmptyState(container, icon, msg, sub) {
      container.innerHTML = `
        <div class="empty-state">
          <i data-lucide="${icon}" style="width:48px;height:48px"></i>
          <p>${esc(msg)}</p>
          ${sub ? `<p class="subtitle">${esc(sub)}</p>` : ''}
        </div>`;
      refreshIcons();
    }

    // ── Shared filter + paginate helper ─────────────────
    function filterProjects(projects, filter) {
      let list = [...projects];
      if (filter.category !== 'All') list = list.filter(p => inferCategory(p) === filter.category);
      if (filter.language !== 'All') list = list.filter(p => p.language === filter.language);
      if (filter.search) {
        const q = filter.search.toLowerCase();
        list = list.filter(p =>
          (p.name || '').toLowerCase().includes(q) ||
          (p.owner || '').toLowerCase().includes(q) ||
          (p.description || '').toLowerCase().includes(q) ||
          (p.language || '').toLowerCase().includes(q)
        );
      }
      list.sort(sortFns[getSortKey()] || sortFns.momentum);
      return list;
    }

    function renderPagination(containerId, filter, total, renderFn) {
      const pag = document.getElementById(containerId);
      const pages = Math.ceil(total / PAGE_SIZE);
      if (pages <= 1) { pag.innerHTML = ''; return; }
      let html = `<button class="page-btn" data-page="prev" ${filter.page <= 1 ? 'disabled' : ''}>&laquo;</button>`;
      for (let i = 1; i <= pages; i++) {
        html += `<button class="page-btn${filter.page === i ? ' active' : ''}" data-page="${i}">${i}</button>`;
      }
      html += `<button class="page-btn" data-page="next" ${filter.page >= pages ? 'disabled' : ''}>&raquo;</button>`;
      html += `<span class="page-info">${total} projects</span>`;
      pag.innerHTML = html;
      pag.querySelectorAll('.page-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const v = btn.dataset.page;
          if (v === 'prev') filter.page = Math.max(1, filter.page - 1);
          else if (v === 'next') filter.page = Math.min(pages, filter.page + 1);
          else filter.page = parseInt(v, 10);
          renderFn();
        });
      });
    }

    // ── Section 1: AI Top 25 ────────────────────────────
    function renderAiTop25() {
      const container = document.getElementById('ai-top25');
      const filtered = filterProjects(state.aiProjects, state.aiFilter);

      if (filtered.length === 0) {
        container.innerHTML = '';
        renderEmptyState(container, 'bot', state.aiFilter.search || state.aiFilter.category !== 'All' || state.aiFilter.language !== 'All' ? 'No projects match these filters' : 'No AI trending data yet', state.aiFilter.search ? '' : 'The daily pipeline hasn\'t run yet. Check back tomorrow!');
        document.getElementById('ai-pagination').innerHTML = '';
        return;
      }

      const start = (state.aiFilter.page - 1) * PAGE_SIZE;
      const page = filtered.slice(start, start + PAGE_SIZE);
      container.innerHTML = page.map((p, i) => renderRankCard(p, start + i + 1)).join('');
      refreshIcons();
      renderPagination('ai-pagination', state.aiFilter, filtered.length, renderAiTop25);
    }

    // ── Section 2: Global Top 100 ────────────────────────
    function renderGlobalTop25() {
      const container = document.getElementById('global-top25');
      const filtered = filterProjects(state.globalProjects, state.globalFilter);

      if (filtered.length === 0) {
        container.innerHTML = '';
        renderEmptyState(container, 'radar', state.globalFilter.search || state.globalFilter.category !== 'All' || state.globalFilter.language !== 'All' ? 'No projects match these filters' : 'No trending data yet', state.globalFilter.search ? '' : 'The daily pipeline hasn\'t run yet. Check back tomorrow!');
        document.getElementById('global-pagination').innerHTML = '';
        return;
      }

      const start = (state.globalFilter.page - 1) * PAGE_SIZE;
      const page = filtered.slice(start, start + PAGE_SIZE);
      container.innerHTML = page.map((p, i) => renderRankCard(p, start + i + 1)).join('');
      refreshIcons();
      renderPagination('global-pagination', state.globalFilter, filtered.length, renderGlobalTop25);
    }

    // ── Populate filter dropdowns ───────────────────────
    function populateFilters() {
      // AI section filters
      const aiCats = new Set(), aiLangs = new Set();
      state.aiProjects.forEach(p => { aiCats.add(inferCategory(p)); if (p.language) aiLangs.add(p.language); });
      fillSelect('ai-filter-category', aiCats, CATEGORY_ORDER);
      fillSelect('ai-filter-language', aiLangs);

      // Global section filters
      const gCats = new Set(), gLangs = new Set();
      state.globalProjects.forEach(p => { gCats.add(inferCategory(p)); if (p.language) gLangs.add(p.language); });
      fillSelect('global-filter-category', gCats, CATEGORY_ORDER);
      fillSelect('global-filter-language', gLangs);
    }

    function fillSelect(id, valueSet, order) {
      const sel = document.getElementById(id);
      const sorted = order
        ? order.filter(c => c !== 'All' && valueSet.has(c))
        : [...valueSet].sort();
      sorted.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v; opt.textContent = v;
        sel.appendChild(opt);
      });
    }

    // ── Biggest Movers ────────────────────────────────
    function renderMovers() {
      const pctList = [...state.projects]
        .filter(p => (p.stars || 0) < 5000 && (p.trend_starsPct7d || 0) > 0)
        .sort((a, b) => (b.trend_starsPct7d || 0) - (a.trend_starsPct7d || 0))
        .slice(0, 5);

      const pctContainer = document.getElementById('movers-pct-list');
      if (pctList.length === 0) {
        pctContainer.innerHTML = '<p style="font-size:13px;color:var(--text-muted)">Not enough data yet</p>';
      } else {
        pctContainer.innerHTML = pctList.map((p, i) => `
          <div class="mover-row">
            <span class="mover-rank">${i + 1}.</span>
            <span class="mover-name"><a href="/project?repo=${encodeURIComponent(p.fullName)}">${esc(p.name)}</a></span>
            <span class="mover-val pct">+${(p.trend_starsPct7d || 0).toFixed(0)}%</span>
          </div>`).join('');
      }

      const absList = [...state.projects]
        .filter(p => (p.trend_stars7d || 0) > 0)
        .sort((a, b) => (b.trend_stars7d || 0) - (a.trend_stars7d || 0))
        .slice(0, 5);

      const absContainer = document.getElementById('movers-abs-list');
      if (absList.length === 0) {
        absContainer.innerHTML = '<p style="font-size:13px;color:var(--text-muted)">Not enough data yet</p>';
      } else {
        absContainer.innerHTML = absList.map((p, i) => `
          <div class="mover-row">
            <span class="mover-rank">${i + 1}.</span>
            <span class="mover-name"><a href="/project?repo=${encodeURIComponent(p.fullName)}">${esc(p.name)}</a></span>
            <span class="mover-val abs">+${(p.trend_stars7d || 0).toLocaleString()}</span>
          </div>`).join('');
      }
    }

    // ── Section 4: Trending Developers ──────────────────
    function renderDevelopers() {
      const container = document.getElementById('dev-grid');
      const devMap = new Map();

      state.projects.forEach(p => {
        const owner = p.owner;
        if (!owner) return;
        if (!devMap.has(owner)) {
          devMap.set(owner, { owner, avatar: p.ownerAvatar, repos: [], totalStars7d: 0, totalStars: 0, maxMomentum: 0 });
        }
        const dev = devMap.get(owner);
        dev.repos.push(p.name);
        dev.totalStars7d += (p.trend_stars7d || 0);
        dev.totalStars += (p.stars || 0);
        dev.maxMomentum = Math.max(dev.maxMomentum, p.trend_momentum || 0);
      });

      const devs = [...devMap.values()]
        .filter(d => d.repos.length >= 1)
        .sort((a, b) => (b.totalStars7d - a.totalStars7d) || (b.totalStars - a.totalStars))
        .slice(0, 15);

      if (devs.length === 0) {
        renderEmptyState(container, 'users', 'No developer data yet');
        return;
      }

      container.innerHTML = devs.map((d, i) => `
        <div class="dev-card">
          <span class="dev-rank">#${i + 1}</span>
          ${d.avatar ? `<img class="dev-avatar" src="${esc(d.avatar)}" alt="${esc(d.owner)}" loading="lazy">` : ''}
          <div class="dev-info">
            <div class="dev-name"><a href="https://github.com/${esc(d.owner)}" target="_blank" rel="noopener">${esc(d.owner)}</a></div>
            <div class="dev-stats">
              <span>${d.repos.length} repo${d.repos.length > 1 ? 's' : ''}</span>
              ${d.totalStars7d > 0
                ? `<span style="color:#34d399">+${d.totalStars7d.toLocaleString()} stars/wk</span>`
                : `<span style="color:var(--text-muted)">${d.totalStars.toLocaleString()} total stars</span>`}
              ${d.maxMomentum > 0 ? `<span>Peak: ${d.maxMomentum.toFixed(0)}</span>` : ''}
            </div>
            <div class="dev-repos">${d.repos.slice(0, 3).map(r => esc(r)).join(', ')}${d.repos.length > 3 ? ` +${d.repos.length - 3} more` : ''}</div>
          </div>
        </div>`).join('');
      refreshIcons();
    }

    // ── Update hero stats ───────────────────────────────
    function updateHeroStats() {
      const tracked = state.projects.length;
      const hot = state.projects.filter(p => p.trend_label === 'hot').length;
      const rising = state.projects.filter(p => p.trend_label === 'rising').length;
      const totalStars = state.projects.reduce((s, p) => s + (p.trend_stars7d || 0), 0);

      document.getElementById('stat-tracked').dataset.target = tracked;
      document.getElementById('stat-hot').dataset.target = hot;
      document.getElementById('stat-rising').dataset.target = rising;
      document.getElementById('stat-stars-week').dataset.target = Math.max(0, totalStars);
      animateStats();

      // Freshness indicator
      const freshEl = document.getElementById('hero-freshness');
      const latestUpdate = state.projects.reduce((latest, p) => {
        const t = p.trend_updatedAt?.toDate ? p.trend_updatedAt.toDate() : (p.trend_updatedAt ? new Date(p.trend_updatedAt) : null);
        return t && t > latest ? t : latest;
      }, new Date(0));
      if (latestUpdate.getTime() > 0) {
        const hoursAgo = Math.round((Date.now() - latestUpdate.getTime()) / (1000 * 60 * 60));
        freshEl.textContent = hoursAgo < 1 ? 'Updated less than an hour ago' : `Last updated ${hoursAgo} hour${hoursAgo !== 1 ? 's' : ''} ago`;
      }
    }

    // ── Wire up controls ────────────────────────────────
    function initControls() {
      // Sort buttons
      document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.sort = btn.dataset.sort;
          renderAll();
        });
      });

      // Per-section filters
      wireFilter('ai', state.aiFilter, renderAiTop25);
      wireFilter('global', state.globalFilter, renderGlobalTop25);

      // Time range toggle
      document.querySelectorAll('.time-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.timeRange = btn.dataset.range;
          renderAll();
        });
      });
    }

    function wireFilter(prefix, filter, renderFn) {
      document.getElementById(`${prefix}-filter-category`).addEventListener('change', (e) => {
        filter.category = e.target.value;
        filter.page = 1;
        renderFn();
      });
      document.getElementById(`${prefix}-filter-language`).addEventListener('change', (e) => {
        filter.language = e.target.value;
        filter.page = 1;
        renderFn();
      });
      let timer;
      document.getElementById(`${prefix}-filter-search`).addEventListener('input', (e) => {
        clearTimeout(timer);
        timer = setTimeout(() => {
          filter.search = e.target.value.trim();
          filter.page = 1;
          renderFn();
        }, 300);
      });
    }

    function renderAll() {
      renderAiTop25();
      renderGlobalTop25();
      renderMovers();
      renderDevelopers();
    }

    // ── Toast ────────────────────────────────────────────
    function showToast(message, type = 'success', duration = 3000) {
      const icons = { success: 'check-circle', error: 'x-circle', info: 'info' };
      const t = document.createElement('div');
      t.className = `toast glass ${type}`;
      t.innerHTML = `<i data-lucide="${icons[type]}" style="width:18px;height:18px"></i><span>${message}</span>`;
      toastContainer.appendChild(t);
      refreshIcons();
      setTimeout(() => { t.classList.add('removing'); t.addEventListener('animationend', () => t.remove()); }, duration);
    }

    // ── Modals ──────────────────────────────────────────
    function lockBodyScroll() { document.body.classList.add('modal-open'); }
    function unlockBodyScroll() { document.body.classList.remove('modal-open'); }
    function openLoginModal() { loginModal.classList.add('open'); lockBodyScroll(); }
    function closeLoginModal() { loginModal.classList.remove('open'); unlockBodyScroll(); enableOAuthButtons(); }

    // ── Auth ────────────────────────────────────────────
    function enableOAuthButtons() {
      loginModal.querySelectorAll('.oauth-btn').forEach(b => { b.disabled = false; if (b.dataset.label) b.innerHTML = b.dataset.label; });
    }
    function setLoading(btn) {
      loginModal.querySelectorAll('.oauth-btn').forEach(b => b.disabled = true);
      btn.dataset.label = btn.innerHTML;
      btn.innerHTML = `<div class="oauth-spinner"></div> Connecting...`;
    }

    const providerNames = { 'google.com': 'Google', 'github.com': 'GitHub', 'facebook.com': 'Facebook' };

    async function handleOAuthError(err, providerName) {
      if (err.code === 'auth/account-exists-with-different-credential') {
        const otherProviders = Object.values(providerNames).filter(n => n !== providerName);
        showToast(`This email is already registered. Sign in with ${otherProviders.join(' or ')} to link your ${providerName} account.`, 'info', 6000);
      } else if (err.code === 'auth/popup-closed-by-user' || err.code === 'auth/cancelled-popup-request') {
        // User closed popup
      } else {
        console.error(`${providerName} auth error:`, err);
        showToast(`Auth error: ${err.code || err.message}`, 'error');
      }
      enableOAuthButtons();
    }

    async function handleOAuthSuccess() {
      closeLoginModal();
      showToast(`Welcome, ${state.user.displayName || 'friend'}!`, 'success');
    }

    async function loginWithGitHub() {
      const btn = document.getElementById('btn-github');
      setLoading(btn);
      try { await signInWithPopup(auth, new GithubAuthProvider()); await handleOAuthSuccess(); }
      catch (err) { await handleOAuthError(err, 'GitHub'); }
    }
    async function loginWithGoogle() {
      const btn = document.getElementById('btn-google');
      setLoading(btn);
      try { await signInWithPopup(auth, new GoogleAuthProvider()); await handleOAuthSuccess(); }
      catch (err) { await handleOAuthError(err, 'Google'); }
    }
    async function loginWithFacebook() {
      const btn = document.getElementById('btn-facebook');
      setLoading(btn);
      try { await signInWithPopup(auth, new FacebookAuthProvider()); await handleOAuthSuccess(); }
      catch (err) { await handleOAuthError(err, 'Facebook'); }
    }
    async function logout() {
      avatarDropdown.classList.remove('open');
      await signOut(auth);
      showToast('Signed out.', 'info');
    }

    // Wire login modal
    document.getElementById('login-close').addEventListener('click', closeLoginModal);
    loginModal.addEventListener('click', (e) => { if (e.target === loginModal) closeLoginModal(); });
    document.getElementById('btn-github').addEventListener('click', loginWithGitHub);
    document.getElementById('btn-google').addEventListener('click', loginWithGoogle);
    document.getElementById('btn-facebook').addEventListener('click', loginWithFacebook);

    // ── Navbar rendering ────────────────────────────────
    function renderNavbar() {
      if (state.isLoggedIn) {
        const photo = state.user.photoURL || `https://api.dicebear.com/7.x/avataaars/svg?seed=${state.user.uid}`;
        navRight.innerHTML = `
          <a href="/" class="btn-primary btn-small" style="text-decoration:none"><i data-lucide="plus" style="width:14px;height:14px"></i> Submit</a>
          <img src="${esc(photo)}" alt="Avatar" class="nav-avatar" id="nav-avatar" width="36" height="36" referrerpolicy="no-referrer">
        `;
        avatarDropdown.innerHTML = `
          <a href="#"><i data-lucide="user" style="width:16px;height:16px"></i>${esc(state.user.displayName || 'Profile')}</a>
          <div class="dropdown-divider"></div>
          <button id="logout-btn"><i data-lucide="log-out" style="width:16px;height:16px"></i>Logout</button>
        `;
        document.getElementById('nav-avatar').addEventListener('click', (e) => { e.stopPropagation(); avatarDropdown.classList.toggle('open'); });
        document.getElementById('logout-btn').addEventListener('click', logout);
      } else {
        navRight.innerHTML = `<button class="btn-outlined btn-small" id="nav-login-btn">Login / Join</button>`;
        avatarDropdown.innerHTML = '';
        avatarDropdown.classList.remove('open');
        document.getElementById('nav-login-btn').addEventListener('click', openLoginModal);
      }
      refreshIcons();
    }

    // Close avatar dropdown on outside click
    document.addEventListener('click', (e) => {
      if (!avatarDropdown.contains(e.target)) avatarDropdown.classList.remove('open');
    });

    // ── Auth state listener ─────────────────────────────
    onAuthStateChanged(auth, user => {
      state.user = user || null;
      state.isLoggedIn = !!user;
      renderNavbar();
    });

    // ── Nav scroll effect ───────────────────────────────
    const navbar = document.getElementById('navbar');
    window.addEventListener('scroll', () => {
      navbar.classList.toggle('scrolled', window.scrollY > 20);
    }, { passive: true });

    // Mobile hamburger
    const hamburgerBtn = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobile-menu');
    hamburgerBtn.addEventListener('click', () => mobileMenu.classList.toggle('open'));
    mobileMenu.querySelectorAll('a').forEach(a => {
      a.addEventListener('click', () => mobileMenu.classList.remove('open'));
    });
    document.addEventListener('click', (e) => {
      if (!mobileMenu.contains(e.target) && e.target !== hamburgerBtn && !hamburgerBtn.contains(e.target)) {
        mobileMenu.classList.remove('open');
      }
    });

    // ── Load projects from Firestore ────────────────────
    async function loadProjects() {
      try {
        const snap = await getDocs(collection(db, 'projects'));
        state.projects = snap.docs
          .map(d => {
            const p = d.data();
            // Default trend fields for newly discovered repos awaiting first snapshot
            if (p.trend_momentum === undefined) p.trend_momentum = 0;
            if (p.trend_label === undefined) p.trend_label = 'new';
            if (p.trend_stars7d === undefined) p.trend_stars7d = 0;
            if (p.trend_starsPct7d === undefined) p.trend_starsPct7d = 0;
            if (p.trend_sparkline === undefined) p.trend_sparkline = [];
            return p;
          })
          .filter(p => p.source || p.submittedBy);
      } catch (err) {
        console.error('loadProjects error:', err);
        state.projects = [];
      }

      // Classify into AI vs Global pools
      state.aiProjects = state.projects.filter(p => isAiProject(p));
      state.globalProjects = state.projects; // everything

      renderAll();
      populateFilters();
      updateHeroStats();
      initControls();
    }

    // ── Boot ────────────────────────────────────────────
    loadProjects();
    refreshIcons();
  </script>
</body>
</html>
